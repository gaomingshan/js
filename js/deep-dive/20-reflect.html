<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reflect åå°„ API - JavaScript æ·±åº¦å­¦ä¹ </title>
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/page.css">
</head>
<body>
    <div class="page-layout">
        <div class="doc-panel">
            <h1>Reflect åå°„ API</h1>
            
            <h2>æ¦‚è¿°</h2>
            <p>Reflect æ˜¯ ES6 å¼•å…¥çš„å†…ç½®å¯¹è±¡ï¼Œæä¾›äº†ä¸€ç»„æ“ä½œå¯¹è±¡çš„æ–¹æ³•ã€‚å®ƒä¸ Proxy é…åˆä½¿ç”¨ï¼Œä½¿å¾—å…ƒç¼–ç¨‹æ›´åŠ ç®€æ´å’Œè§„èŒƒã€‚</p>
            
            <h2>ä¸€ã€Reflect ç®€ä»‹</h2>
            
            <h3>1.1 è®¾è®¡ç›®çš„</h3>
            <div class="info">
                <ul>
                    <li><strong>è§„èŒƒåŒ–</strong>ï¼šå°† Object ä¸Šçš„ä¸€äº›æ–¹æ³•ç§»åˆ° Reflect</li>
                    <li><strong>å‡½æ•°å¼</strong>ï¼šæ“ä½œå¯¹è±¡å˜æˆå‡½æ•°è°ƒç”¨</li>
                    <li><strong>è¿”å›å€¼åˆç†</strong>ï¼šå¤±è´¥è¿”å› false è€ŒéæŠ›å‡ºé”™è¯¯</li>
                    <li><strong>é…åˆ Proxy</strong>ï¼šReflect æ–¹æ³•ä¸ Proxy é™·é˜±ä¸€ä¸€å¯¹åº”</li>
                </ul>
            </div>
            
            <h3>1.2 ä¸ Object æ–¹æ³•å¯¹æ¯”</h3>
            <pre><code>// ä¼ ç»Ÿæ–¹å¼
try {
    Object.defineProperty(obj, name, desc);
    // æˆåŠŸ
} catch (e) {
    // å¤±è´¥
}

// Reflect æ–¹å¼
if (Reflect.defineProperty(obj, name, desc)) {
    // æˆåŠŸ
} else {
    // å¤±è´¥
}

// æ›´ç®€æ´ï¼Œè¿”å›å€¼æ›´åˆç†</code></pre>
            
            <h2>äºŒã€Reflect æ–¹æ³•</h2>
            
            <h3>2.1 Reflect.get()</h3>
            <pre><code>// è¯»å–å¯¹è±¡å±æ€§
const obj = { name: 'Alice', age: 25 };

// ä¼ ç»Ÿæ–¹å¼
console.log(obj.name);  // "Alice"

// Reflect æ–¹å¼
console.log(Reflect.get(obj, 'name'));  // "Alice"

// æŒ‡å®š receiverï¼ˆthis å€¼ï¼‰
const proxy = new Proxy(obj, {
    get(target, property, receiver) {
        console.log('Reading:', property);
        return Reflect.get(target, property, receiver);
    }
});

proxy.name;  // Reading: name â†’ "Alice"</code></pre>
            
            <h3>2.2 Reflect.set()</h3>
            <pre><code>// è®¾ç½®å¯¹è±¡å±æ€§
const obj = { name: 'Alice' };

// ä¼ ç»Ÿæ–¹å¼
obj.age = 25;

// Reflect æ–¹å¼
Reflect.set(obj, 'age', 25);  // trueï¼ˆæˆåŠŸï¼‰

// è¿”å› false è¡¨ç¤ºå¤±è´¥
const frozen = Object.freeze({ x: 1 });
console.log(Reflect.set(frozen, 'x', 2));  // false</code></pre>
            
            <h3>2.3 Reflect.has()</h3>
            <pre><code>// æ£€æŸ¥å±æ€§æ˜¯å¦å­˜åœ¨
const obj = { name: 'Alice' };

// ä¼ ç»Ÿæ–¹å¼
console.log('name' in obj);  // true

// Reflect æ–¹å¼
console.log(Reflect.has(obj, 'name'));  // true</code></pre>
            
            <h3>2.4 Reflect.deleteProperty()</h3>
            <pre><code>// åˆ é™¤å±æ€§
const obj = { name: 'Alice', age: 25 };

// ä¼ ç»Ÿæ–¹å¼
delete obj.age;

// Reflect æ–¹å¼
Reflect.deleteProperty(obj, 'age');  // trueï¼ˆæˆåŠŸï¼‰

// ä¸å¯åˆ é™¤æ—¶è¿”å› false
Object.defineProperty(obj, 'id', {
    value: 123,
    configurable: false
});

console.log(Reflect.deleteProperty(obj, 'id'));  // false</code></pre>
            
            <h3>2.5 Reflect.ownKeys()</h3>
            <pre><code>// è·å–æ‰€æœ‰å±æ€§é”®
const obj = {
    name: 'Alice',
    [Symbol('id')]: 123
};

// Reflect.ownKeys åŒ…å«æ‰€æœ‰ç±»å‹çš„é”®
console.log(Reflect.ownKeys(obj));
// ['name', Symbol(id)]

// å¯¹æ¯”å…¶ä»–æ–¹æ³•
console.log(Object.keys(obj));              // ['name']
console.log(Object.getOwnPropertyNames(obj));  // ['name']
console.log(Object.getOwnPropertySymbols(obj));  // [Symbol(id)]</code></pre>
            
            <h3>2.6 Reflect.getPrototypeOf()</h3>
            <pre><code>// è·å–åŸå‹
const obj = {};

// ä¼ ç»Ÿæ–¹å¼
Object.getPrototypeOf(obj);

// Reflect æ–¹å¼
Reflect.getPrototypeOf(obj);  // Object.prototype

// éå¯¹è±¡å‚æ•°
Reflect.getPrototypeOf(1);  // TypeError
Object.getPrototypeOf(1);   // Number.prototypeï¼ˆè‡ªåŠ¨è½¬æ¢ï¼‰</code></pre>
            
            <h3>2.7 Reflect.setPrototypeOf()</h3>
            <pre><code>// è®¾ç½®åŸå‹
const obj = {};
const proto = { x: 1 };

// Reflect æ–¹å¼
Reflect.setPrototypeOf(obj, proto);  // true
console.log(obj.x);  // 1

// å¤±è´¥æ—¶è¿”å› false
const frozen = Object.freeze({});
console.log(Reflect.setPrototypeOf(frozen, proto));  // false</code></pre>
            
            <h3>2.8 Reflect.apply()</h3>
            <pre><code>// è°ƒç”¨å‡½æ•°
function sum(a, b) {
    return a + b;
}

// ä¼ ç»Ÿæ–¹å¼
sum.apply(null, [1, 2]);

// Reflect æ–¹å¼
Reflect.apply(sum, null, [1, 2]);  // 3

// ä¼˜åŠ¿ï¼šé¿å… Function.prototype.apply è¢«è¦†ç›–
const obj = {
    apply() {
        return 'fake apply';
    }
};

// å®‰å…¨è°ƒç”¨
Reflect.apply(Array.prototype.slice, [1, 2, 3], [1]);  // [2, 3]</code></pre>
            
            <h3>2.9 Reflect.construct()</h3>
            <pre><code>// ä½¿ç”¨ new è°ƒç”¨æ„é€ å‡½æ•°
function Person(name) {
    this.name = name;
}

// ä¼ ç»Ÿæ–¹å¼
new Person('Alice');

// Reflect æ–¹å¼
Reflect.construct(Person, ['Alice']);

// æŒ‡å®šä¸åŒçš„åŸå‹
function Animal(name) {
    this.name = name;
}

const person = Reflect.construct(Person, ['Alice'], Animal);
console.log(person instanceof Animal);  // true
console.log(person.name);  // "Alice"</code></pre>
            
            <h2>ä¸‰ã€é…åˆ Proxy ä½¿ç”¨</h2>
            
            <h3>3.1 æ ‡å‡†ç”¨æ³•</h3>
            <pre><code>// Proxy + Reflect çš„æ ‡å‡†æ¨¡å¼
const handler = {
    get(target, property, receiver) {
        console.log(`Getting ${property}`);
        return Reflect.get(target, property, receiver);
    },
    
    set(target, property, value, receiver) {
        console.log(`Setting ${property} = ${value}`);
        return Reflect.set(target, property, value, receiver);
    }
};

const obj = new Proxy({ name: 'Alice' }, handler);

obj.name;       // Getting name
obj.age = 25;   // Setting age = 25</code></pre>
            
            <h3>3.2 ä¸ºä»€ä¹ˆä½¿ç”¨ Reflect</h3>
            <pre><code>// é—®é¢˜ï¼šç›´æ¥æ“ä½œå¯èƒ½å¯¼è‡´ this ä¸æ­£ç¡®
const parent = {
    get value() {
        return this.name;
    }
};

const child = {
    name: 'Child',
    __proto__: parent
};

// é”™è¯¯åšæ³•
const handler1 = {
    get(target, property) {
        return target[property];  // this æŒ‡å‘ target
    }
};

const proxy1 = new Proxy(child, handler1);
console.log(proxy1.value);  // undefinedï¼ˆthis æ˜¯ child çš„åŸå‹ï¼‰

// æ­£ç¡®åšæ³•
const handler2 = {
    get(target, property, receiver) {
        return Reflect.get(target, property, receiver);  // this æŒ‡å‘ receiver
    }
};

const proxy2 = new Proxy(child, handler2);
console.log(proxy2.value);  // "Child"</code></pre>
            
            <h2>å››ã€å®é™…åº”ç”¨</h2>
            
            <h3>4.1 è§‚å¯Ÿè€…æ¨¡å¼</h3>
            <pre><code>// ä½¿ç”¨ Reflect å®ç°è§‚å¯Ÿè€…
const observers = new Set();

function observe(fn) {
    observers.add(fn);
}

function observable(obj) {
    return new Proxy(obj, {
        set(target, property, value, receiver) {
            const result = Reflect.set(target, property, value, receiver);
            
            if (result) {
                observers.forEach(fn => fn(property, value));
            }
            
            return result;
        }
    });
}

// ä½¿ç”¨
const state = observable({ count: 0 });

observe((prop, value) => {
    console.log(`${prop} changed to ${value}`);
});

state.count = 1;  // count changed to 1
state.count = 2;  // count changed to 2</code></pre>
            
            <h3>4.2 å‡½æ•°éªŒè¯</h3>
            <pre><code>// éªŒè¯å‡½æ•°å‚æ•°
function validate(...validators) {
    return function(target) {
        return new Proxy(target, {
            apply(target, thisArg, args) {
                // éªŒè¯å‚æ•°
                validators.forEach((validator, index) => {
                    if (!validator(args[index])) {
                        throw new TypeError(`Invalid argument ${index}`);
                    }
                });
                
                return Reflect.apply(target, thisArg, args);
            }
        });
    };
}

// ä½¿ç”¨
const isString = x => typeof x === 'string';
const isNumber = x => typeof x === 'number';

const greet = validate(isString, isNumber)(
    function(name, age) {
        return `${name} is ${age} years old`;
    }
);

console.log(greet('Alice', 25));  // "Alice is 25 years old"
greet('Alice', 'invalid');         // TypeError</code></pre>
            
            <h2>äº”ã€å®Œæ•´çš„ Reflect æ–¹æ³•åˆ—è¡¨</h2>
            
            <table>
                <thead>
                    <tr>
                        <th>Reflect æ–¹æ³•</th>
                        <th>å¯¹åº”çš„ Proxy é™·é˜±</th>
                        <th>è¯´æ˜</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Reflect.get()</td>
                        <td>get</td>
                        <td>è¯»å–å±æ€§</td>
                    </tr>
                    <tr>
                        <td>Reflect.set()</td>
                        <td>set</td>
                        <td>è®¾ç½®å±æ€§</td>
                    </tr>
                    <tr>
                        <td>Reflect.has()</td>
                        <td>has</td>
                        <td>in æ“ä½œç¬¦</td>
                    </tr>
                    <tr>
                        <td>Reflect.deleteProperty()</td>
                        <td>deleteProperty</td>
                        <td>delete æ“ä½œç¬¦</td>
                    </tr>
                    <tr>
                        <td>Reflect.ownKeys()</td>
                        <td>ownKeys</td>
                        <td>è·å–æ‰€æœ‰é”®</td>
                    </tr>
                    <tr>
                        <td>Reflect.getOwnPropertyDescriptor()</td>
                        <td>getOwnPropertyDescriptor</td>
                        <td>è·å–å±æ€§æè¿°ç¬¦</td>
                    </tr>
                    <tr>
                        <td>Reflect.defineProperty()</td>
                        <td>defineProperty</td>
                        <td>å®šä¹‰å±æ€§</td>
                    </tr>
                    <tr>
                        <td>Reflect.preventExtensions()</td>
                        <td>preventExtensions</td>
                        <td>é˜»æ­¢æ‰©å±•</td>
                    </tr>
                    <tr>
                        <td>Reflect.getPrototypeOf()</td>
                        <td>getPrototypeOf</td>
                        <td>è·å–åŸå‹</td>
                    </tr>
                    <tr>
                        <td>Reflect.isExtensible()</td>
                        <td>isExtensible</td>
                        <td>æ£€æŸ¥å¯æ‰©å±•æ€§</td>
                    </tr>
                    <tr>
                        <td>Reflect.setPrototypeOf()</td>
                        <td>setPrototypeOf</td>
                        <td>è®¾ç½®åŸå‹</td>
                    </tr>
                    <tr>
                        <td>Reflect.apply()</td>
                        <td>apply</td>
                        <td>è°ƒç”¨å‡½æ•°</td>
                    </tr>
                    <tr>
                        <td>Reflect.construct()</td>
                        <td>construct</td>
                        <td>new æ“ä½œç¬¦</td>
                    </tr>
                </tbody>
            </table>
            
            <h2>å…­ã€æœ€ä½³å®è·µ</h2>
            
            <div class="tip">
                <ol>
                    <li><strong>Proxy ä¸­ä½¿ç”¨ Reflect</strong>ï¼šä¿æŒé»˜è®¤è¡Œä¸º</li>
                    <li><strong>æ­£ç¡®ä¼ é€’ receiver</strong>ï¼šä¿è¯ this æŒ‡å‘æ­£ç¡®</li>
                    <li><strong>æ£€æŸ¥è¿”å›å€¼</strong>ï¼šReflect æ–¹æ³•è¿”å›æ“ä½œæ˜¯å¦æˆåŠŸ</li>
                    <li><strong>ä¼˜å…ˆ Reflect</strong>ï¼šæ–°ä»£ç ä¼˜å…ˆä½¿ç”¨ Reflect API</li>
                    <li><strong>å‡½æ•°å¼ç¼–ç¨‹</strong>ï¼šReflect æ–¹æ³•æ›´é€‚åˆå‡½æ•°å¼é£æ ¼</li>
                    <li><strong>é”™è¯¯å¤„ç†</strong>ï¼šåˆ©ç”¨è¿”å›å€¼è€Œé try/catch</li>
                </ol>
            </div>
            
            <h2>å‚è€ƒèµ„æ–™</h2>
            <ul>
                <li><a href="https://tc39.es/ecma262/#sec-reflect-object" target="_blank">ECMAScript - Reflect Object</a></li>
                <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect" target="_blank">MDN - Reflect</a></li>
            </ul>
            
            <div class="nav-links">
                <a href="20-proxy.html" class="nav-link prev">ä¸Šä¸€èŠ‚ï¼šProxy ä»£ç†</a>
                <a href="../index.html" class="nav-link home">è¿”å›é¦–é¡µ</a>
                <a href="20-metaprogramming.html" class="nav-link next">ä¸‹ä¸€èŠ‚ï¼šå…ƒç¼–ç¨‹å®è·µ</a>
            </div>
        </div>
        
        <div class="code-panel">
            <h2 style="color: #60a5fa; margin-bottom: 1.5rem;">ğŸ’» äº¤äº’å¼ä»£ç ç¤ºä¾‹</h2>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 1ï¼šReflect åŸºç¡€</h3>
                <div class="code-block">
                    <pre><code>// Reflect åŸºæœ¬æ–¹æ³•
console.log('=== Reflect åŸºç¡€ ===\n');

const obj = {
    name: 'Alice',
    age: 25
};

console.log('1. Reflect.get():');
console.log('  name =', Reflect.get(obj, 'name'));

console.log('\n2. Reflect.set():');
const success = Reflect.set(obj, 'city', 'Beijing');
console.log('  è®¾ç½®æˆåŠŸ:', success);
console.log('  city =', obj.city);

console.log('\n3. Reflect.has():');
console.log('  "name" in obj:', Reflect.has(obj, 'name'));
console.log('  "email" in obj:', Reflect.has(obj, 'email'));

console.log('\n4. Reflect.ownKeys():');
console.log('  æ‰€æœ‰é”®:', Reflect.ownKeys(obj));</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 2ï¼šReflect vs ä¼ ç»Ÿæ–¹å¼</h3>
                <div class="code-block">
                    <pre><code>// Reflect ä¸ä¼ ç»Ÿæ–¹å¼å¯¹æ¯”
console.log('=== Reflect vs ä¼ ç»Ÿ ===\n');

const obj = {};
Object.freeze(obj);

console.log('1. è®¾ç½®å±æ€§:');
console.log('  ä¼ ç»Ÿ: obj.x = 1ï¼ˆé™é»˜å¤±è´¥ï¼‰');
obj.x = 1;
console.log('  ç»“æœ: obj.x =', obj.x);

console.log('\n  Reflect: Reflect.set(obj, "y", 2)');
const success = Reflect.set(obj, 'y', 2);
console.log('  è¿”å›:', success);
console.log('  ç»“æœ: obj.y =', obj.y);

console.log('\n2. åˆ é™¤å±æ€§:');
Object.defineProperty(obj, 'z', {
    value: 3,
    configurable: false
});

console.log('  delete obj.z:', delete obj.z);
console.log('  Reflect.deleteProperty(obj, "z"):', 
    Reflect.deleteProperty(obj, 'z'));</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 3ï¼šProxy + Reflect</h3>
                <div class="code-block">
                    <pre><code>// Proxy ä¸­ä½¿ç”¨ Reflect
console.log('=== Proxy + Reflect ===\n');

const target = {
    name: 'Alice',
    age: 25
};

const handler = {
    get(target, property, receiver) {
        console.log(`  è¯»å–: ${property}`);
        return Reflect.get(target, property, receiver);
    },
    
    set(target, property, value, receiver) {
        console.log(`  è®¾ç½®: ${property} = ${value}`);
        return Reflect.set(target, property, value, receiver);
    }
};

const proxy = new Proxy(target, handler);

console.log('æ“ä½œä»£ç†:');
console.log('proxy.name =', proxy.name);
proxy.age = 26;
console.log('proxy.age =', proxy.age);</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 4ï¼šreceiver å‚æ•°</h3>
                <div class="code-block">
                    <pre><code>// receiver å‚æ•°çš„é‡è¦æ€§
console.log('=== receiver å‚æ•° ===\n');

const parent = {
    get value() {
        console.log('  this:', this === parent ? 'parent' : 'other');
        return this.name;
    }
};

const child = {
    name: 'Child',
    __proto__: parent
};

console.log('1. ç›´æ¥è®¿é—®:');
console.log('  child.value =', child.value);

console.log('\n2. ä¸ä½¿ç”¨ receiverï¼ˆé”™è¯¯ï¼‰:');
const proxy1 = new Proxy(child, {
    get(target, property) {
        return target[property];
    }
});
console.log('  proxy1.value =', proxy1.value);

console.log('\n3. ä½¿ç”¨ receiverï¼ˆæ­£ç¡®ï¼‰:');
const proxy2 = new Proxy(child, {
    get(target, property, receiver) {
        return Reflect.get(target, property, receiver);
    }
});
console.log('  proxy2.value =', proxy2.value);</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 5ï¼šReflect.apply()</h3>
                <div class="code-block">
                    <pre><code>// Reflect.apply çš„ä½¿ç”¨
console.log('=== Reflect.apply ===\n');

function sum(a, b, c) {
    console.log('  this:', this);
    return a + b + c;
}

console.log('1. æ™®é€šè°ƒç”¨:');
console.log('  sum(1, 2, 3) =', sum(1, 2, 3));

console.log('\n2. Reflect.apply:');
const result = Reflect.apply(sum, { name: 'context' }, [4, 5, 6]);
console.log('  result =', result);

console.log('\n3. æ•°ç»„æ–¹æ³•è°ƒç”¨:');
const arr = [1, 2, 3, 4, 5];
const sliced = Reflect.apply(Array.prototype.slice, arr, [1, 3]);
console.log('  sliced =', sliced);</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 6ï¼šè§‚å¯Ÿè€…æ¨¡å¼</h3>
                <div class="code-block">
                    <pre><code>// ä½¿ç”¨ Reflect å®ç°è§‚å¯Ÿè€…
console.log('=== è§‚å¯Ÿè€…æ¨¡å¼ ===\n');

const observers = [];

function observe(fn) {
    observers.push(fn);
    console.log('  æ·»åŠ è§‚å¯Ÿè€…');
}

function observable(obj) {
    return new Proxy(obj, {
        set(target, property, value, receiver) {
            const oldValue = target[property];
            const result = Reflect.set(target, property, value, receiver);
            
            if (result && oldValue !== value) {
                observers.forEach(fn => fn(property, value, oldValue));
            }
            
            return result;
        }
    });
}

const state = observable({ count: 0 });

observe((prop, newVal, oldVal) => {
    console.log(`  ${prop}: ${oldVal} â†’ ${newVal}`);
});

console.log('\nä¿®æ”¹çŠ¶æ€:');
state.count = 1;
state.count = 2;
state.count = 3;</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
        </div>
    </div>
    
    <script src="../assets/js/common.js"></script>
</body>
</html>
