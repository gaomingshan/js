<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Symbol æ·±å…¥ - JavaScript æ·±åº¦å­¦ä¹ </title>
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/page.css">
</head>
<body>
    <div class="page-layout">
        <div class="doc-panel">
            <h1>Symbol æ·±å…¥</h1>
            
            <h2>æ¦‚è¿°</h2>
            <p>Symbol æ˜¯ ES6 å¼•å…¥çš„åŸå§‹æ•°æ®ç±»å‹ï¼Œç”¨äºåˆ›å»ºå”¯ä¸€çš„æ ‡è¯†ç¬¦ã€‚å®ƒæ˜¯ JavaScript å…ƒç¼–ç¨‹çš„é‡è¦åŸºç¡€ã€‚</p>
            
            <h2>ä¸€ã€Symbol åŸºç¡€</h2>
            
            <h3>1.1 åˆ›å»º Symbol</h3>
            <pre><code>// åˆ›å»ºå”¯ä¸€ Symbol
const sym1 = Symbol();
const sym2 = Symbol();
console.log(sym1 === sym2);  // falseï¼ˆæ¯ä¸ªéƒ½æ˜¯å”¯ä¸€çš„ï¼‰

// å¸¦æè¿°çš„ Symbol
const sym = Symbol('mySymbol');
console.log(sym.description);  // "mySymbol"

// Symbol ä¸èƒ½ä½¿ç”¨ new
const sym = new Symbol();  // âŒ TypeError</code></pre>
            
            <h3>1.2 Symbol æ³¨å†Œè¡¨</h3>
            <pre><code>// Symbol.for() åˆ›å»ºå…¨å±€ Symbol
const sym1 = Symbol.for('app.id');
const sym2 = Symbol.for('app.id');
console.log(sym1 === sym2);  // trueï¼ˆç›¸åŒçš„ï¼‰

// Symbol.keyFor() è·å– key
const key = Symbol.keyFor(sym1);
console.log(key);  // "app.id"

// å±€éƒ¨ Symbol è¿”å› undefined
const local = Symbol('local');
console.log(Symbol.keyFor(local));  // undefined</code></pre>
            
            <h2>äºŒã€Well-Known Symbols</h2>
            
            <h3>2.1 Symbol.iterator</h3>
            <pre><code>// å®šä¹‰è¿­ä»£è¡Œä¸º
const range = {
    from: 1,
    to: 5,
    
    [Symbol.iterator]() {
        let current = this.from;
        const last = this.to;
        
        return {
            next() {
                if (current <= last) {
                    return { value: current++, done: false };
                }
                return { done: true };
            }
        };
    }
};

for (const num of range) {
    console.log(num);  // 1, 2, 3, 4, 5
}</code></pre>
            
            <h3>2.2 Symbol.toStringTag</h3>
            <pre><code>// è‡ªå®šä¹‰ toString è¾“å‡º
class MyClass {
    get [Symbol.toStringTag]() {
        return 'MyClass';
    }
}

const obj = new MyClass();
console.log(obj.toString());  // "[object MyClass]"

// å†…ç½®å¯¹è±¡çš„ toStringTag
console.log(Object.prototype.toString.call(new Map()));
// "[object Map]"</code></pre>
            
            <h3>2.3 Symbol.toPrimitive</h3>
            <pre><code>// è‡ªå®šä¹‰ç±»å‹è½¬æ¢
const obj = {
    [Symbol.toPrimitive](hint) {
        if (hint === 'number') {
            return 42;
        }
        if (hint === 'string') {
            return 'hello';
        }
        return true;
    }
};

console.log(+obj);      // 42
console.log(`${obj}`);  // "hello"
console.log(obj + '');  // "true"</code></pre>
            
            <h3>2.4 å…¶ä»– Well-Known Symbols</h3>
            <pre><code>// Symbol.hasInstance - instanceof è¡Œä¸º
class MyArray {
    static [Symbol.hasInstance](instance) {
        return Array.isArray(instance);
    }
}

console.log([] instanceof MyArray);  // true

// Symbol.isConcatSpreadable - concat è¡Œä¸º
const arr = [1, 2];
arr[Symbol.isConcatSpreadable] = false;
console.log([0].concat(arr));  // [0, [1, 2]]

// Symbol.species - æ´¾ç”Ÿå¯¹è±¡çš„æ„é€ å‡½æ•°
class MyArray extends Array {
    static get [Symbol.species]() {
        return Array;
    }
}

const arr = new MyArray(1, 2, 3);
const mapped = arr.map(x => x * 2);
console.log(mapped instanceof MyArray);  // false
console.log(mapped instanceof Array);    // true</code></pre>
            
            <h2>ä¸‰ã€Symbol ä½œä¸ºå±æ€§é”®</h2>
            
            <h3>3.1 ç§æœ‰å±æ€§</h3>
            <pre><code>// ä½¿ç”¨ Symbol åˆ›å»º"ç§æœ‰"å±æ€§
const _private = Symbol('private');

class MyClass {
    constructor() {
        this[_private] = 'private data';
        this.public = 'public data';
    }
    
    getPrivate() {
        return this[_private];
    }
}

const obj = new MyClass();
console.log(obj.public);        // "public data"
console.log(obj[_private]);     // undefinedï¼ˆè®¿é—®ä¸åˆ°ï¼‰
console.log(obj.getPrivate());  // "private data"

// ä½†å¯ä»¥é€šè¿‡ Object.getOwnPropertySymbols() è®¿é—®
const symbols = Object.getOwnPropertySymbols(obj);
console.log(obj[symbols[0]]);   // "private data"</code></pre>
            
            <h3>3.2 é¿å…å‘½åå†²çª</h3>
            <pre><code>// Symbol å±æ€§ä¸ä¼šå†²çª
const id = Symbol('id');

const user = {
    name: 'Alice',
    [id]: 123
};

// å…¶ä»–ä»£ç æ·»åŠ  id å±æ€§
user.id = 456;

console.log(user.id);    // 456
console.log(user[id]);   // 123ï¼ˆä¸å†²çªï¼‰</code></pre>
            
            <h2>å››ã€Symbol çš„ç‰¹æ€§</h2>
            
            <h3>4.1 ä¸å¯æšä¸¾</h3>
            <pre><code>const sym = Symbol('test');
const obj = {
    normal: 1,
    [sym]: 2
};

// for...in ä¸åŒ…å« Symbol
for (const key in obj) {
    console.log(key);  // åªè¾“å‡º "normal"
}

// Object.keys() ä¸åŒ…å« Symbol
console.log(Object.keys(obj));  // ["normal"]

// JSON.stringify() å¿½ç•¥ Symbol
console.log(JSON.stringify(obj));  // {"normal":1}

// è·å– Symbol å±æ€§
console.log(Object.getOwnPropertySymbols(obj));  // [Symbol(test)]

// è·å–æ‰€æœ‰å±æ€§ï¼ˆåŒ…æ‹¬ Symbolï¼‰
console.log(Reflect.ownKeys(obj));  // ["normal", Symbol(test)]</code></pre>
            
            <h3>4.2 ç±»å‹è½¬æ¢</h3>
            <pre><code>const sym = Symbol('test');

// ä¸èƒ½è½¬ä¸ºæ•°å­—
console.log(+sym);  // âŒ TypeError

// ä¸èƒ½è‡ªåŠ¨è½¬ä¸ºå­—ç¬¦ä¸²
console.log('symbol: ' + sym);  // âŒ TypeError

// å¯ä»¥æ˜¾å¼è½¬æ¢
console.log(String(sym));        // "Symbol(test)"
console.log(sym.toString());     // "Symbol(test)"

// å¯ä»¥è½¬ä¸ºå¸ƒå°”å€¼
console.log(Boolean(sym));  // true
console.log(!sym);          // false</code></pre>
            
            <h2>äº”ã€å®é™…åº”ç”¨</h2>
            
            <h3>5.1 å…ƒæ•°æ®å­˜å‚¨</h3>
            <pre><code>// ä¸ºå¯¹è±¡æ·»åŠ å…ƒæ•°æ®
const metadata = Symbol('metadata');

function addMetadata(obj, data) {
    obj[metadata] = data;
}

function getMetadata(obj) {
    return obj[metadata];
}

const user = { name: 'Alice' };
addMetadata(user, { created: Date.now() });
console.log(getMetadata(user));</code></pre>
            
            <h3>5.2 å•ä¾‹æ¨¡å¼</h3>
            <pre><code>// ä½¿ç”¨ Symbol å®ç°å•ä¾‹
const instance = Symbol('instance');

class Database {
    constructor() {
        if (Database[instance]) {
            return Database[instance];
        }
        
        // åˆå§‹åŒ–
        this.connection = 'connected';
        Database[instance] = this;
    }
}

const db1 = new Database();
const db2 = new Database();
console.log(db1 === db2);  // true</code></pre>
            
            <h3>5.3 å¸¸é‡å®šä¹‰</h3>
            <pre><code>// ä½¿ç”¨ Symbol å®šä¹‰å”¯ä¸€å¸¸é‡
const Colors = {
    RED: Symbol('red'),
    GREEN: Symbol('green'),
    BLUE: Symbol('blue')
};

function setColor(color) {
    switch (color) {
        case Colors.RED:
            return '#FF0000';
        case Colors.GREEN:
            return '#00FF00';
        case Colors.BLUE:
            return '#0000FF';
    }
}

console.log(setColor(Colors.RED));  // "#FF0000"</code></pre>
            
            <h2>å…­ã€æœ€ä½³å®è·µ</h2>
            
            <div class="tip">
                <ol>
                    <li><strong>ä½¿ç”¨æè¿°</strong>ï¼šä¾¿äºè°ƒè¯•</li>
                    <li><strong>å…¨å±€ Symbol</strong>ï¼šè·¨æ¨¡å—å…±äº«ç”¨ Symbol.for()</li>
                    <li><strong>Well-Known Symbols</strong>ï¼šè‡ªå®šä¹‰å¯¹è±¡è¡Œä¸º</li>
                    <li><strong>å…ƒæ•°æ®å­˜å‚¨</strong>ï¼šé¿å…å‘½åå†²çª</li>
                    <li><strong>ä¸ä½œä¸ºçœŸæ­£çš„ç§æœ‰</strong>ï¼šå¯ä»¥è¢«åå°„ API è®¿é—®</li>
                </ol>
            </div>
            
            <h2>å‚è€ƒèµ„æ–™</h2>
            <ul>
                <li><a href="https://tc39.es/ecma262/#sec-symbol-objects" target="_blank">ECMAScript - Symbol Objects</a></li>
                <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Symbol" target="_blank">MDN - Symbol</a></li>
            </ul>
            
            <div class="nav-links">
                <a href="24-dynamic-import.html" class="nav-link prev">ä¸Šä¸€èŠ‚ï¼šåŠ¨æ€å¯¼å…¥æœºåˆ¶</a>
                <a href="../index.html" class="nav-link home">è¿”å›é¦–é¡µ</a>
                <a href="25-bigint.html" class="nav-link next">ä¸‹ä¸€èŠ‚ï¼šBigInt è¯¦è§£</a>
            </div>
        </div>
        
        <div class="code-panel">
            <h2 style="color: #60a5fa; margin-bottom: 1.5rem;">ğŸ’» äº¤äº’å¼ä»£ç ç¤ºä¾‹</h2>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 1ï¼šSymbol åŸºç¡€</h3>
                <div class="code-block">
                    <pre><code>// Symbol åŸºç¡€
console.log('=== Symbol åŸºç¡€ ===\n');

const sym1 = Symbol();
const sym2 = Symbol();
console.log('sym1 === sym2:', sym1 === sym2);

const sym = Symbol('mySymbol');
console.log('description:', sym.description);

const global1 = Symbol.for('app.id');
const global2 = Symbol.for('app.id');
console.log('global1 === global2:', global1 === global2);

const key = Symbol.keyFor(global1);
console.log('key:', key);</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 2ï¼šSymbol.iterator</h3>
                <div class="code-block">
                    <pre><code>// è‡ªå®šä¹‰è¿­ä»£å™¨
console.log('=== Symbol.iterator ===\n');

const range = {
    from: 1,
    to: 5,
    
    [Symbol.iterator]() {
        let current = this.from;
        const last = this.to;
        
        return {
            next() {
                if (current <= last) {
                    return { value: current++, done: false };
                }
                return { done: true };
            }
        };
    }
};

console.log('éå† range:');
for (const num of range) {
    console.log('  ' + num);
}</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 3ï¼šSymbol.toPrimitive</h3>
                <div class="code-block">
                    <pre><code>// è‡ªå®šä¹‰ç±»å‹è½¬æ¢
console.log('=== Symbol.toPrimitive ===\n');

const obj = {
    value: 42,
    
    [Symbol.toPrimitive](hint) {
        console.log('  hint:', hint);
        
        if (hint === 'number') {
            return this.value;
        }
        if (hint === 'string') {
            return `Value: ${this.value}`;
        }
        return this.value;
    }
};

console.log('è½¬æ•°å­—:', +obj);
console.log('è½¬å­—ç¬¦ä¸²:', `${obj}`);
console.log('é»˜è®¤:', obj + 1);</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 4ï¼šSymbol ä½œä¸ºå±æ€§é”®</h3>
                <div class="code-block">
                    <pre><code>// Symbol å±æ€§
console.log('=== Symbol å±æ€§ ===\n');

const id = Symbol('id');
const user = {
    name: 'Alice',
    [id]: 123
};

console.log('name:', user.name);
console.log('[id]:', user[id]);

console.log('\nObject.keys():', Object.keys(user));
console.log('Object.getOwnPropertySymbols():',
    Object.getOwnPropertySymbols(user).map(s => s.description));

console.log('\nJSON.stringify():', JSON.stringify(user));</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 5ï¼šWell-Known Symbols</h3>
                <div class="code-block">
                    <pre><code>// Well-Known Symbols
console.log('=== Well-Known Symbols ===\n');

class MyClass {
    get [Symbol.toStringTag]() {
        return 'MyClass';
    }
}

const obj = new MyClass();
console.log('toString():', obj.toString());

const arr = [1, 2];
arr[Symbol.isConcatSpreadable] = false;
console.log('\nconcat with false:', [0].concat(arr));

arr[Symbol.isConcatSpreadable] = true;
console.log('concat with true:', [0].concat(arr));</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 6ï¼šå®é™…åº”ç”¨</h3>
                <div class="code-block">
                    <pre><code>// Symbol å®é™…åº”ç”¨
console.log('=== å®é™…åº”ç”¨ ===\n');

// å¸¸é‡å®šä¹‰
const Status = {
    PENDING: Symbol('pending'),
    FULFILLED: Symbol('fulfilled'),
    REJECTED: Symbol('rejected')
};

console.log('çŠ¶æ€å¸¸é‡:');
console.log('  PENDING:', Status.PENDING.description);
console.log('  FULFILLED:', Status.FULFILLED.description);

// å…ƒæ•°æ®
const metadata = Symbol('metadata');

function tag(obj, data) {
    obj[metadata] = data;
    return obj;
}

const user = tag({ name: 'Alice' }, { 
    created: '2024-01-01' 
});

console.log('\nå…ƒæ•°æ®:', user[metadata]);</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
        </div>
    </div>
    
    <script src="../assets/js/common.js"></script>
</body>
</html>
