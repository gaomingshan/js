<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>表达式与优先级 - JavaScript 深度学习</title>
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/page.css">
</head>
<body>
    <div class="page-layout">
        <div class="doc-panel">
            <h1>表达式与优先级</h1>
            
            <h2>概述</h2>
            <p>表达式是 JavaScript 代码的基本单元，由操作数和运算符组成，求值后产生一个结果。理解表达式的类型和运算符优先级对于编写正确的代码至关重要。</p>
            
            <h2>一、表达式的分类</h2>
            
            <h3>1.1 主表达式（Primary Expressions）</h3>
            <ul>
                <li><strong>字面量</strong>：<code>123</code>, <code>"hello"</code>, <code>true</code>, <code>null</code></li>
                <li><strong>标识符</strong>：<code>x</code>, <code>myVariable</code></li>
                <li><strong>关键字</strong>：<code>this</code>, <code>super</code></li>
                <li><strong>数组字面量</strong>：<code>[1, 2, 3]</code></li>
                <li><strong>对象字面量</strong>：<code>{ a: 1, b: 2 }</code></li>
                <li><strong>函数表达式</strong>：<code>function() {}</code></li>
                <li><strong>类表达式</strong>：<code>class {}</code></li>
            </ul>
            
            <h3>1.2 左值表达式（Left-hand-side Expressions）</h3>
            <ul>
                <li><strong>属性访问</strong>：<code>obj.prop</code>, <code>obj[key]</code></li>
                <li><strong>函数调用</strong>：<code>func()</code></li>
                <li><strong>new 表达式</strong>：<code>new Constructor()</code></li>
                <li><strong>super 调用</strong>：<code>super.method()</code></li>
            </ul>
            
            <h3>1.3 赋值表达式（Assignment Expressions）</h3>
            <pre><code>x = 10
x += 5
x ||= defaultValue</code></pre>
            
            <h3>1.4 条件表达式（Conditional Expressions）</h3>
            <pre><code>condition ? trueValue : falseValue</code></pre>
            
            <h3>1.5 逻辑表达式（Logical Expressions）</h3>
            <pre><code>a && b
a || b
!a</code></pre>
            
            <h3>1.6 算术表达式（Arithmetic Expressions）</h3>
            <pre><code>a + b
a * b
a ** b</code></pre>
            
            <h2>二、语句 vs 表达式</h2>
            
            <div class="info">
                <strong>关键区别：</strong>
                <ul>
                    <li><strong>表达式</strong>：产生一个值</li>
                    <li><strong>语句</strong>：执行一个操作</li>
                </ul>
            </div>
            
            <table>
                <thead>
                    <tr>
                        <th>表达式</th>
                        <th>语句</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>2 + 3</code></td>
                        <td><code>let x = 5;</code></td>
                    </tr>
                    <tr>
                        <td><code>x > 10</code></td>
                        <td><code>if (x > 10) {...}</code></td>
                    </tr>
                    <tr>
                        <td><code>func()</code></td>
                        <td><code>return x;</code></td>
                    </tr>
                    <tr>
                        <td><code>a ? b : c</code></td>
                        <td><code>for (...) {...}</code></td>
                    </tr>
                </tbody>
            </table>
            
            <h3>2.1 表达式语句</h3>
            <p>表达式后加分号就成为语句：</p>
            <pre><code>x + 5;     // 表达式语句（没有意义）
func();    // 表达式语句（有副作用）
x = 10;    // 表达式语句（赋值）</code></pre>
            
            <h2>三、运算符优先级详解</h2>
            
            <h3>3.1 优先级表（从高到低）</h3>
            
            <table>
                <thead>
                    <tr>
                        <th>优先级</th>
                        <th>运算符</th>
                        <th>说明</th>
                        <th>结合性</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>20</td>
                        <td><code>(...)</code></td>
                        <td>分组</td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td>19</td>
                        <td><code>.</code> <code>[]</code> <code>?.()</code></td>
                        <td>成员访问</td>
                        <td>左</td>
                    </tr>
                    <tr>
                        <td>18</td>
                        <td><code>new ... ()</code></td>
                        <td>new（带参数）</td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td>17</td>
                        <td><code>func()</code></td>
                        <td>函数调用</td>
                        <td>左</td>
                    </tr>
                    <tr>
                        <td>16</td>
                        <td><code>new ...</code></td>
                        <td>new（无参数）</td>
                        <td>右</td>
                    </tr>
                    <tr>
                        <td>15</td>
                        <td><code>x++</code> <code>x--</code></td>
                        <td>后置递增/递减</td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td>14</td>
                        <td><code>!x</code> <code>~x</code> <code>+x</code> <code>-x</code> <code>++x</code> <code>--x</code> <code>typeof</code> <code>void</code> <code>delete</code></td>
                        <td>一元运算符</td>
                        <td>右</td>
                    </tr>
                    <tr>
                        <td>13</td>
                        <td><code>**</code></td>
                        <td>幂运算</td>
                        <td>右</td>
                    </tr>
                    <tr>
                        <td>12</td>
                        <td><code>*</code> <code>/</code> <code>%</code></td>
                        <td>乘除取余</td>
                        <td>左</td>
                    </tr>
                    <tr>
                        <td>11</td>
                        <td><code>+</code> <code>-</code></td>
                        <td>加减</td>
                        <td>左</td>
                    </tr>
                    <tr>
                        <td>10</td>
                        <td><code>&lt;&lt;</code> <code>&gt;&gt;</code> <code>&gt;&gt;&gt;</code></td>
                        <td>位移</td>
                        <td>左</td>
                    </tr>
                    <tr>
                        <td>9</td>
                        <td><code>&lt;</code> <code>&gt;</code> <code>&lt;=</code> <code>&gt;=</code> <code>in</code> <code>instanceof</code></td>
                        <td>关系比较</td>
                        <td>左</td>
                    </tr>
                    <tr>
                        <td>8</td>
                        <td><code>==</code> <code>!=</code> <code>===</code> <code>!==</code></td>
                        <td>相等性比较</td>
                        <td>左</td>
                    </tr>
                    <tr>
                        <td>7</td>
                        <td><code>&</code></td>
                        <td>按位与</td>
                        <td>左</td>
                    </tr>
                    <tr>
                        <td>6</td>
                        <td><code>^</code></td>
                        <td>按位异或</td>
                        <td>左</td>
                    </tr>
                    <tr>
                        <td>5</td>
                        <td><code>|</code></td>
                        <td>按位或</td>
                        <td>左</td>
                    </tr>
                    <tr>
                        <td>4</td>
                        <td><code>&&</code></td>
                        <td>逻辑与</td>
                        <td>左</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td><code>||</code> <code>??</code></td>
                        <td>逻辑或/空值合并</td>
                        <td>左</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td><code>? :</code></td>
                        <td>条件运算符</td>
                        <td>右</td>
                    </tr>
                    <tr>
                        <td>1</td>
                        <td><code>=</code> <code>+=</code> <code>-=</code> 等</td>
                        <td>赋值</td>
                        <td>右</td>
                    </tr>
                    <tr>
                        <td>0</td>
                        <td><code>,</code></td>
                        <td>逗号</td>
                        <td>左</td>
                    </tr>
                </tbody>
            </table>
            
            <h3>3.2 结合性（Associativity）</h3>
            
            <div class="spec">
                <strong>左结合性：</strong>
                <pre>a + b + c  →  (a + b) + c</pre>
                
                <strong>右结合性：</strong>
                <pre>a = b = c  →  a = (b = c)
a ** b ** c  →  a ** (b ** c)</pre>
            </div>
            
            <h2>四、常见优先级陷阱</h2>
            
            <h3>4.1 加法与字符串拼接</h3>
            <div class="warning">
                <pre><code>console.log(1 + 2 + "3");    // "33"
console.log("1" + 2 + 3);    // "123"
console.log("1" + (2 + 3));  // "15"</code></pre>
            </div>
            
            <h3>4.2 逻辑运算符优先级</h3>
            <pre><code>true || false && false  // true（&& 优先级高）
(true || false) && false  // false</code></pre>
            
            <h3>4.3 new 运算符</h3>
            <pre><code>new Date().getTime()    // 正确
new Date.getTime()      // 错误！相当于 new (Date.getTime)</code></pre>
            
            <h3>4.4 typeof 与其他运算符</h3>
            <pre><code>typeof 2 + 3        // "number3"（typeof 先执行）
typeof (2 + 3)      // "number"</code></pre>
            
            <h2>五、表达式求值顺序</h2>
            
            <h3>5.1 从左到右求值</h3>
            <p>大多数运算符从左到右求值操作数：</p>
            <pre><code>function a() { console.log('a'); return 1; }
function b() { console.log('b'); return 2; }
a() + b();  // 输出：a, b</code></pre>
            
            <h3>5.2 短路求值</h3>
            <ul>
                <li><code>&&</code>：左侧为假时，不计算右侧</li>
                <li><code>||</code>：左侧为真时，不计算右侧</li>
                <li><code>??</code>：左侧非 null/undefined 时，不计算右侧</li>
            </ul>
            
            <h2>六、最佳实践</h2>
            
            <div class="tip">
                <strong>建议：</strong>
                <ol>
                    <li><strong>使用括号</strong>：明确运算顺序，提高可读性</li>
                    <li><strong>避免复杂表达式</strong>：将复杂表达式拆分为多个简单表达式</li>
                    <li><strong>一行一个操作</strong>：避免在一行内执行多个有副作用的操作</li>
                    <li><strong>注意副作用</strong>：理解哪些表达式有副作用</li>
                    <li><strong>显式类型转换</strong>：不要依赖隐式转换</li>
                </ol>
            </div>
            
            <h2>七、副作用表达式</h2>
            
            <h3>7.1 什么是副作用</h3>
            <p>表达式除了产生值之外，还改变了程序状态：</p>
            
            <ul>
                <li>赋值：<code>x = 10</code></li>
                <li>递增/递减：<code>x++</code></li>
                <li>函数调用：<code>console.log()</code></li>
                <li>对象修改：<code>obj.prop = value</code></li>
                <li>删除属性：<code>delete obj.prop</code></li>
            </ul>
            
            <div class="warning">
                避免在表达式中混合多个副作用，这会降低代码可读性和可维护性。
            </div>
            
            <h2>参考资料</h2>
            <ul>
                <li><a href="https://tc39.es/ecma262/#sec-ecmascript-language-expressions" target="_blank">ECMAScript - Expressions</a></li>
                <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Operator_Precedence" target="_blank">MDN - 运算符优先级</a></li>
                <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Expressions_and_Operators" target="_blank">MDN - 表达式和运算符</a></li>
            </ul>
            
            <div class="nav-links">
                <a href="02-operators.html" class="nav-link prev">上一节：运算符完全指南</a>
                <a href="../index.html" class="nav-link home">返回首页</a>
                <a href="03-conditionals.html" class="nav-link next">下一节：条件语句</a>
            </div>
        </div>
        
        <div class="code-panel">
            <h2 style="color: #60a5fa; margin-bottom: 1.5rem;">💻 交互式代码示例</h2>
            
            <div class="code-example">
                <h3>示例 1：表达式 vs 语句</h3>
                <div class="code-block">
                    <pre><code>// 表达式（产生值）
const expr1 = 2 + 3;
console.log('表达式: 2 + 3 =', expr1);

const expr2 = x => x * 2;
console.log('函数表达式:', expr2);

// 表达式语句
2 + 3;  // 合法但无意义
console.log('执行了表达式语句');

// 语句（不产生值）
let x = 10;
if (x > 5) {
    console.log('if 语句执行');
}

// 条件表达式（三元运算符）
const result = x > 5 ? 'big' : 'small';
console.log('条件表达式结果:', result);</code></pre>
                </div>
                <button class="run-btn">▶ 运行代码</button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>示例 2：优先级陷阱</h3>
                <div class="code-block">
                    <pre><code>// 陷阱1：加法与字符串拼接
console.log('=== 字符串拼接 ===');
console.log('1 + 2 + "3":', 1 + 2 + "3");        // "33"
console.log('"1" + 2 + 3:', "1" + 2 + 3);        // "123"
console.log('"1" + (2 + 3):', "1" + (2 + 3));    // "15"

// 陷阱2：逻辑运算符
console.log('\n=== 逻辑运算符 ===');
console.log('true || false && false:', true || false && false);  // true
console.log('(true || false) && false:', (true || false) && false); // false

// 陷阱3：typeof
console.log('\n=== typeof ===');
console.log('typeof 2 + 3:', typeof 2 + 3);      // "number3"
console.log('typeof (2 + 3):', typeof (2 + 3));  // "number"

// 陷阱4：乘除与加减
console.log('\n=== 乘除与加减 ===');
console.log('2 + 3 * 4:', 2 + 3 * 4);            // 14
console.log('(2 + 3) * 4:', (2 + 3) * 4);        // 20</code></pre>
                </div>
                <button class="run-btn">▶ 运行代码</button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>示例 3：结合性</h3>
                <div class="code-block">
                    <pre><code>// 左结合性
console.log('=== 左结合性 ===');
console.log('10 - 5 - 2:', 10 - 5 - 2);  // (10 - 5) - 2 = 3
console.log('10 / 5 / 2:', 10 / 5 / 2);  // (10 / 5) / 2 = 1

// 右结合性：赋值
console.log('\n=== 右结合性（赋值）===');
let a, b, c;
a = b = c = 10;  // a = (b = (c = 10))
console.log('a = b = c = 10');
console.log('a:', a, 'b:', b, 'c:', c);

// 右结合性：幂运算
console.log('\n=== 右结合性（幂运算）===');
console.log('2 ** 3 ** 2:', 2 ** 3 ** 2);        // 2 ** (3 ** 2) = 512
console.log('(2 ** 3) ** 2:', (2 ** 3) ** 2);    // 64

// 右结合性：条件运算符
console.log('\n=== 条件运算符 ===');
const x = true ? 1 : false ? 2 : 3;
console.log('true ? 1 : false ? 2 : 3 =', x);  // 1</code></pre>
                </div>
                <button class="run-btn">▶ 运行代码</button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>示例 4：求值顺序</h3>
                <div class="code-block">
                    <pre><code>// 从左到右求值
console.log('=== 求值顺序 ===');
let count = 0;

function inc() {
    count++;
    console.log(`inc() 被调用，count = ${count}`);
    return count;
}

const result = inc() + inc() * inc();
console.log('inc() + inc() * inc() =', result);
console.log('注意：先计算 inc() * inc()，再加第一个 inc()');

// 短路求值
console.log('\n=== 短路求值 ===');
count = 0;

const r1 = false && inc();  // inc() 不会被调用
console.log('false && inc(), count =', count);

const r2 = true || inc();   // inc() 不会被调用
console.log('true || inc(), count =', count);

const r3 = true && inc();   // inc() 会被调用
console.log('true && inc(), count =', count);</code></pre>
                </div>
                <button class="run-btn">▶ 运行代码</button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>示例 5：复杂表达式</h3>
                <div class="code-block">
                    <pre><code>// 不推荐：复杂表达式
const bad = 1 + 2 * 3 - 4 / 2 + 5 % 3;
console.log('复杂表达式:', bad);

// 推荐：拆分表达式
const step1 = 2 * 3;        // 6
const step2 = 4 / 2;        // 2
const step3 = 5 % 3;        // 2
const good = 1 + step1 - step2 + step3;
console.log('拆分后:', good);

// 不推荐：多个副作用
let x = 0;
const messy = (x = 5) + (x += 3) + (x *= 2);
console.log('\n多个副作用（不推荐）:', messy, 'x =', x);

// 推荐：清晰的步骤
let y = 0;
y = 5;
y += 3;
y *= 2;
const clear = y;
console.log('清晰步骤（推荐）:', clear, 'y =', y);</code></pre>
                </div>
                <button class="run-btn">▶ 运行代码</button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>示例 6：实用技巧</h3>
                <div class="code-block">
                    <pre><code>// 技巧1：使用括号提高可读性
const price = 100;
const quantity = 5;
const tax = 0.1;

// 不清晰
const total1 = price * quantity + price * quantity * tax;
console.log('不清晰:', total1);

// 清晰
const total2 = (price * quantity) * (1 + tax);
console.log('清晰:', total2);

// 技巧2：避免链式赋值
// 不推荐
let a = b = c = 10;  // b 和 c 可能成为全局变量！

// 推荐
let d, e, f;
d = 10;
e = 10;
f = 10;
console.log('\n独立声明:', d, e, f);

// 技巧3：利用短路求值
const user = null;
const name = user && user.name || 'Guest';
console.log('\n短路求值默认值:', name);

// 更好：使用可选链和空值合并
const name2 = user?.name ?? 'Guest';
console.log('可选链和空值合并:', name2);</code></pre>
                </div>
                <button class="run-btn">▶ 运行代码</button>
                <div class="output"></div>
            </div>
        </div>
    </div>
    
    <script src="../assets/js/common.js"></script>
</body>
</html>
