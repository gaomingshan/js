<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数组高阶方法 - JavaScript 深度学习</title>
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/page.css">
</head>
<body>
    <div class="page-layout">
        <div class="doc-panel">
            <h1>数组高阶方法</h1>
            
            <h2>概述</h2>
            <p>数组的高阶方法是函数式编程在 JavaScript 中的核心应用。这些方法接受函数作为参数，可以极大地简化数组操作。</p>
            
            <h2>一、遍历方法</h2>
            
            <h3>1.1 forEach()</h3>
            <p>遍历数组，对每个元素执行回调函数：</p>
            
            <pre><code>array.forEach((element, index, array) => {
    // 处理每个元素
});</code></pre>
            
            <div class="warning">
                <strong>注意：</strong>
                <ul>
                    <li>无返回值（返回 undefined）</li>
                    <li>不能使用 break/continue</li>
                    <li>不会改变原数组（除非回调中修改）</li>
                </ul>
            </div>
            
            <h3>1.2 map()</h3>
            <p>映射数组，返回新数组：</p>
            
            <pre><code>const doubled = [1, 2, 3].map(x => x * 2);
// [2, 4, 6]</code></pre>
            
            <div class="info">
                <strong>特点：</strong>
                <ul>
                    <li>返回新数组，长度与原数组相同</li>
                    <li>不改变原数组</li>
                    <li>适合数据转换</li>
                </ul>
            </div>
            
            <h2>二、过滤和查找</h2>
            
            <h3>2.1 filter()</h3>
            <p>过滤数组，返回符合条件的元素：</p>
            
            <pre><code>const evens = [1, 2, 3, 4, 5].filter(x => x % 2 === 0);
// [2, 4]</code></pre>
            
            <h3>2.2 find()</h3>
            <p>查找第一个符合条件的元素：</p>
            
            <pre><code>const users = [
    { id: 1, name: 'Alice' },
    { id: 2, name: 'Bob' }
];

const user = users.find(u => u.id === 2);
// { id: 2, name: 'Bob' }</code></pre>
            
            <h3>2.3 findIndex()</h3>
            <p>查找第一个符合条件的元素的索引：</p>
            
            <pre><code>const index = [1, 2, 3, 4].findIndex(x => x > 2);
// 2</code></pre>
            
            <h3>2.4 findLast() / findLastIndex() (ES2023)</h3>
            <p>从数组末尾开始查找：</p>
            
            <pre><code>const arr = [1, 2, 3, 4, 5];
const last = arr.findLast(x => x > 2);  // 5
const lastIndex = arr.findLastIndex(x => x > 2);  // 4</code></pre>
            
            <h2>三、检测方法</h2>
            
            <h3>3.1 some()</h3>
            <p>检测是否至少有一个元素满足条件：</p>
            
            <pre><code>const hasEven = [1, 3, 5, 6].some(x => x % 2 === 0);
// true</code></pre>
            
            <h3>3.2 every()</h3>
            <p>检测是否所有元素都满足条件：</p>
            
            <pre><code>const allPositive = [1, 2, 3, 4].every(x => x > 0);
// true</code></pre>
            
            <h3>3.3 includes()</h3>
            <p>检测数组是否包含某个值：</p>
            
            <pre><code>[1, 2, 3].includes(2);  // true
[1, 2, 3].includes(5);  // false

// 可以指定起始位置
[1, 2, 3, 2].includes(2, 2);  // true</code></pre>
            
            <h2>四、归约方法</h2>
            
            <h3>4.1 reduce()</h3>
            <p>将数组归约为单个值：</p>
            
            <pre><code>array.reduce((accumulator, currentValue, index, array) => {
    // 返回累积值
}, initialValue);</code></pre>
            
            <div class="spec">
                <strong>执行流程：</strong>
                <ol>
                    <li>从初始值（或第一个元素）开始</li>
                    <li>依次处理每个元素</li>
                    <li>将结果传递给下一次迭代</li>
                    <li>返回最终累积值</li>
                </ol>
            </div>
            
            <h3>4.2 reduceRight()</h3>
            <p>从右向左归约：</p>
            
            <pre><code>const result = [1, 2, 3, 4].reduceRight((acc, cur) => acc - cur);
// ((4 - 3) - 2) - 1 = -2</code></pre>
            
            <h2>五、排序和反转</h2>
            
            <h3>5.1 sort()</h3>
            <p>排序数组（会修改原数组）：</p>
            
            <pre><code>// 默认按字符串排序
[3, 1, 4, 1, 5].sort();  // [1, 1, 3, 4, 5]

// 数字排序
[3, 1, 4, 1, 5].sort((a, b) => a - b);  // 升序
[3, 1, 4, 1, 5].sort((a, b) => b - a);  // 降序</code></pre>
            
            <h3>5.2 reverse()</h3>
            <p>反转数组（会修改原数组）：</p>
            
            <pre><code>[1, 2, 3].reverse();  // [3, 2, 1]</code></pre>
            
            <h3>5.3 toSorted() / toReversed() (ES2023)</h3>
            <p>不改变原数组的排序和反转：</p>
            
            <pre><code>const arr = [3, 1, 4];
const sorted = arr.toSorted((a, b) => a - b);
// arr 不变，sorted 是新数组</code></pre>
            
            <h2>六、数组转换</h2>
            
            <h3>6.1 join()</h3>
            <p>将数组元素连接成字符串：</p>
            
            <pre><code>['a', 'b', 'c'].join();      // "a,b,c"
['a', 'b', 'c'].join('-');   // "a-b-c"
['a', 'b', 'c'].join('');    // "abc"</code></pre>
            
            <h3>6.2 flat()</h3>
            <p>扁平化嵌套数组：</p>
            
            <pre><code>[1, [2, 3], [4, [5]]].flat();     // [1, 2, 3, 4, [5]]
[1, [2, 3], [4, [5]]].flat(2);    // [1, 2, 3, 4, 5]
[1, [2, 3], [4, [5]]].flat(Infinity);  // 完全扁平化</code></pre>
            
            <h3>6.3 flatMap()</h3>
            <p>先 map 再 flat(1)：</p>
            
            <pre><code>[1, 2, 3].flatMap(x => [x, x * 2]);
// [1, 2, 2, 4, 3, 6]</code></pre>
            
            <h2>七、切片和拼接</h2>
            
            <h3>7.1 slice()</h3>
            <p>提取数组片段（不改变原数组）：</p>
            
            <pre><code>const arr = [1, 2, 3, 4, 5];
arr.slice(1, 3);   // [2, 3]
arr.slice(2);      // [3, 4, 5]
arr.slice(-2);     // [4, 5]</code></pre>
            
            <h3>7.2 splice()</h3>
            <p>删除/插入/替换元素（会改变原数组）：</p>
            
            <pre><code>const arr = [1, 2, 3, 4, 5];

// 删除
arr.splice(2, 1);  // 从索引 2 删除 1 个元素

// 插入
arr.splice(2, 0, 99);  // 在索引 2 插入 99

// 替换
arr.splice(2, 1, 88);  // 替换索引 2 的元素</code></pre>
            
            <h3>7.3 concat()</h3>
            <p>连接数组（不改变原数组）：</p>
            
            <pre><code>[1, 2].concat([3, 4], [5, 6]);  // [1, 2, 3, 4, 5, 6]

// 或使用扩展运算符
[...[1, 2], ...[3, 4]];</code></pre>
            
            <h2>八、数组去重</h2>
            
            <h3>8.1 使用 Set</h3>
            <pre><code>const arr = [1, 2, 2, 3, 3, 4];
const unique = [...new Set(arr)];
// [1, 2, 3, 4]</code></pre>
            
            <h3>8.2 使用 filter</h3>
            <pre><code>const unique = arr.filter((item, index) => 
    arr.indexOf(item) === index
);</code></pre>
            
            <h2>九、链式调用</h2>
            
            <p>高阶方法可以链式调用，创建数据处理管道：</p>
            
            <pre><code>const result = [1, 2, 3, 4, 5]
    .filter(x => x > 2)      // [3, 4, 5]
    .map(x => x * 2)         // [6, 8, 10]
    .reduce((a, b) => a + b, 0);  // 24</code></pre>
            
            <h2>十、性能考虑</h2>
            
            <div class="tip">
                <strong>性能建议：</strong>
                <ul>
                    <li><strong>单次遍历</strong>：优先使用 reduce 而不是多个 map/filter</li>
                    <li><strong>提前终止</strong>：使用 some/every/find 可以提前结束</li>
                    <li><strong>避免嵌套</strong>：使用 flatMap 代替 map + flat</li>
                    <li><strong>大数组</strong>：考虑使用传统 for 循环</li>
                </ul>
            </div>
            
            <h2>参考资料</h2>
            <ul>
                <li><a href="https://tc39.es/ecma262/#sec-array-objects" target="_blank">ECMAScript - Array Objects</a></li>
                <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array" target="_blank">MDN - Array</a></li>
            </ul>
            
            <div class="nav-links">
                <a href="05-object-methods.html" class="nav-link prev">上一节：对象方法</a>
                <a href="../index.html" class="nav-link home">返回首页</a>
                <a href="06-array-advanced.html" class="nav-link next">下一节：数组高级操作</a>
            </div>
        </div>
        
        <div class="code-panel">
            <h2 style="color: #60a5fa; margin-bottom: 1.5rem;">💻 交互式代码示例</h2>
            
            <div class="code-example">
                <h3>示例 1：map/filter/reduce</h3>
                <div class="code-block">
                    <pre><code>const numbers = [1, 2, 3, 4, 5];

// map - 映射
const doubled = numbers.map(x => x * 2);
console.log('doubled:', doubled);

// filter - 过滤
const evens = numbers.filter(x => x % 2 === 0);
console.log('evens:', evens);

// reduce - 归约
const sum = numbers.reduce((acc, cur) => acc + cur, 0);
console.log('sum:', sum);

// 综合应用
const result = numbers
    .filter(x => x > 2)         // [3, 4, 5]
    .map(x => x * 2)            // [6, 8, 10]
    .reduce((a, b) => a + b, 0); // 24

console.log('链式调用结果:', result);</code></pre>
                </div>
                <button class="run-btn">▶ 运行代码</button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>示例 2：find 和 includes</h3>
                <div class="code-block">
                    <pre><code>const users = [
    { id: 1, name: 'Alice', age: 25 },
    { id: 2, name: 'Bob', age: 30 },
    { id: 3, name: 'Charlie', age: 28 }
];

// find - 查找对象
const user = users.find(u => u.id === 2);
console.log('find:', user);

// findIndex - 查找索引
const index = users.findIndex(u => u.name === 'Charlie');
console.log('findIndex:', index);

// includes - 检查是否包含
const numbers = [1, 2, 3, 4, 5];
console.log('\nincludes(3):', numbers.includes(3));
console.log('includes(6):', numbers.includes(6));

// some - 至少一个满足
const hasAdult = users.some(u => u.age >= 30);
console.log('\nsome(age >= 30):', hasAdult);

// every - 所有都满足
const allAdult = users.every(u => u.age >= 18);
console.log('every(age >= 18):', allAdult);</code></pre>
                </div>
                <button class="run-btn">▶ 运行代码</button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>示例 3：reduce 高级用法</h3>
                <div class="code-block">
                    <pre><code>const numbers = [1, 2, 3, 4, 5];

// 求和
const sum = numbers.reduce((acc, cur) => acc + cur, 0);
console.log('sum:', sum);

// 求乘积
const product = numbers.reduce((acc, cur) => acc * cur, 1);
console.log('product:', product);

// 统计出现次数
const fruits = ['apple', 'banana', 'apple', 'orange', 'banana', 'apple'];
const count = fruits.reduce((acc, fruit) => {
    acc[fruit] = (acc[fruit] || 0) + 1;
    return acc;
}, {});
console.log('\ncount:', count);

// 数组扁平化
const nested = [[1, 2], [3, 4], [5, 6]];
const flattened = nested.reduce((acc, cur) => acc.concat(cur), []);
console.log('\nflattened:', flattened);

// 分组
const people = [
    { name: 'Alice', age: 25 },
    { name: 'Bob', age: 30 },
    { name: 'Charlie', age: 25 }
];
const grouped = people.reduce((acc, person) => {
    const key = person.age;
    if (!acc[key]) acc[key] = [];
    acc[key].push(person);
    return acc;
}, {});
console.log('\ngrouped:', grouped);</code></pre>
                </div>
                <button class="run-btn">▶ 运行代码</button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>示例 4：sort 排序</h3>
                <div class="code-block">
                    <pre><code>// 数字排序
const numbers = [3, 1, 4, 1, 5, 9, 2, 6];
console.log('升序:', [...numbers].sort((a, b) => a - b));
console.log('降序:', [...numbers].sort((a, b) => b - a));

// 字符串排序
const fruits = ['banana', 'apple', 'cherry', 'date'];
console.log('\n字母序:', [...fruits].sort());

// 对象排序
const users = [
    { name: 'Charlie', age: 28 },
    { name: 'Alice', age: 25 },
    { name: 'Bob', age: 30 }
];

const byAge = [...users].sort((a, b) => a.age - b.age);
console.log('\n按年龄排序:');
byAge.forEach(u => console.log(`  ${u.name}: ${u.age}`));

const byName = [...users].sort((a, b) => a.name.localeCompare(b.name));
console.log('按名字排序:');
byName.forEach(u => console.log(`  ${u.name}: ${u.age}`));</code></pre>
                </div>
                <button class="run-btn">▶ 运行代码</button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>示例 5：flat 和 flatMap</h3>
                <div class="code-block">
                    <pre><code>// flat - 扁平化
const nested1 = [1, [2, 3], [4, [5, 6]]];
console.log('flat():', nested1.flat());
console.log('flat(2):', nested1.flat(2));
console.log('flat(Infinity):', nested1.flat(Infinity));

// flatMap - map + flat(1)
const numbers = [1, 2, 3];
const mapped = numbers.map(x => [x, x * 2]);
console.log('\nmap:', mapped);

const flatMapped = numbers.flatMap(x => [x, x * 2]);
console.log('flatMap:', flatMapped);

// 实用例子：处理句子
const sentences = ['Hello World', 'JavaScript is Great'];
const words = sentences.flatMap(s => s.split(' '));
console.log('\n单词列表:', words);

// 过滤 + 映射
const data = [1, 2, 3, 4, 5];
const result = data.flatMap(x => 
    x % 2 === 0 ? [x, x * 2] : []
);
console.log('\n条件映射:', result);</code></pre>
                </div>
                <button class="run-btn">▶ 运行代码</button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>示例 6：实用技巧</h3>
                <div class="code-block">
                    <pre><code>// 技巧1：数组去重
const arr = [1, 2, 2, 3, 3, 4, 5, 5];
const unique = [...new Set(arr)];
console.log('去重:', unique);

// 技巧2：数组求最大/最小值
const numbers = [3, 1, 4, 1, 5, 9, 2, 6];
const max = Math.max(...numbers);
const min = Math.min(...numbers);
console.log('\nmax:', max, 'min:', min);

// 技巧3：数组分块
function chunk(arr, size) {
    return arr.reduce((acc, _, i) => {
        if (i % size === 0) {
            acc.push(arr.slice(i, i + size));
        }
        return acc;
    }, []);
}
console.log('\nchunk([1,2,3,4,5,6], 2):', chunk([1,2,3,4,5,6], 2));

// 技巧4：数组交集
const arr1 = [1, 2, 3, 4];
const arr2 = [3, 4, 5, 6];
const intersection = arr1.filter(x => arr2.includes(x));
console.log('\n交集:', intersection);

// 技巧5：数组差集
const difference = arr1.filter(x => !arr2.includes(x));
console.log('差集:', difference);

// 技巧6：数组求平均值
const avg = numbers.reduce((a, b) => a + b, 0) / numbers.length;
console.log('\n平均值:', avg);</code></pre>
                </div>
                <button class="run-btn">▶ 运行代码</button>
                <div class="output"></div>
            </div>
        </div>
    </div>
    
    <script src="../assets/js/common.js"></script>
</body>
</html>
