<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>this ç»‘å®šè§„åˆ™ - JavaScript æ·±åº¦å­¦ä¹ </title>
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/page.css">
</head>
<body>
    <div class="page-layout">
        <div class="doc-panel">
            <h1>this ç»‘å®šè§„åˆ™</h1>
            
            <h2>æ¦‚è¿°</h2>
            <p><code>this</code> æ˜¯ JavaScript ä¸­æœ€å®¹æ˜“æ··æ·†çš„æ¦‚å¿µä¹‹ä¸€ã€‚<code>this</code> çš„å€¼ä¸æ˜¯åœ¨å®šä¹‰æ—¶ç¡®å®šï¼Œè€Œæ˜¯åœ¨è°ƒç”¨æ—¶ç¡®å®šï¼Œå–å†³äºå‡½æ•°çš„è°ƒç”¨æ–¹å¼ã€‚</p>
            
            <h2>ä¸€ã€this çš„å››ç§ç»‘å®šè§„åˆ™</h2>
            
            <h3>1.1 é»˜è®¤ç»‘å®šï¼ˆDefault Bindingï¼‰</h3>
            <p>ç‹¬ç«‹å‡½æ•°è°ƒç”¨æ—¶ï¼Œ<code>this</code> æŒ‡å‘å…¨å±€å¯¹è±¡ï¼ˆéä¸¥æ ¼æ¨¡å¼ï¼‰æˆ– <code>undefined</code>ï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰ã€‚</p>
            
            <pre><code>function test() {
    console.log(this);
}

test();  // éä¸¥æ ¼: window/globalï¼Œä¸¥æ ¼: undefined</code></pre>
            
            <h3>1.2 éšå¼ç»‘å®šï¼ˆImplicit Bindingï¼‰</h3>
            <p>é€šè¿‡å¯¹è±¡è°ƒç”¨å‡½æ•°æ—¶ï¼Œ<code>this</code> æŒ‡å‘è¯¥å¯¹è±¡ã€‚</p>
            
            <pre><code>const obj = {
    name: 'Alice',
    greet() {
        console.log(this.name);
    }
};

obj.greet();  // this æŒ‡å‘ obj</code></pre>
            
            <div class="warning">
                <strong>éšå¼ç»‘å®šä¸¢å¤±ï¼š</strong>
                <pre><code>const fn = obj.greet;
fn();  // this ä¸¢å¤±ï¼Œå˜æˆé»˜è®¤ç»‘å®š</code></pre>
            </div>
            
            <h3>1.3 æ˜¾å¼ç»‘å®šï¼ˆExplicit Bindingï¼‰</h3>
            <p>ä½¿ç”¨ <code>call</code>ã€<code>apply</code> æˆ– <code>bind</code> æ˜¾å¼æŒ‡å®š <code>this</code>ã€‚</p>
            
            <pre><code>function greet() {
    console.log(this.name);
}

const person = { name: 'Bob' };

greet.call(person);   // this æŒ‡å‘ person
greet.apply(person);  // this æŒ‡å‘ person

const boundGreet = greet.bind(person);
boundGreet();         // this æŒ‡å‘ person</code></pre>
            
            <h3>1.4 new ç»‘å®šï¼ˆnew Bindingï¼‰</h3>
            <p>ä½¿ç”¨ <code>new</code> è°ƒç”¨æ„é€ å‡½æ•°æ—¶ï¼Œ<code>this</code> æŒ‡å‘æ–°åˆ›å»ºçš„å¯¹è±¡ã€‚</p>
            
            <pre><code>function Person(name) {
    this.name = name;
}

const alice = new Person('Alice');
// this æŒ‡å‘æ–°åˆ›å»ºçš„å¯¹è±¡ alice</code></pre>
            
            <h2>äºŒã€ç»‘å®šä¼˜å…ˆçº§</h2>
            
            <div class="spec">
                <strong>ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š</strong>
                <ol>
                    <li><strong>new ç»‘å®š</strong>ï¼š<code>new Foo()</code></li>
                    <li><strong>æ˜¾å¼ç»‘å®š</strong>ï¼š<code>foo.call(obj)</code>, <code>foo.bind(obj)</code></li>
                    <li><strong>éšå¼ç»‘å®š</strong>ï¼š<code>obj.foo()</code></li>
                    <li><strong>é»˜è®¤ç»‘å®š</strong>ï¼š<code>foo()</code></li>
                </ol>
            </div>
            
            <h2>ä¸‰ã€ç®­å¤´å‡½æ•°çš„ this</h2>
            
            <h3>3.1 è¯æ³• this</h3>
            <p>ç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„ <code>this</code>ï¼Œä¼šæ•è·å®šä¹‰æ—¶å¤–å±‚ä½œç”¨åŸŸçš„ <code>this</code>ã€‚</p>
            
            <pre><code>const obj = {
    name: 'Alice',
    greet: function() {
        setTimeout(() => {
            console.log(this.name);  // this æ¥è‡ª greet
        }, 100);
    }
};

obj.greet();  // "Alice"</code></pre>
            
            <h3>3.2 ç®­å¤´å‡½æ•°ç‰¹æ€§</h3>
            <ul>
                <li>æ²¡æœ‰è‡ªå·±çš„ <code>this</code></li>
                <li>ä¸èƒ½ç”¨ä½œæ„é€ å‡½æ•°</li>
                <li><code>call</code>ã€<code>apply</code>ã€<code>bind</code> æ— æ³•æ”¹å˜å…¶ <code>this</code></li>
                <li>æ²¡æœ‰ <code>arguments</code> å¯¹è±¡</li>
            </ul>
            
            <h2>å››ã€å¸¸è§é™·é˜±</h2>
            
            <h3>4.1 éšå¼ç»‘å®šä¸¢å¤±</h3>
            <div class="warning">
                <pre><code>const obj = {
    name: 'Alice',
    greet() {
        console.log(this.name);
    }
};

// é™·é˜±1ï¼šèµ‹å€¼ç»™å˜é‡
const fn = obj.greet;
fn();  // undefinedï¼ˆé»˜è®¤ç»‘å®šï¼‰

// é™·é˜±2ï¼šä½œä¸ºå›è°ƒä¼ é€’
setTimeout(obj.greet, 100);  // undefined

// è§£å†³æ–¹æ¡ˆ
setTimeout(() => obj.greet(), 100);  // æ­£ç¡®
setTimeout(obj.greet.bind(obj), 100);  // æ­£ç¡®</code></pre>
            </div>
            
            <h3>4.2 å¯¹è±¡æ–¹æ³•ä¸­çš„åµŒå¥—å‡½æ•°</h3>
            <pre><code>const obj = {
    name: 'Alice',
    greet() {
        function inner() {
            console.log(this.name);  // undefined
        }
        inner();  // é»˜è®¤ç»‘å®š
    }
};

// è§£å†³æ–¹æ¡ˆ1ï¼šç®­å¤´å‡½æ•°
const obj2 = {
    name: 'Alice',
    greet() {
        const inner = () => {
            console.log(this.name);  // "Alice"
        };
        inner();
    }
};

// è§£å†³æ–¹æ¡ˆ2ï¼šä¿å­˜ this
const obj3 = {
    name: 'Alice',
    greet() {
        const self = this;
        function inner() {
            console.log(self.name);  // "Alice"
        }
        inner();
    }
};</code></pre>
            
            <h3>4.3 äº‹ä»¶å¤„ç†å™¨ä¸­çš„ this</h3>
            <pre><code>// DOM äº‹ä»¶å¤„ç†å™¨
button.addEventListener('click', function() {
    console.log(this);  // æŒ‡å‘ button å…ƒç´ 
});

button.addEventListener('click', () => {
    console.log(this);  // æŒ‡å‘å¤–å±‚ä½œç”¨åŸŸçš„ this
});</code></pre>
            
            <h2>äº”ã€callã€applyã€bind è¯¦è§£</h2>
            
            <h3>5.1 call()</h3>
            <p>ç«‹å³è°ƒç”¨å‡½æ•°ï¼ŒæŒ‡å®š <code>this</code> å’Œå‚æ•°åˆ—è¡¨ã€‚</p>
            <pre><code>func.call(thisArg, arg1, arg2, ...)</code></pre>
            
            <h3>5.2 apply()</h3>
            <p>ç«‹å³è°ƒç”¨å‡½æ•°ï¼ŒæŒ‡å®š <code>this</code> å’Œå‚æ•°æ•°ç»„ã€‚</p>
            <pre><code>func.apply(thisArg, [arg1, arg2, ...])</code></pre>
            
            <h3>5.3 bind()</h3>
            <p>è¿”å›ä¸€ä¸ªæ–°å‡½æ•°ï¼Œæ°¸ä¹…ç»‘å®š <code>this</code>ã€‚</p>
            <pre><code>const boundFunc = func.bind(thisArg, arg1, arg2, ...)</code></pre>
            
            <h3>5.4 åŒºåˆ«å¯¹æ¯”</h3>
            <table>
                <thead>
                    <tr>
                        <th>æ–¹æ³•</th>
                        <th>æ‰§è¡Œæ—¶æœº</th>
                        <th>å‚æ•°å½¢å¼</th>
                        <th>è¿”å›å€¼</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>call</td>
                        <td>ç«‹å³æ‰§è¡Œ</td>
                        <td>é€ä¸ªä¼ é€’</td>
                        <td>å‡½æ•°è¿”å›å€¼</td>
                    </tr>
                    <tr>
                        <td>apply</td>
                        <td>ç«‹å³æ‰§è¡Œ</td>
                        <td>æ•°ç»„ä¼ é€’</td>
                        <td>å‡½æ•°è¿”å›å€¼</td>
                    </tr>
                    <tr>
                        <td>bind</td>
                        <td>ç¨åæ‰§è¡Œ</td>
                        <td>é€ä¸ªä¼ é€’</td>
                        <td>ç»‘å®šåçš„æ–°å‡½æ•°</td>
                    </tr>
                </tbody>
            </table>
            
            <h2>å…­ã€å®ç”¨æŠ€å·§</h2>
            
            <h3>6.1 å€Ÿç”¨æ–¹æ³•</h3>
            <pre><code>// å€Ÿç”¨æ•°ç»„æ–¹æ³•
const arrayLike = { 0: 'a', 1: 'b', length: 2 };
const result = Array.prototype.slice.call(arrayLike);
// æˆ–
const result = [].slice.call(arrayLike);</code></pre>
            
            <h3>6.2 å‡½æ•°æŸ¯é‡ŒåŒ–</h3>
            <pre><code>function greet(greeting, name) {
    return `${greeting}, ${name}!`;
}

const sayHello = greet.bind(null, 'Hello');
sayHello('Alice');  // "Hello, Alice!"</code></pre>
            
            <h3>6.3 ç±»æ–¹æ³•ç»‘å®š</h3>
            <pre><code>class Button {
    constructor(label) {
        this.label = label;
        // åœ¨æ„é€ å‡½æ•°ä¸­ç»‘å®š
        this.handleClick = this.handleClick.bind(this);
    }
    
    handleClick() {
        console.log(`Clicked: ${this.label}`);
    }
}</code></pre>
            
            <h2>ä¸ƒã€æœ€ä½³å®è·µ</h2>
            
            <div class="tip">
                <ol>
                    <li><strong>ä¼˜å…ˆä½¿ç”¨ç®­å¤´å‡½æ•°</strong>ï¼šé¿å… this ç›¸å…³é—®é¢˜</li>
                    <li><strong>æ˜ç¡® this æ¥æº</strong>ï¼šä¸è¦ä¾èµ–éšå¼ç»‘å®š</li>
                    <li><strong>ä½¿ç”¨ bind</strong>ï¼šæ°¸ä¹…ç»‘å®š thisï¼Œé¿å…ä¸¢å¤±</li>
                    <li><strong>ä¸¥æ ¼æ¨¡å¼</strong>ï¼šè®© this é—®é¢˜æ›´æ—©æš´éœ²</li>
                    <li><strong>é¿å…åœ¨ç®­å¤´å‡½æ•°ä¸­ä½¿ç”¨ this</strong>ï¼šé™¤éæ˜ç¡®éœ€è¦è¯æ³• this</li>
                    <li><strong>ç±»å­—æ®µè¯­æ³•</strong>ï¼šä½¿ç”¨ç±»å­—æ®µè‡ªåŠ¨ç»‘å®šæ–¹æ³•</li>
                </ol>
            </div>
            
            <h2>å…«ã€åˆ¤æ–­ this çš„æ­¥éª¤</h2>
            
            <div class="info">
                <strong>åˆ¤æ–­æµç¨‹ï¼š</strong>
                <ol>
                    <li>æ˜¯ç®­å¤´å‡½æ•°å—ï¼Ÿâ†’ ä½¿ç”¨å¤–å±‚ä½œç”¨åŸŸçš„ this</li>
                    <li>ç”¨ new è°ƒç”¨å—ï¼Ÿâ†’ this æŒ‡å‘æ–°å¯¹è±¡</li>
                    <li>ç”¨ call/apply/bind è°ƒç”¨å—ï¼Ÿâ†’ this æŒ‡å‘æŒ‡å®šå¯¹è±¡</li>
                    <li>é€šè¿‡å¯¹è±¡è°ƒç”¨å—ï¼Ÿâ†’ this æŒ‡å‘è¯¥å¯¹è±¡</li>
                    <li>å¦åˆ™ â†’ é»˜è®¤ç»‘å®šï¼ˆå…¨å±€å¯¹è±¡æˆ– undefinedï¼‰</li>
                </ol>
            </div>
            
            <h2>å‚è€ƒèµ„æ–™</h2>
            <ul>
                <li><a href="https://tc39.es/ecma262/#sec-this-keyword" target="_blank">ECMAScript - this Keyword</a></li>
                <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/this" target="_blank">MDN - this</a></li>
                <li><a href="https://github.com/getify/You-Dont-Know-JS/blob/2nd-ed/this%20%26%20object%20prototypes/ch2.md" target="_blank">You Don't Know JS - this</a></li>
            </ul>
            
            <div class="nav-links">
                <a href="04-function-basics.html" class="nav-link prev">ä¸Šä¸€èŠ‚ï¼šå‡½æ•°åŸºç¡€</a>
                <a href="../index.html" class="nav-link home">è¿”å›é¦–é¡µ</a>
                <a href="04-arrow-function.html" class="nav-link next">ä¸‹ä¸€èŠ‚ï¼šç®­å¤´å‡½æ•°</a>
            </div>
        </div>
        
        <div class="code-panel">
            <h2 style="color: #60a5fa; margin-bottom: 1.5rem;">ğŸ’» äº¤äº’å¼ä»£ç ç¤ºä¾‹</h2>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 1ï¼šå››ç§ç»‘å®šè§„åˆ™</h3>
                <div class="code-block">
                    <pre><code>// 1. é»˜è®¤ç»‘å®š
function showThis1() {
    console.log('é»˜è®¤ç»‘å®š this:', this);
}
showThis1();  // window (éä¸¥æ ¼) æˆ– undefined (ä¸¥æ ¼)

// 2. éšå¼ç»‘å®š
const obj = {
    name: 'Alice',
    showThis: function() {
        console.log('éšå¼ç»‘å®š this.name:', this.name);
    }
};
obj.showThis();  // this æŒ‡å‘ obj

// 3. æ˜¾å¼ç»‘å®š
function greet() {
    console.log('æ˜¾å¼ç»‘å®š this.name:', this.name);
}
const person = { name: 'Bob' };
greet.call(person);

// 4. new ç»‘å®š
function Person(name) {
    this.name = name;
    console.log('new ç»‘å®š this.name:', this.name);
}
const alice = new Person('Alice');</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 2ï¼šéšå¼ç»‘å®šä¸¢å¤±</h3>
                <div class="code-block">
                    <pre><code>const obj = {
    name: 'Alice',
    greet: function() {
        console.log('Hello,', this.name);
    }
};

// æ­£å¸¸è°ƒç”¨
console.log('=== æ­£å¸¸è°ƒç”¨ ===');
obj.greet();  // "Hello, Alice"

// é™·é˜±1ï¼šèµ‹å€¼ç»™å˜é‡
console.log('\n=== èµ‹å€¼ç»™å˜é‡ ===');
const fn = obj.greet;
fn();  // "Hello, undefined"

// é™·é˜±2ï¼šä¼ é€’ç»™ setTimeout
console.log('\n=== ä¼ é€’ç»™å›è°ƒ ===');
setTimeout(obj.greet, 10);  // "Hello, undefined"

// è§£å†³æ–¹æ¡ˆ1ï¼šåŒ…è£…å‡½æ•°
setTimeout(() => obj.greet(), 20);  // "Hello, Alice"

// è§£å†³æ–¹æ¡ˆ2ï¼šbind
setTimeout(obj.greet.bind(obj), 30);  // "Hello, Alice"</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 3ï¼šç®­å¤´å‡½æ•°çš„ this</h3>
                <div class="code-block">
                    <pre><code>// æ™®é€šå‡½æ•° vs ç®­å¤´å‡½æ•°
const obj = {
    name: 'Alice',
    
    // æ™®é€šå‡½æ•°
    greet1: function() {
        setTimeout(function() {
            console.log('æ™®é€šå‡½æ•°:', this.name);  // undefined
        }, 10);
    },
    
    // ç®­å¤´å‡½æ•°
    greet2: function() {
        setTimeout(() => {
            console.log('ç®­å¤´å‡½æ•°:', this.name);  // "Alice"
        }, 20);
    },
    
    // å®Œå…¨ä½¿ç”¨ç®­å¤´å‡½æ•°
    greet3: () => {
        console.log('å¤–å±‚ç®­å¤´å‡½æ•°:', this.name);  // undefined
    }
};

obj.greet1();
obj.greet2();
obj.greet3();</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 4ï¼šcallã€applyã€bind</h3>
                <div class="code-block">
                    <pre><code>function introduce(greeting, punctuation) {
    return `${greeting}, I'm ${this.name}${punctuation}`;
}

const person1 = { name: 'Alice' };
const person2 = { name: 'Bob' };

// call - ç«‹å³æ‰§è¡Œï¼Œå‚æ•°é€ä¸ªä¼ é€’
console.log('call:', introduce.call(person1, 'Hello', '!'));

// apply - ç«‹å³æ‰§è¡Œï¼Œå‚æ•°æ•°ç»„ä¼ é€’
console.log('apply:', introduce.apply(person2, ['Hi', '.']));

// bind - è¿”å›æ–°å‡½æ•°
const boundIntroduce = introduce.bind(person1, 'Hey');
console.log('bind:', boundIntroduce('~'));

// bind å¯ä»¥éƒ¨åˆ†åº”ç”¨å‚æ•°
const greetAlice = introduce.bind(person1);
console.log('éƒ¨åˆ†åº”ç”¨:', greetAlice('Good morning', '!'));

// bind æ— æ³•è¢«è¦†ç›–
const bound = introduce.bind(person1);
console.log('bind åå† call:', bound.call(person2, 'Hi', '!'));
// ä»ç„¶ä½¿ç”¨ person1</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 5ï¼šç»‘å®šä¼˜å…ˆçº§</h3>
                <div class="code-block">
                    <pre><code>function showName() {
    console.log(this.name);
}

const obj1 = { name: 'obj1' };
const obj2 = { name: 'obj2' };

// éšå¼ç»‘å®š vs æ˜¾å¼ç»‘å®š
console.log('=== ä¼˜å…ˆçº§æµ‹è¯• ===');
const obj = {
    name: 'implicit',
    show: showName
};

obj.show();  // éšå¼ç»‘å®š: "implicit"
obj.show.call(obj1);  // æ˜¾å¼ç»‘å®šä¼˜å…ˆ: "obj1"

// bind vs call
const boundShow = showName.bind(obj1);
boundShow();  // "obj1"
boundShow.call(obj2);  // bind ä¼˜å…ˆ: "obj1"

// new vs bind
function Person(name) {
    this.name = name;
}

const BoundPerson = Person.bind({ name: 'ignored' });
const person = new BoundPerson('Alice');
console.log('\nnew vs bind:', person.name);  // new ä¼˜å…ˆ: "Alice"</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 6ï¼šå®ç”¨æŠ€å·§</h3>
                <div class="code-block">
                    <pre><code>// æŠ€å·§1ï¼šå€Ÿç”¨æ•°ç»„æ–¹æ³•
console.log('=== å€Ÿç”¨æ–¹æ³• ===');
const arrayLike = {
    0: 'a',
    1: 'b',
    2: 'c',
    length: 3
};

const arr = Array.prototype.slice.call(arrayLike);
console.log('è½¬æ¢ä¸ºæ•°ç»„:', arr);
console.log('æ˜¯æ•°ç»„:', Array.isArray(arr));

// æŠ€å·§2ï¼šå‡½æ•°æŸ¯é‡ŒåŒ–
console.log('\n=== æŸ¯é‡ŒåŒ– ===');
function multiply(a, b) {
    return a * b;
}

const double = multiply.bind(null, 2);
const triple = multiply.bind(null, 3);

console.log('double(5):', double(5));
console.log('triple(5):', triple(5));

// æŠ€å·§3ï¼šä¿å­˜ this
console.log('\n=== ä¿å­˜ this ===');
const counter = {
    count: 0,
    increment: function() {
        const self = this;  // ä¿å­˜ this
        
        setInterval(function() {
            self.count++;
            console.log('Count:', self.count);
            if (self.count >= 3) {
                console.log('å®Œæˆ');
            }
        }, 100);
    }
};

// counter.increment();  // å–æ¶ˆæ³¨é‡ŠæŸ¥çœ‹æ•ˆæœ</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
        </div>
    </div>
    
    <script src="../assets/js/common.js"></script>
</body>
</html>
