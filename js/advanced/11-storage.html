<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ¬åœ°å­˜å‚¨æ–¹æ¡ˆ - JavaScript æ·±åº¦å­¦ä¹ </title>
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/page.css">
</head>
<body>
    <div class="page-layout">
        <div class="doc-panel">
            <h1>æœ¬åœ°å­˜å‚¨æ–¹æ¡ˆ</h1>
            
            <h2>æ¦‚è¿°</h2>
            <p>æµè§ˆå™¨æä¾›äº†å¤šç§æœ¬åœ°å­˜å‚¨æ–¹æ¡ˆï¼Œç”¨äºåœ¨å®¢æˆ·ç«¯ä¿å­˜æ•°æ®ã€‚å¸¸ç”¨çš„æœ‰ Cookieã€localStorageã€sessionStorage å’Œ IndexedDBã€‚</p>
            
            <h2>ä¸€ã€localStorage</h2>
            
            <h3>1.1 åŸºæœ¬ä½¿ç”¨</h3>
            <pre><code>// è®¾ç½®æ•°æ®
localStorage.setItem('name', 'Alice');
localStorage.setItem('age', '25');

// è·å–æ•°æ®
const name = localStorage.getItem('name');

// åˆ é™¤æ•°æ®
localStorage.removeItem('name');

// æ¸…ç©ºæ‰€æœ‰æ•°æ®
localStorage.clear();

// è·å–é”®å
const key = localStorage.key(0);

// æ•°æ®æ•°é‡
const length = localStorage.length;</code></pre>
            
            <h3>1.2 å­˜å‚¨å¯¹è±¡</h3>
            <pre><code>// å­˜å‚¨å¯¹è±¡ï¼ˆéœ€è¦åºåˆ—åŒ–ï¼‰
const user = { name: 'Alice', age: 25 };
localStorage.setItem('user', JSON.stringify(user));

// è¯»å–å¯¹è±¡
const storedUser = JSON.parse(localStorage.getItem('user'));</code></pre>
            
            <h3>1.3 ç‰¹æ€§</h3>
            <div class="info">
                <ul>
                    <li><strong>æŒä¹…åŒ–</strong>ï¼šæ•°æ®æ°¸ä¹…ä¿å­˜ï¼Œé™¤éæ‰‹åŠ¨åˆ é™¤</li>
                    <li><strong>å®¹é‡</strong>ï¼šé€šå¸¸ 5-10MB</li>
                    <li><strong>ä½œç”¨åŸŸ</strong>ï¼šåŒæºï¼ˆåè®®ã€åŸŸåã€ç«¯å£ï¼‰</li>
                    <li><strong>åŒæ­¥</strong>ï¼šåŒæ­¥ APIï¼Œå¯èƒ½é˜»å¡</li>
                </ul>
            </div>
            
            <h2>äºŒã€sessionStorage</h2>
            
            <h3>2.1 åŸºæœ¬ä½¿ç”¨</h3>
            <pre><code>// API ä¸ localStorage ç›¸åŒ
sessionStorage.setItem('temp', 'value');
const temp = sessionStorage.getItem('temp');
sessionStorage.removeItem('temp');
sessionStorage.clear();</code></pre>
            
            <h3>2.2 ç‰¹æ€§</h3>
            <div class="info">
                <ul>
                    <li><strong>ä¼šè¯çº§</strong>ï¼šæ ‡ç­¾é¡µå…³é—­åæ•°æ®æ¸…é™¤</li>
                    <li><strong>å®¹é‡</strong>ï¼šé€šå¸¸ 5-10MB</li>
                    <li><strong>ä½œç”¨åŸŸ</strong>ï¼šåŒæº + åŒæ ‡ç­¾é¡µ</li>
                    <li><strong>éš”ç¦»</strong>ï¼šä¸åŒæ ‡ç­¾é¡µæ•°æ®éš”ç¦»</li>
                </ul>
            </div>
            
            <h2>ä¸‰ã€localStorage vs sessionStorage</h2>
            
            <table>
                <thead>
                    <tr>
                        <th>ç‰¹æ€§</th>
                        <th>localStorage</th>
                        <th>sessionStorage</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>ç”Ÿå‘½å‘¨æœŸ</td>
                        <td>æ°¸ä¹…</td>
                        <td>æ ‡ç­¾é¡µå…³é—­</td>
                    </tr>
                    <tr>
                        <td>ä½œç”¨åŸŸ</td>
                        <td>åŒæºæ‰€æœ‰æ ‡ç­¾é¡µ</td>
                        <td>åŒæºåŒæ ‡ç­¾é¡µ</td>
                    </tr>
                    <tr>
                        <td>å®¹é‡</td>
                        <td>5-10MB</td>
                        <td>5-10MB</td>
                    </tr>
                    <tr>
                        <td>API</td>
                        <td>åŒæ­¥</td>
                        <td>åŒæ­¥</td>
                    </tr>
                </tbody>
            </table>
            
            <h2>å››ã€Cookie</h2>
            
            <h3>4.1 æ“ä½œ Cookie</h3>
            <pre><code>// è®¾ç½® Cookie
document.cookie = 'name=Alice';
document.cookie = 'age=25; max-age=3600';  // 1å°æ—¶åè¿‡æœŸ

// è¯»å– Cookie
console.log(document.cookie);  // "name=Alice; age=25"

// è§£æ Cookie
function getCookie(name) {
    const matches = document.cookie.match(
        new RegExp(`(?:^|; )${name}=([^;]*)`)
    );
    return matches ? decodeURIComponent(matches[1]) : null;
}

// åˆ é™¤ Cookie
document.cookie = 'name=; max-age=0';</code></pre>
            
            <h3>4.2 Cookie å±æ€§</h3>
            <pre><code>document.cookie = 'name=Alice; ' +
    'max-age=3600; ' +        // è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰
    'path=/; ' +              // è·¯å¾„
    'domain=.example.com; ' + // åŸŸå
    'secure; ' +              // ä»… HTTPS
    'samesite=strict';        // é˜² CSRF</code></pre>
            
            <h3>4.3 ç‰¹æ€§</h3>
            <div class="info">
                <ul>
                    <li><strong>å®¹é‡</strong>ï¼šæ¯ä¸ª Cookie 4KBï¼Œæ¯ä¸ªåŸŸåçº¦ 50 ä¸ª</li>
                    <li><strong>è‡ªåŠ¨å‘é€</strong>ï¼šæ¯æ¬¡è¯·æ±‚è‡ªåŠ¨æºå¸¦</li>
                    <li><strong>è¿‡æœŸæ—¶é—´</strong>ï¼šå¯è®¾ç½®è¿‡æœŸæ—¶é—´</li>
                    <li><strong>HttpOnly</strong>ï¼šæœåŠ¡å™¨å¯è®¾ç½® JS æ— æ³•è®¿é—®</li>
                </ul>
            </div>
            
            <h2>äº”ã€IndexedDB</h2>
            
            <h3>5.1 ä»€ä¹ˆæ˜¯ IndexedDB</h3>
            <p>IndexedDB æ˜¯æµè§ˆå™¨æä¾›çš„å¤§å®¹é‡ã€äº‹åŠ¡æ€§çš„å®¢æˆ·ç«¯æ•°æ®åº“ã€‚</p>
            
            <h3>5.2 åŸºæœ¬ä½¿ç”¨</h3>
            <pre><code>// æ‰“å¼€æ•°æ®åº“
const request = indexedDB.open('myDB', 1);

request.onupgradeneeded = (event) => {
    const db = event.target.result;
    // åˆ›å»ºå¯¹è±¡å­˜å‚¨
    const store = db.createObjectStore('users', { keyPath: 'id' });
    store.createIndex('name', 'name', { unique: false });
};

request.onsuccess = (event) => {
    const db = event.target.result;
    
    // æ·»åŠ æ•°æ®
    const tx = db.transaction('users', 'readwrite');
    const store = tx.objectStore('users');
    store.add({ id: 1, name: 'Alice', age: 25 });
    
    // è¯»å–æ•°æ®
    const getRequest = store.get(1);
    getRequest.onsuccess = () => {
        console.log(getRequest.result);
    };
};</code></pre>
            
            <h3>5.3 ç‰¹æ€§</h3>
            <div class="info">
                <ul>
                    <li><strong>å®¹é‡</strong>ï¼šå‡ ç™¾ MB ç”šè‡³æ›´å¤š</li>
                    <li><strong>å¼‚æ­¥ API</strong>ï¼šä¸é˜»å¡ä¸»çº¿ç¨‹</li>
                    <li><strong>äº‹åŠ¡</strong>ï¼šæ”¯æŒäº‹åŠ¡æ“ä½œ</li>
                    <li><strong>ç´¢å¼•</strong>ï¼šæ”¯æŒç´¢å¼•æŸ¥è¯¢</li>
                    <li><strong>å¤æ‚æ•°æ®</strong>ï¼šå¯å­˜å‚¨ç»“æ„åŒ–æ•°æ®</li>
                </ul>
            </div>
            
            <h2>å…­ã€å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”</h2>
            
            <table>
                <thead>
                    <tr>
                        <th>æ–¹æ¡ˆ</th>
                        <th>å®¹é‡</th>
                        <th>ç”Ÿå‘½å‘¨æœŸ</th>
                        <th>API</th>
                        <th>é€‚ç”¨åœºæ™¯</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Cookie</td>
                        <td>4KB</td>
                        <td>å¯è®¾ç½®</td>
                        <td>åŒæ­¥</td>
                        <td>å°é‡æ•°æ®ã€éœ€è¦å‘é€åˆ°æœåŠ¡å™¨</td>
                    </tr>
                    <tr>
                        <td>localStorage</td>
                        <td>5-10MB</td>
                        <td>æ°¸ä¹…</td>
                        <td>åŒæ­¥</td>
                        <td>æŒä¹…åŒ–ç®€å•æ•°æ®</td>
                    </tr>
                    <tr>
                        <td>sessionStorage</td>
                        <td>5-10MB</td>
                        <td>ä¼šè¯</td>
                        <td>åŒæ­¥</td>
                        <td>ä¸´æ—¶æ•°æ®</td>
                    </tr>
                    <tr>
                        <td>IndexedDB</td>
                        <td>å‡ ç™¾MB+</td>
                        <td>æ°¸ä¹…</td>
                        <td>å¼‚æ­¥</td>
                        <td>å¤§é‡ç»“æ„åŒ–æ•°æ®</td>
                    </tr>
                </tbody>
            </table>
            
            <h2>ä¸ƒã€storage äº‹ä»¶</h2>
            
            <h3>7.1 ç›‘å¬å­˜å‚¨å˜åŒ–</h3>
            <pre><code>// ç›‘å¬ storage å˜åŒ–ï¼ˆè·¨æ ‡ç­¾é¡µï¼‰
window.addEventListener('storage', (e) => {
    console.log('key:', e.key);
    console.log('oldValue:', e.oldValue);
    console.log('newValue:', e.newValue);
    console.log('url:', e.url);
});</code></pre>
            
            <div class="warning">
                <strong>æ³¨æ„ï¼š</strong>storage äº‹ä»¶åªåœ¨å…¶ä»–æ ‡ç­¾é¡µè§¦å‘ï¼Œå½“å‰æ ‡ç­¾é¡µä¸è§¦å‘ã€‚
            </div>
            
            <h2>å…«ã€å®ç”¨å·¥å…·å‡½æ•°</h2>
            
            <h3>8.1 Storage å°è£…</h3>
            <pre><code>const storage = {
    set(key, value, expire = null) {
        const data = {
            value,
            expire: expire ? Date.now() + expire : null
        };
        localStorage.setItem(key, JSON.stringify(data));
    },
    
    get(key) {
        const item = localStorage.getItem(key);
        if (!item) return null;
        
        const data = JSON.parse(item);
        if (data.expire && Date.now() > data.expire) {
            this.remove(key);
            return null;
        }
        return data.value;
    },
    
    remove(key) {
        localStorage.removeItem(key);
    },
    
    clear() {
        localStorage.clear();
    }
};</code></pre>
            
            <h3>8.2 Cookie å·¥å…·</h3>
            <pre><code>const cookie = {
    set(name, value, days = 7) {
        const expires = new Date(Date.now() + days * 864e5).toUTCString();
        document.cookie = `${name}=${encodeURIComponent(value)}; expires=${expires}; path=/`;
    },
    
    get(name) {
        const matches = document.cookie.match(
            new RegExp(`(?:^|; )${name}=([^;]*)`)
        );
        return matches ? decodeURIComponent(matches[1]) : null;
    },
    
    remove(name) {
        this.set(name, '', -1);
    }
};</code></pre>
            
            <h2>ä¹ã€æœ€ä½³å®è·µ</h2>
            
            <div class="tip">
                <ol>
                    <li><strong>é€‰æ‹©åˆé€‚æ–¹æ¡ˆ</strong>ï¼šæ ¹æ®æ•°æ®é‡å’Œéœ€æ±‚é€‰æ‹©</li>
                    <li><strong>å¼‚å¸¸å¤„ç†</strong>ï¼šå¤„ç†é…é¢è¶…é™å’Œéšç§æ¨¡å¼</li>
                    <li><strong>åºåˆ—åŒ–</strong>ï¼šå­˜å‚¨å¯¹è±¡æ—¶ä½¿ç”¨ JSON</li>
                    <li><strong>å‘½åç©ºé—´</strong>ï¼šä½¿ç”¨å‰ç¼€é¿å…å†²çª</li>
                    <li><strong>æ•æ„Ÿæ•°æ®</strong>ï¼šä¸è¦å­˜å‚¨æ•æ„Ÿä¿¡æ¯</li>
                    <li><strong>å‹ç¼©æ•°æ®</strong>ï¼šå¤§æ•°æ®è€ƒè™‘å‹ç¼©</li>
                </ol>
            </div>
            
            <h2>å‚è€ƒèµ„æ–™</h2>
            <ul>
                <li><a href="https://html.spec.whatwg.org/#webstorage" target="_blank">HTML Standard - Web Storage</a></li>
                <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Storage_API" target="_blank">MDN - Web Storage API</a></li>
                <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/IndexedDB_API" target="_blank">MDN - IndexedDB</a></li>
            </ul>
            
            <div class="nav-links">
                <a href="11-bom.html" class="nav-link prev">ä¸Šä¸€èŠ‚ï¼šæµè§ˆå™¨å¯¹è±¡æ¨¡å‹</a>
                <a href="../index.html" class="nav-link home">è¿”å›é¦–é¡µ</a>
                <a href="11-fetch.html" class="nav-link next">ä¸‹ä¸€èŠ‚ï¼šFetch API</a>
            </div>
        </div>
        
        <div class="code-panel">
            <h2 style="color: #60a5fa; margin-bottom: 1.5rem;">ğŸ’» äº¤äº’å¼ä»£ç ç¤ºä¾‹</h2>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 1ï¼šlocalStorage åŸºç¡€</h3>
                <div class="code-block">
                    <pre><code>// localStorage åŸºæœ¬æ“ä½œ
console.log('=== localStorage æ“ä½œ ===\n');

// è®¾ç½®æ•°æ®
localStorage.setItem('name', 'Alice');
localStorage.setItem('age', '25');
localStorage.setItem('city', 'Beijing');

// è¯»å–æ•°æ®
console.log('name:', localStorage.getItem('name'));
console.log('age:', localStorage.getItem('age'));

// æ•°æ®æ•°é‡
console.log('\næ•°æ®æ•°é‡:', localStorage.length);

// éå†æ‰€æœ‰æ•°æ®
console.log('\næ‰€æœ‰æ•°æ®:');
for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    console.log(`  ${key}: ${localStorage.getItem(key)}`);
}

// åˆ é™¤å•ä¸ª
localStorage.removeItem('city');
console.log('\nåˆ é™¤ city å:', localStorage.length);</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 2ï¼šå­˜å‚¨å¯¹è±¡</h3>
                <div class="code-block">
                    <pre><code>// å­˜å‚¨å¤æ‚å¯¹è±¡
console.log('=== å­˜å‚¨å¯¹è±¡ ===\n');

const user = {
    id: 1,
    name: 'Alice',
    age: 25,
    skills: ['JavaScript', 'React', 'Node.js']
};

// åºåˆ—åŒ–å­˜å‚¨
localStorage.setItem('user', JSON.stringify(user));
console.log('å·²å­˜å‚¨ç”¨æˆ·å¯¹è±¡');

// è¯»å–å¹¶ååºåˆ—åŒ–
const storedUser = JSON.parse(localStorage.getItem('user'));
console.log('\nè¯»å–çš„å¯¹è±¡:');
console.log('  name:', storedUser.name);
console.log('  age:', storedUser.age);
console.log('  skills:', storedUser.skills);

// ä¿®æ”¹å¹¶ä¿å­˜
storedUser.age = 26;
storedUser.skills.push('TypeScript');
localStorage.setItem('user', JSON.stringify(storedUser));
console.log('\næ›´æ–°å:', JSON.parse(localStorage.getItem('user')));</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 3ï¼šsessionStorage</h3>
                <div class="code-block">
                    <pre><code>// sessionStorage æ“ä½œ
console.log('=== sessionStorage ===\n');

// è®¾ç½®ä¸´æ—¶æ•°æ®
sessionStorage.setItem('temp', 'temporary data');
sessionStorage.setItem('sessionId', Math.random().toString(36));

console.log('temp:', sessionStorage.getItem('temp'));
console.log('sessionId:', sessionStorage.getItem('sessionId'));

console.log('\nsessionStorage ç‰¹æ€§:');
console.log('  - æ ‡ç­¾é¡µå…³é—­åæ•°æ®æ¸…é™¤');
console.log('  - ä¸åŒæ ‡ç­¾é¡µæ•°æ®éš”ç¦»');
console.log('  - API ä¸ localStorage ç›¸åŒ');

// æ¸…ç†
sessionStorage.clear();
console.log('\næ¸…ç©ºåæ•°é‡:', sessionStorage.length);</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 4ï¼šCookie æ“ä½œ</h3>
                <div class="code-block">
                    <pre><code>// Cookie å·¥å…·å‡½æ•°
const cookie = {
    set(name, value, days = 7) {
        const expires = new Date(Date.now() + days * 864e5).toUTCString();
        document.cookie = `${name}=${encodeURIComponent(value)}; expires=${expires}; path=/`;
    },
    
    get(name) {
        const matches = document.cookie.match(
            new RegExp(`(?:^|; )${name}=([^;]*)`)
        );
        return matches ? decodeURIComponent(matches[1]) : null;
    },
    
    getAll() {
        const cookies = {};
        document.cookie.split(';').forEach(item => {
            const [key, value] = item.trim().split('=');
            if (key) cookies[key] = decodeURIComponent(value || '');
        });
        return cookies;
    },
    
    remove(name) {
        this.set(name, '', -1);
    }
};

// ä½¿ç”¨ç¤ºä¾‹
console.log('=== Cookie æ“ä½œ ===\n');

cookie.set('username', 'Alice', 7);
cookie.set('theme', 'dark', 30);

console.log('username:', cookie.get('username'));
console.log('theme:', cookie.get('theme'));

console.log('\næ‰€æœ‰ Cookie:', cookie.getAll());</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 5ï¼šå¸¦è¿‡æœŸæ—¶é—´çš„ Storage</h3>
                <div class="code-block">
                    <pre><code>// å°è£…å¸¦è¿‡æœŸæ—¶é—´çš„ Storage
const storage = {
    set(key, value, expire = null) {
        const data = {
            value,
            expire: expire ? Date.now() + expire : null
        };
        localStorage.setItem(key, JSON.stringify(data));
    },
    
    get(key) {
        const item = localStorage.getItem(key);
        if (!item) return null;
        
        const data = JSON.parse(item);
        
        // æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
        if (data.expire && Date.now() > data.expire) {
            this.remove(key);
            return null;
        }
        
        return data.value;
    },
    
    remove(key) {
        localStorage.removeItem(key);
    }
};

// ä½¿ç”¨ç¤ºä¾‹
console.log('=== å¸¦è¿‡æœŸæ—¶é—´çš„å­˜å‚¨ ===\n');

// å­˜å‚¨ 3 ç§’åè¿‡æœŸ
storage.set('temp', 'temporary', 3000);
console.log('ç«‹å³è¯»å–:', storage.get('temp'));

setTimeout(() => {
    console.log('3ç§’åè¯»å–:', storage.get('temp'));
}, 3500);</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 6ï¼šå­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”</h3>
                <div class="code-block">
                    <pre><code>// å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”
console.log('=== å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯” ===\n');

const comparison = [
    {
        name: 'Cookie',
        capacity: '4KB',
        lifetime: 'å¯è®¾ç½®',
        scope: 'åŒæº',
        api: 'åŒæ­¥',
        autoSend: 'æ˜¯'
    },
    {
        name: 'localStorage',
        capacity: '5-10MB',
        lifetime: 'æ°¸ä¹…',
        scope: 'åŒæºæ‰€æœ‰æ ‡ç­¾é¡µ',
        api: 'åŒæ­¥',
        autoSend: 'å¦'
    },
    {
        name: 'sessionStorage',
        capacity: '5-10MB',
        lifetime: 'ä¼šè¯',
        scope: 'åŒæºåŒæ ‡ç­¾é¡µ',
        api: 'åŒæ­¥',
        autoSend: 'å¦'
    },
    {
        name: 'IndexedDB',
        capacity: 'å‡ ç™¾MB+',
        lifetime: 'æ°¸ä¹…',
        scope: 'åŒæº',
        api: 'å¼‚æ­¥',
        autoSend: 'å¦'
    }
];

comparison.forEach(item => {
    console.log(`${item.name}:`);
    console.log(`  å®¹é‡: ${item.capacity}`);
    console.log(`  ç”Ÿå‘½å‘¨æœŸ: ${item.lifetime}`);
    console.log(`  ä½œç”¨åŸŸ: ${item.scope}`);
    console.log(`  API: ${item.api}`);
    console.log(`  è‡ªåŠ¨å‘é€: ${item.autoSend}\n`);
});</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
        </div>
    </div>
    
    <script src="../assets/js/common.js"></script>
</body>
</html>
