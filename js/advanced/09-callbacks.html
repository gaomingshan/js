<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›è°ƒå‡½æ•°æ¨¡å¼ - JavaScript æ·±åº¦å­¦ä¹ </title>
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/page.css">
</head>
<body>
    <div class="page-layout">
        <div class="doc-panel">
            <h1>å›è°ƒå‡½æ•°æ¨¡å¼</h1>
            
            <h2>æ¦‚è¿°</h2>
            <p>å›è°ƒå‡½æ•°æ˜¯ JavaScript å¼‚æ­¥ç¼–ç¨‹çš„åŸºç¡€ã€‚ç†è§£å›è°ƒæ¨¡å¼æ˜¯æŒæ¡å¼‚æ­¥ç¼–ç¨‹çš„ç¬¬ä¸€æ­¥ã€‚</p>
            
            <h2>ä¸€ã€ä»€ä¹ˆæ˜¯å›è°ƒå‡½æ•°</h2>
            
            <h3>1.1 å›è°ƒå‡½æ•°å®šä¹‰</h3>
            <p>å›è°ƒå‡½æ•°æ˜¯ä½œä¸ºå‚æ•°ä¼ é€’ç»™å¦ä¸€ä¸ªå‡½æ•°çš„å‡½æ•°ï¼Œåœ¨ç‰¹å®šäº‹ä»¶æˆ–æ¡ä»¶æ»¡è¶³æ—¶è¢«è°ƒç”¨ã€‚</p>
            
            <pre><code>function fetchData(callback) {
    // æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ
    setTimeout(() => {
        const data = { id: 1, name: 'Alice' };
        callback(data);
    }, 1000);
}

fetchData((data) => {
    console.log('æ”¶åˆ°æ•°æ®:', data);
});</code></pre>
            
            <h3>1.2 åŒæ­¥å›è°ƒ vs å¼‚æ­¥å›è°ƒ</h3>
            <div class="info">
                <strong>åŒæ­¥å›è°ƒï¼š</strong>ç«‹å³æ‰§è¡Œ
                <pre><code>[1, 2, 3].forEach(item => {
    console.log(item); // åŒæ­¥æ‰§è¡Œ
});</code></pre>
                
                <strong>å¼‚æ­¥å›è°ƒï¼š</strong>å»¶è¿Ÿæ‰§è¡Œ
                <pre><code>setTimeout(() => {
    console.log('å¼‚æ­¥æ‰§è¡Œ');
}, 1000);</code></pre>
            </div>
            
            <h2>äºŒã€å¸¸è§å›è°ƒæ¨¡å¼</h2>
            
            <h3>2.1 Error-First å›è°ƒ</h3>
            <p>Node.js é£æ ¼çš„å›è°ƒï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é”™è¯¯å¯¹è±¡ï¼š</p>
            
            <pre><code>function readFile(path, callback) {
    // æ¨¡æ‹Ÿæ–‡ä»¶è¯»å–
    setTimeout(() => {
        if (!path) {
            callback(new Error('è·¯å¾„ä¸èƒ½ä¸ºç©º'), null);
        } else {
            callback(null, 'æ–‡ä»¶å†…å®¹');
        }
    }, 1000);
}

readFile('test.txt', (err, data) => {
    if (err) {
        console.error('é”™è¯¯:', err.message);
        return;
    }
    console.log('æ•°æ®:', data);
});</code></pre>
            
            <h3>2.2 äº‹ä»¶ç›‘å¬å›è°ƒ</h3>
            <pre><code>// DOM äº‹ä»¶
button.addEventListener('click', function(event) {
    console.log('æŒ‰é’®è¢«ç‚¹å‡»');
});

// è‡ªå®šä¹‰äº‹ä»¶
class EventEmitter {
    constructor() {
        this.events = {};
    }
    
    on(event, callback) {
        if (!this.events[event]) {
            this.events[event] = [];
        }
        this.events[event].push(callback);
    }
    
    emit(event, data) {
        if (this.events[event]) {
            this.events[event].forEach(cb => cb(data));
        }
    }
}</code></pre>
            
            <h2>ä¸‰ã€å›è°ƒåœ°ç‹±ï¼ˆCallback Hellï¼‰</h2>
            
            <h3>3.1 ä»€ä¹ˆæ˜¯å›è°ƒåœ°ç‹±</h3>
            <p>å¤šå±‚åµŒå¥—çš„å›è°ƒå‡½æ•°å¯¼è‡´ä»£ç éš¾ä»¥é˜…è¯»å’Œç»´æŠ¤ï¼š</p>
            
            <div class="warning">
                <pre><code>// å›è°ƒåœ°ç‹±ç¤ºä¾‹
getData(function(a) {
    getMoreData(a, function(b) {
        getMoreData(b, function(c) {
            getMoreData(c, function(d) {
                getMoreData(d, function(e) {
                    console.log(e);
                });
            });
        });
    });
});</code></pre>
            </div>
            
            <h3>3.2 å›è°ƒåœ°ç‹±çš„é—®é¢˜</h3>
            <ul>
                <li>ä»£ç æ¨ªå‘å‘å±•ï¼Œéš¾ä»¥é˜…è¯»</li>
                <li>é”™è¯¯å¤„ç†å¤æ‚</li>
                <li>ä»£ç å¤ç”¨å›°éš¾</li>
                <li>è°ƒè¯•å›°éš¾</li>
            </ul>
            
            <h2>å››ã€æ”¹å–„å›è°ƒä»£ç </h2>
            
            <h3>4.1 å‘½åå‡½æ•°</h3>
            <pre><code>// ä¸å¥½ï¼šåŒ¿åå‡½æ•°åµŒå¥—
getData(function(a) {
    getMoreData(a, function(b) {
        console.log(b);
    });
});

// å¥½ï¼šä½¿ç”¨å‘½åå‡½æ•°
function handleMoreData(b) {
    console.log(b);
}

function handleData(a) {
    getMoreData(a, handleMoreData);
}

getData(handleData);</code></pre>
            
            <h3>4.2 æ¨¡å—åŒ–</h3>
            <pre><code>// å°†å›è°ƒé€»è¾‘åˆ†ç¦»åˆ°ç‹¬ç«‹å‡½æ•°
const handlers = {
    onSuccess(data) {
        console.log('æˆåŠŸ:', data);
    },
    onError(error) {
        console.error('é”™è¯¯:', error);
    }
};

fetchData(handlers.onSuccess, handlers.onError);</code></pre>
            
            <h3>4.3 æå‰è¿”å›</h3>
            <pre><code>function processData(data, callback) {
    if (!data) {
        return callback(new Error('æ— æ•°æ®'));
    }
    
    if (!data.isValid) {
        return callback(new Error('æ•°æ®æ— æ•ˆ'));
    }
    
    // ä¸»è¦é€»è¾‘
    callback(null, processedData);
}</code></pre>
            
            <h2>äº”ã€å›è°ƒå‡½æ•°æœ€ä½³å®è·µ</h2>
            
            <div class="tip">
                <ol>
                    <li><strong>ç»Ÿä¸€é”™è¯¯å¤„ç†</strong>ï¼šä½¿ç”¨ Error-First å›è°ƒ</li>
                    <li><strong>é¿å…æ·±å±‚åµŒå¥—</strong>ï¼šæå–å‘½åå‡½æ•°</li>
                    <li><strong>åŠæ—¶è¿”å›</strong>ï¼šé¿å…å›è°ƒåç»§ç»­æ‰§è¡Œ</li>
                    <li><strong>å¤„ç†æ‰€æœ‰æƒ…å†µ</strong>ï¼šæˆåŠŸå’Œå¤±è´¥éƒ½è¦å¤„ç†</li>
                    <li><strong>é¿å…å›è°ƒåœ°ç‹±</strong>ï¼šè€ƒè™‘ä½¿ç”¨ Promise æˆ– async/await</li>
                </ol>
            </div>
            
            <h2>å…­ã€å›è°ƒçš„å±€é™æ€§</h2>
            
            <div class="warning">
                <ul>
                    <li>æ— æ³•å¤„ç†å¤šä¸ªå¹¶è¡Œå¼‚æ­¥æ“ä½œ</li>
                    <li>æ— æ³•å–æ¶ˆå·²å‘èµ·çš„å¼‚æ­¥æ“ä½œ</li>
                    <li>éš¾ä»¥å®ç°é”™è¯¯æ¢å¤</li>
                    <li>æ§åˆ¶æµå¤æ‚</li>
                    <li>éš¾ä»¥ç»„åˆå’Œå¤ç”¨</li>
                </ul>
                <p>è¿™äº›é—®é¢˜ä¿ƒä½¿äº† Promise å’Œ async/await çš„è¯ç”Ÿã€‚</p>
            </div>
            
            <h2>å‚è€ƒèµ„æ–™</h2>
            <ul>
                <li><a href="http://callbackhell.com/" target="_blank">Callback Hell</a></li>
                <li><a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Callback_function" target="_blank">MDN - å›è°ƒå‡½æ•°</a></li>
            </ul>
            
            <div class="nav-links">
                <a href="../basics/08-symbol-bigint.html" class="nav-link prev">ä¸Šä¸€èŠ‚ï¼šSymbol ä¸ BigInt</a>
                <a href="../index.html" class="nav-link home">è¿”å›é¦–é¡µ</a>
                <a href="09-promises.html" class="nav-link next">ä¸‹ä¸€èŠ‚ï¼šPromise è¯¦è§£</a>
            </div>
        </div>
        
        <div class="code-panel">
            <h2 style="color: #60a5fa; margin-bottom: 1.5rem;">ğŸ’» äº¤äº’å¼ä»£ç ç¤ºä¾‹</h2>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 1ï¼šåŸºæœ¬å›è°ƒå‡½æ•°</h3>
                <div class="code-block">
                    <pre><code>// ç®€å•å›è°ƒ
function greet(name, callback) {
    console.log('Hello, ' + name);
    callback();
}

greet('Alice', function() {
    console.log('å›è°ƒæ‰§è¡Œå®Œæˆ');
});

// åŒæ­¥å›è°ƒ
console.log('\næ•°ç»„æ–¹æ³•å›è°ƒ:');
[1, 2, 3].forEach(item => {
    console.log('  ', item);
});

// å¼‚æ­¥å›è°ƒ
console.log('\nå¼‚æ­¥å›è°ƒ:');
console.log('å¼€å§‹');
setTimeout(() => {
    console.log('1ç§’åæ‰§è¡Œ');
}, 1000);
console.log('ç»“æŸï¼ˆä½†å›è°ƒè¿˜æ²¡æ‰§è¡Œï¼‰');</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 2ï¼šError-First å›è°ƒ</h3>
                <div class="code-block">
                    <pre><code>// Error-First å›è°ƒæ¨¡å¼
function fetchData(id, callback) {
    setTimeout(() => {
        if (id < 0) {
            callback(new Error('ID ä¸èƒ½ä¸ºè´Ÿæ•°'), null);
        } else {
            callback(null, { id, name: 'User' + id });
        }
    }, 500);
}

// æˆåŠŸæƒ…å†µ
console.log('=== æˆåŠŸæƒ…å†µ ===');
fetchData(1, (err, data) => {
    if (err) {
        console.error('é”™è¯¯:', err.message);
        return;
    }
    console.log('æ•°æ®:', data);
});

// é”™è¯¯æƒ…å†µ
console.log('\n=== é”™è¯¯æƒ…å†µ ===');
fetchData(-1, (err, data) => {
    if (err) {
        console.error('é”™è¯¯:', err.message);
        return;
    }
    console.log('æ•°æ®:', data);
});</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 3ï¼šå›è°ƒåœ°ç‹±æ¼”ç¤º</h3>
                <div class="code-block">
                    <pre><code>// æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ
function step1(callback) {
    setTimeout(() => {
        console.log('Step 1 å®Œæˆ');
        callback('result1');
    }, 300);
}

function step2(data, callback) {
    setTimeout(() => {
        console.log('Step 2 å®Œæˆ, æ•°æ®:', data);
        callback('result2');
    }, 300);
}

function step3(data, callback) {
    setTimeout(() => {
        console.log('Step 3 å®Œæˆ, æ•°æ®:', data);
        callback('final');
    }, 300);
}

// å›è°ƒåœ°ç‹±
console.log('å¼€å§‹æ‰§è¡Œ...');
step1((result1) => {
    step2(result1, (result2) => {
        step3(result2, (final) => {
            console.log('å…¨éƒ¨å®Œæˆ:', final);
        });
    });
});</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 4ï¼šæ”¹å–„å›è°ƒ - å‘½åå‡½æ•°</h3>
                <div class="code-block">
                    <pre><code>// ä½¿ç”¨å‘½åå‡½æ•°é¿å…åµŒå¥—
function step1(callback) {
    setTimeout(() => {
        console.log('Step 1');
        callback('data1');
    }, 200);
}

function step2(data, callback) {
    setTimeout(() => {
        console.log('Step 2:', data);
        callback('data2');
    }, 200);
}

function step3(data, callback) {
    setTimeout(() => {
        console.log('Step 3:', data);
        callback('final');
    }, 200);
}

// å‘½åå‡½æ•°ç‰ˆæœ¬
function handleStep3(data) {
    console.log('å®Œæˆ:', data);
}

function handleStep2(data) {
    step3(data, handleStep3);
}

function handleStep1(data) {
    step2(data, handleStep2);
}

console.log('æ”¹å–„ç‰ˆæœ¬æ‰§è¡Œ:');
step1(handleStep1);</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 5ï¼šäº‹ä»¶å‘å°„å™¨</h3>
                <div class="code-block">
                    <pre><code>// ç®€å•çš„äº‹ä»¶å‘å°„å™¨
class EventEmitter {
    constructor() {
        this.events = {};
    }
    
    on(event, callback) {
        if (!this.events[event]) {
            this.events[event] = [];
        }
        this.events[event].push(callback);
    }
    
    emit(event, data) {
        if (this.events[event]) {
            this.events[event].forEach(cb => cb(data));
        }
    }
    
    off(event, callback) {
        if (this.events[event]) {
            this.events[event] = this.events[event]
                .filter(cb => cb !== callback);
        }
    }
}

// ä½¿ç”¨
const emitter = new EventEmitter();

emitter.on('data', (data) => {
    console.log('æ”¶åˆ°æ•°æ®:', data);
});

emitter.on('data', (data) => {
    console.log('å¦ä¸€ä¸ªç›‘å¬å™¨:', data);
});

emitter.emit('data', { id: 1, value: 100 });</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 6ï¼šå¹¶è¡Œå›è°ƒ</h3>
                <div class="code-block">
                    <pre><code>// å¹¶è¡Œæ‰§è¡Œå¤šä¸ªå¼‚æ­¥æ“ä½œ
function parallelTasks(tasks, callback) {
    const results = [];
    let completed = 0;
    
    tasks.forEach((task, index) => {
        task((err, result) => {
            if (err) {
                return callback(err);
            }
            results[index] = result;
            completed++;
            
            if (completed === tasks.length) {
                callback(null, results);
            }
        });
    });
}

// å®šä¹‰ä»»åŠ¡
const task1 = (cb) => setTimeout(() => cb(null, 'Task 1'), 300);
const task2 = (cb) => setTimeout(() => cb(null, 'Task 2'), 200);
const task3 = (cb) => setTimeout(() => cb(null, 'Task 3'), 100);

console.log('å¹¶è¡Œæ‰§è¡Œä»»åŠ¡...');
parallelTasks([task1, task2, task3], (err, results) => {
    if (err) {
        console.error('é”™è¯¯:', err);
        return;
    }
    console.log('å…¨éƒ¨å®Œæˆ:', results);
});</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
        </div>
    </div>
    
    <script src="../assets/js/common.js"></script>
</body>
</html>
