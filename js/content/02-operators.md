# 运算符完全指南

## 概述

运算符决定了“值如何被计算”。在 JavaScript 中，运算符不仅做数学计算，还会触发：

- 类型转换（例如 `+`、比较运算）
- 短路与控制流（`&&` / `||` / `??`）
- 对象属性与原型链语义（`in` / `instanceof`）
- 位级行为（位运算会把 `Number` 转成 32 位整数）

本章目标是：用**精简但够深入**的方式掌握核心运算符语义与高频陷阱。

---

## 一、算术运算符

### 1.1 基本算术

- `+ - * / % **`

```js
2 ** 3;   // 8
5 / 2;    // 2.5
5 % 2;    // 1
```

### 1.2 一元运算符：`+x` / `-x` / `++` / `--`

```js
+'42'; // 42（触发 ToNumber）
```

> **提示**
>
> `++x` 与 `x++` 的差异是“返回值时机”，但都会修改变量。复杂表达式里混用递增很容易降低可读性。

---

## 二、赋值与复合赋值

### 2.1 复合赋值

- `+= -= *= /= %= **=`

### 2.2 逻辑赋值（ES2021）

- `x ||= y`：当 `x` 为 falsy 时赋值
- `x &&= y`：当 `x` 为 truthy 时赋值
- `x ??= y`：当 `x` 为 `null/undefined` 时赋值

```js
let a = 0;
a ||= 10;  // 10（0 是 falsy）

let b = 0;
b ??= 10;  // 0（0 不是 null/undefined）
```

> **关键点**
>
> - `||=` 适合“默认值”（但会把 `0` / `''` 当成空）。
> - `??=` 适合“只把缺失当空”。

---

## 三、比较运算符

### 3.1 严格相等优先：`===` / `!==`

- **推荐**：`===` 不做隐式类型转换

```js
0 === false; // false
```

### 3.2 宽松相等：`==`（了解即可）

`==` 会触发复杂的类型转换规则（详见“类型转换与判断”）。

```js
null == undefined; // true（特殊规则）
```

### 3.3 关系比较：`< > <= >=`

比较时可能发生 ToPrimitive/ToNumber。

```js
'10' < '2'; // true（字符串按字典序）
'10' < 2;   // false（转数字 10 < 2）
```

---

## 四、逻辑运算符（短路 + 返回操作数）

### 4.1 `&&` 与 `||` 的本质

- **短路**：左侧已足够决定结果时，右侧不会被求值
- **返回值不是 Boolean**：返回“最后一个被求值的操作数”

```js
const v1 = 0 || 42;     // 42
const v2 = 'ok' && 42;  // 42
```

> **深入一点**
>
> `&&/||` 常被当成控制流工具（guard / 默认值），但在复杂表达式中可能隐藏 bug。更推荐用 `if` 或 `??`。

### 4.2 空值合并：`??`

只把 `null/undefined` 当作“空”。

```js
0 ?? 100;      // 0
'' ?? 'x';     // ''
null ?? 'x';   // 'x'
```

> **注意**
>
> 规范限制：`??` 不能直接与 `||`、`&&` 混用而不加括号（避免歧义）。

---

## 五、位运算符（会把 Number 转成 32 位）

- `& | ^ ~ << >> >>>`

```js
5 & 3; // 1
```

> **深入原理：为什么位运算“看起来怪”**
>
> 位运算会触发 `ToInt32` / `ToUint32`：
>
> - `Number` 先转换为 32 位整数
> - 超出 32 位范围会截断
>
> 所以位运算适合“位级技巧”，但不适合处理大整数/高精度数值。

---

## 六、对象相关运算符

### 6.1 `in`

判断属性是否存在（包含原型链）：

```js
'toString' in {}; // true
```

### 6.2 `instanceof`

基于原型链判断：`Ctor.prototype` 是否在对象原型链上。

```js
[] instanceof Array; // true
```

> **提示**
>
> `instanceof` 在跨 iframe/多 realm 场景可能失效（不同全局的 `Array` 不同）。

---

## 七、其他高频运算符

- `typeof`：类型字符串（`typeof null === 'object'` 是历史遗留）
- `delete`：删除对象属性（对局部变量/不可配置属性不一定成功）
- `void`：求值但返回 `undefined`
- `,`（逗号运算符）：返回最后一个表达式值（不推荐滥用）

---

## 八、最佳实践（可落地）

1. **比较优先用 `===`**。
2. 默认值优先用 `??`（避免 `0` / `''` 被误判为空）。
3. 避免在表达式里混合多个副作用（如 `x++` + 赋值）。
4. 位运算谨慎使用：知道它会把数转成 32 位。

---

## 参考资料

- [MDN - 运算符](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators)
- [MDN - 运算符优先级](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Operator_Precedence)
- [ECMA-262 - Expressions](https://tc39.es/ecma262/#sec-ecmascript-language-expressions)
