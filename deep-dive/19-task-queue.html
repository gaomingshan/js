<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡ - JavaScript æ·±åº¦å­¦ä¹ </title>
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/page.css">
</head>
<body>
    <div class="page-layout">
        <div class="doc-panel">
            <h1>å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡</h1>
            
            <h2>æ¦‚è¿°</h2>
            <p>å®ä»»åŠ¡ï¼ˆMacro Taskï¼‰å’Œå¾®ä»»åŠ¡ï¼ˆMicro Taskï¼‰æ˜¯äº‹ä»¶å¾ªç¯ä¸­çš„ä¸¤ç§ä»»åŠ¡é˜Ÿåˆ—ã€‚ç†è§£å®ƒä»¬çš„åŒºåˆ«å’Œæ‰§è¡Œæœºåˆ¶æ˜¯æŒæ¡ JavaScript å¼‚æ­¥ç¼–ç¨‹çš„å…³é”®ã€‚</p>
            
            <h2>ä¸€ã€ä»»åŠ¡é˜Ÿåˆ—åˆ†ç±»</h2>
            
            <h3>1.1 å®ä»»åŠ¡ï¼ˆMacro Taskï¼‰</h3>
            <div class="info">
                <p><strong>å®ä»»åŠ¡æº</strong>ï¼š</p>
                <ul>
                    <li>scriptï¼ˆæ•´ä½“ä»£ç ï¼‰</li>
                    <li>setTimeout / setInterval</li>
                    <li>setImmediateï¼ˆNode.jsï¼‰</li>
                    <li>I/O æ“ä½œ</li>
                    <li>UI äº¤äº’äº‹ä»¶</li>
                    <li>postMessage</li>
                    <li>MessageChannel</li>
                </ul>
            </div>
            
            <h3>1.2 å¾®ä»»åŠ¡ï¼ˆMicro Taskï¼‰</h3>
            <div class="info">
                <p><strong>å¾®ä»»åŠ¡æº</strong>ï¼š</p>
                <ul>
                    <li>Promise.then / catch / finally</li>
                    <li>async/await</li>
                    <li>queueMicrotask()</li>
                    <li>MutationObserver</li>
                    <li>process.nextTickï¼ˆNode.jsï¼‰</li>
                </ul>
            </div>
            
            <h2>äºŒã€æ‰§è¡Œæœºåˆ¶</h2>
            
            <h3>2.1 åŸºæœ¬æµç¨‹</h3>
            <pre><code>// äº‹ä»¶å¾ªç¯æ‰§è¡Œæµç¨‹
1. æ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡ï¼ˆé¦–æ¬¡æ˜¯æ•´ä½“ä»£ç ï¼‰
2. æ‰§è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„å¾®ä»»åŠ¡åŠ å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—
3. å®ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œæ£€æŸ¥å¾®ä»»åŠ¡é˜Ÿåˆ—
4. æ‰§è¡Œæ‰€æœ‰å¾®ä»»åŠ¡ï¼ˆå¾®ä»»åŠ¡ä¸­äº§ç”Ÿçš„æ–°å¾®ä»»åŠ¡ä¹Ÿä¼šæ‰§è¡Œï¼‰
5. å¾®ä»»åŠ¡é˜Ÿåˆ—æ¸…ç©ºåï¼Œè¿›è¡Œæ¸²æŸ“ï¼ˆå¦‚æœéœ€è¦ï¼‰
6. å¼€å§‹ä¸‹ä¸€è½®ï¼Œæ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡
7. é‡å¤ä¸Šè¿°æµç¨‹</code></pre>
            
            <h3>2.2 å¯è§†åŒ–æµç¨‹</h3>
            <pre><code>å®ä»»åŠ¡1
  â†“
å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼ˆæ¸…ç©ºï¼‰
  â†“
æ¸²æŸ“ï¼ˆå¯é€‰ï¼‰
  â†“
å®ä»»åŠ¡2
  â†“
å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼ˆæ¸…ç©ºï¼‰
  â†“
æ¸²æŸ“ï¼ˆå¯é€‰ï¼‰
  â†“
å®ä»»åŠ¡3
  ...</code></pre>
            
            <h2>ä¸‰ã€æ‰§è¡Œé¡ºåºç¤ºä¾‹</h2>
            
            <h3>3.1 åŸºç¡€ç¤ºä¾‹</h3>
            <pre><code>console.log('1');

setTimeout(() => {
    console.log('2');
}, 0);

Promise.resolve().then(() => {
    console.log('3');
});

console.log('4');

// æ‰§è¡Œåˆ†æï¼š
// ç¬¬ä¸€ä¸ªå®ä»»åŠ¡ï¼ˆscriptï¼‰ï¼š
//   åŒæ­¥ä»£ç ï¼š1, 4
//   äº§ç”Ÿå¾®ä»»åŠ¡ï¼šPromise.then
//   äº§ç”Ÿå®ä»»åŠ¡ï¼šsetTimeout
// 
// å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼š
//   æ‰§è¡Œ Promise.thenï¼š3
// 
// ç¬¬äºŒä¸ªå®ä»»åŠ¡ï¼š
//   æ‰§è¡Œ setTimeoutï¼š2
//
// è¾“å‡ºï¼š1 â†’ 4 â†’ 3 â†’ 2</code></pre>
            
            <h3>3.2 åµŒå¥—ç¤ºä¾‹</h3>
            <pre><code>setTimeout(() => {
    console.log('timeout1');
    Promise.resolve().then(() => {
        console.log('promise1');
    });
}, 0);

setTimeout(() => {
    console.log('timeout2');
    Promise.resolve().then(() => {
        console.log('promise2');
    });
}, 0);

// æ‰§è¡Œåˆ†æï¼š
// å®ä»»åŠ¡1ï¼ˆscriptï¼‰æ‰§è¡Œå®Œ
// å®ä»»åŠ¡2ï¼ˆtimeout1ï¼‰ï¼š
//   è¾“å‡º timeout1
//   äº§ç”Ÿå¾®ä»»åŠ¡ promise1
// å¾®ä»»åŠ¡ï¼špromise1
// å®ä»»åŠ¡3ï¼ˆtimeout2ï¼‰ï¼š
//   è¾“å‡º timeout2
//   äº§ç”Ÿå¾®ä»»åŠ¡ promise2
// å¾®ä»»åŠ¡ï¼špromise2
//
// è¾“å‡ºï¼štimeout1 â†’ promise1 â†’ timeout2 â†’ promise2</code></pre>
            
            <h3>3.3 å¤æ‚ç¤ºä¾‹</h3>
            <pre><code>console.log('script start');

async function async1() {
    await async2();
    console.log('async1 end');
}

async function async2() {
    console.log('async2 end');
}

async1();

setTimeout(() => {
    console.log('setTimeout');
}, 0);

new Promise(resolve => {
    console.log('Promise');
    resolve();
})
.then(() => {
    console.log('promise1');
})
.then(() => {
    console.log('promise2');
});

console.log('script end');

// è¾“å‡ºé¡ºåºï¼š
// script start
// async2 end
// Promise
// script end
// async1 end
// promise1
// promise2
// setTimeout</code></pre>
            
            <h2>å››ã€å¾®ä»»åŠ¡ä¼˜å…ˆçº§</h2>
            
            <h3>4.1 åŒçº§å¾®ä»»åŠ¡</h3>
            <pre><code>// å¾®ä»»åŠ¡æŒ‰åŠ å…¥é¡ºåºæ‰§è¡Œ
Promise.resolve().then(() => {
    console.log('promise1');
});

queueMicrotask(() => {
    console.log('microtask1');
});

Promise.resolve().then(() => {
    console.log('promise2');
});

queueMicrotask(() => {
    console.log('microtask2');
});

// è¾“å‡ºï¼špromise1 â†’ microtask1 â†’ promise2 â†’ microtask2</code></pre>
            
            <h3>4.2 Node.js ä¸­çš„ nextTick</h3>
            <pre><code>// process.nextTick ä¼˜å…ˆçº§æœ€é«˜
Promise.resolve().then(() => {
    console.log('promise');
});

process.nextTick(() => {
    console.log('nextTick');
});

queueMicrotask(() => {
    console.log('microtask');
});

// Node.js è¾“å‡ºï¼š
// nextTick â†’ promise â†’ microtask
//
// nextTick é˜Ÿåˆ—åœ¨å¾®ä»»åŠ¡é˜Ÿåˆ—ä¹‹å‰</code></pre>
            
            <h2>äº”ã€å®ä»»åŠ¡ä¼˜å…ˆçº§</h2>
            
            <h3>5.1 setTimeout vs setImmediate</h3>
            <pre><code>// åœ¨ Node.js ä¸­
setTimeout(() => {
    console.log('timeout');
}, 0);

setImmediate(() => {
    console.log('immediate');
});

// è¾“å‡ºé¡ºåºä¸ç¡®å®šï¼ˆå–å†³äºè¿›å…¥äº‹ä»¶å¾ªç¯çš„æ—¶æœºï¼‰

// ä½†åœ¨ I/O å›è°ƒä¸­ï¼š
fs.readFile('file.txt', () => {
    setTimeout(() => {
        console.log('timeout');
    }, 0);
    
    setImmediate(() => {
        console.log('immediate');
    });
});

// è¾“å‡ºï¼šimmediate â†’ timeout
// å› ä¸º setImmediate åœ¨ check é˜¶æ®µï¼Œç´§è·Ÿ I/O å›è°ƒ</code></pre>
            
            <h3>5.2 MessageChannel</h3>
            <pre><code>// MessageChannel åˆ›å»ºå®ä»»åŠ¡
const channel = new MessageChannel();

channel.port1.onmessage = () => {
    console.log('message');
};

setTimeout(() => {
    console.log('timeout');
}, 0);

channel.port2.postMessage('');

Promise.resolve().then(() => {
    console.log('promise');
});

// è¾“å‡ºï¼špromise â†’ message/timeoutï¼ˆé¡ºåºä¸ç¡®å®šï¼‰</code></pre>
            
            <h2>å…­ã€å¸¸è§é™·é˜±</h2>
            
            <h3>6.1 å¾®ä»»åŠ¡é˜»å¡</h3>
            <pre><code>// å¤§é‡å¾®ä»»åŠ¡ä¼šé˜»å¡æ¸²æŸ“å’Œå®ä»»åŠ¡
function recursiveMicrotask(n) {
    if (n <= 0) return;
    
    Promise.resolve().then(() => {
        console.log(n);
        recursiveMicrotask(n - 1);
    });
}

// äº§ç”Ÿ 1000 ä¸ªå¾®ä»»åŠ¡
recursiveMicrotask(1000);

setTimeout(() => {
    console.log('è¿™ä¸ªè¦ç­‰å¾ˆä¹…');
}, 0);

// æ‰€æœ‰å¾®ä»»åŠ¡å¿…é¡»æ‰§è¡Œå®Œæ‰èƒ½æ‰§è¡Œ setTimeout</code></pre>
            
            <h3>6.2 Promise æ„é€ å‡½æ•°</h3>
            <pre><code>// Promise æ„é€ å‡½æ•°å†…çš„ä»£ç æ˜¯åŒæ­¥çš„
new Promise(resolve => {
    console.log('1');
    resolve();
    console.log('2');
}).then(() => {
    console.log('3');
});

console.log('4');

// è¾“å‡ºï¼š1 â†’ 2 â†’ 4 â†’ 3
// åªæœ‰ then æ˜¯å¾®ä»»åŠ¡</code></pre>
            
            <h3>6.3 async å‡½æ•°æ‰§è¡Œæ—¶æœº</h3>
            <pre><code>async function test() {
    console.log('1');
    await Promise.resolve();
    console.log('2');
}

test();
console.log('3');

// è¾“å‡ºï¼š1 â†’ 3 â†’ 2
// 
// await ä¹‹å‰æ˜¯åŒæ­¥
// await ä¹‹åæ˜¯å¾®ä»»åŠ¡</code></pre>
            
            <h2>ä¸ƒã€æµè§ˆå™¨ vs Node.js</h2>
            
            <h3>7.1 æµè§ˆå™¨ç¯å¢ƒ</h3>
            <pre><code>// æµè§ˆå™¨çš„ä»»åŠ¡é˜Ÿåˆ—
1. å®ä»»åŠ¡é˜Ÿåˆ—ï¼ˆTask Queueï¼‰
   - setTimeout/setInterval
   - UI äº‹ä»¶
   - I/O
   
2. å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼ˆMicrotask Queueï¼‰
   - Promise
   - MutationObserver
   - queueMicrotask</code></pre>
            
            <h3>7.2 Node.js ç¯å¢ƒ</h3>
            <pre><code>// Node.js äº‹ä»¶å¾ªç¯é˜¶æ®µ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         timers            â”‚ â† setTimeout/setInterval
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     pending callbacks     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       idle, prepare       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          poll             â”‚ â† I/O
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          check            â”‚ â† setImmediate
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      close callbacks      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

// æ¯ä¸ªé˜¶æ®µåéƒ½ä¼šæ‰§è¡Œå¾®ä»»åŠ¡
// process.nextTick ä¼˜å…ˆäºå¾®ä»»åŠ¡</code></pre>
            
            <h2>å…«ã€å®é™…åº”ç”¨</h2>
            
            <h3>8.1 æ‰¹é‡æ›´æ–°</h3>
            <pre><code>// ä½¿ç”¨å¾®ä»»åŠ¡æ‰¹é‡æ›´æ–° DOM
class BatchUpdater {
    constructor() {
        this.updates = [];
        this.pending = false;
    }
    
    add(update) {
        this.updates.push(update);
        
        if (!this.pending) {
            this.pending = true;
            queueMicrotask(() => this.flush());
        }
    }
    
    flush() {
        const updates = this.updates.slice();
        this.updates = [];
        this.pending = false;
        
        // æ‰¹é‡åº”ç”¨æ›´æ–°
        updates.forEach(update => update());
    }
}</code></pre>
            
            <h3>8.2 ä»»åŠ¡è°ƒåº¦</h3>
            <pre><code>// æ ¹æ®ä¼˜å…ˆçº§è°ƒåº¦ä»»åŠ¡
class TaskScheduler {
    highPriority(task) {
        queueMicrotask(task);  // å¾®ä»»åŠ¡
    }
    
    normalPriority(task) {
        Promise.resolve().then(task);  // å¾®ä»»åŠ¡
    }
    
    lowPriority(task) {
        setTimeout(task, 0);  // å®ä»»åŠ¡
    }
    
    idle(task) {
        requestIdleCallback(task);  // ç©ºé—²æ—¶
    }
}</code></pre>
            
            <h2>ä¹ã€è°ƒè¯•æŠ€å·§</h2>
            
            <h3>9.1 è¿½è¸ªæ‰§è¡Œé¡ºåº</h3>
            <pre><code>// ä½¿ç”¨æ ‡è®°è¿½è¸ª
function trace(label, type) {
    return () => {
        console.log(`[${type}] ${label}`);
    };
}

console.log('[Sync] Start');

setTimeout(trace('Timeout 1', 'Macro'), 0);

Promise.resolve()
    .then(trace('Promise 1', 'Micro'))
    .then(trace('Promise 2', 'Micro'));

queueMicrotask(trace('Microtask', 'Micro'));

console.log('[Sync] End');</code></pre>
            
            <h3>9.2 æ€§èƒ½ç›‘æ§</h3>
            <pre><code>// ç›‘æ§å¾®ä»»åŠ¡æ‰§è¡Œæ—¶é—´
let microTaskCount = 0;
const originalQueueMicrotask = queueMicrotask;

queueMicrotask = function(callback) {
    microTaskCount++;
    originalQueueMicrotask(() => {
        const start = performance.now();
        callback();
        const duration = performance.now() - start;
        console.log(`Microtask ${microTaskCount}: ${duration}ms`);
    });
};</code></pre>
            
            <h2>åã€æœ€ä½³å®è·µ</h2>
            
            <div class="tip">
                <ol>
                    <li><strong>ç†è§£æ‰§è¡Œé¡ºåº</strong>ï¼šå¾®ä»»åŠ¡åœ¨å®ä»»åŠ¡ä¹‹é—´</li>
                    <li><strong>é¿å…é•¿æ—¶é—´å¾®ä»»åŠ¡</strong>ï¼šä¼šé˜»å¡æ¸²æŸ“</li>
                    <li><strong>ä½¿ç”¨ queueMicrotask</strong>ï¼šæ˜ç¡®çš„å¾®ä»»åŠ¡ API</li>
                    <li><strong>æ³¨æ„ Promise æ„é€ å‡½æ•°</strong>ï¼šå†…éƒ¨æ˜¯åŒæ­¥çš„</li>
                    <li><strong>åˆç†ä½¿ç”¨ setTimeout(0)</strong>ï¼šè®©å‡ºæ‰§è¡Œæƒ</li>
                    <li><strong>æ‰¹é‡æ“ä½œç”¨å¾®ä»»åŠ¡</strong>ï¼šæé«˜æ€§èƒ½</li>
                    <li><strong>è°ƒè¯•æ—¶æ·»åŠ æ—¥å¿—</strong>ï¼šè¿½è¸ªæ‰§è¡Œæµç¨‹</li>
                </ol>
            </div>
            
            <h2>å‚è€ƒèµ„æ–™</h2>
            <ul>
                <li><a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loops" target="_blank">HTML Standard - Event loops</a></li>
                <li><a href="https://nodejs.org/en/docs/guides/event-loop-timers-and-nexttick/" target="_blank">Node.js - Event Loop</a></li>
            </ul>
            
            <div class="nav-links">
                <a href="19-event-loop-spec.html" class="nav-link prev">ä¸Šä¸€èŠ‚ï¼šäº‹ä»¶å¾ªç¯è§„èŒƒ</a>
                <a href="../index.html" class="nav-link home">è¿”å›é¦–é¡µ</a>
                <a href="19-concurrency.html" class="nav-link next">ä¸‹ä¸€èŠ‚ï¼šå¹¶å‘æ¨¡å‹</a>
            </div>
        </div>
        
        <div class="code-panel">
            <h2 style="color: #60a5fa; margin-bottom: 1.5rem;">ğŸ’» äº¤äº’å¼ä»£ç ç¤ºä¾‹</h2>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 1ï¼šåŸºæœ¬æ‰§è¡Œé¡ºåº</h3>
                <div class="code-block">
                    <pre><code>// å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡åŸºç¡€
console.log('=== åŸºæœ¬æ‰§è¡Œé¡ºåº ===\n');

console.log('1: åŒæ­¥ä»£ç å¼€å§‹');

setTimeout(() => {
    console.log('2: setTimeoutï¼ˆå®ä»»åŠ¡ï¼‰');
}, 0);

Promise.resolve().then(() => {
    console.log('3: Promiseï¼ˆå¾®ä»»åŠ¡ï¼‰');
});

console.log('4: åŒæ­¥ä»£ç ç»“æŸ');

setTimeout(() => {
    console.log('\næ‰§è¡Œæµç¨‹:');
    console.log('  1. åŒæ­¥ä»£ç : 1, 4');
    console.log('  2. æ¸…ç©ºå¾®ä»»åŠ¡: 3');
    console.log('  3. ä¸‹ä¸€ä¸ªå®ä»»åŠ¡: 2');
}, 100);</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 2ï¼šåµŒå¥—å®ä»»åŠ¡</h3>
                <div class="code-block">
                    <pre><code>// å®ä»»åŠ¡ä¸­äº§ç”Ÿå¾®ä»»åŠ¡
console.log('=== åµŒå¥—æ‰§è¡Œ ===\n');

setTimeout(() => {
    console.log('1: timeout1');
    Promise.resolve().then(() => {
        console.log('2: promise1ï¼ˆåœ¨timeout1åï¼‰');
    });
}, 0);

setTimeout(() => {
    console.log('3: timeout2');
    Promise.resolve().then(() => {
        console.log('4: promise2ï¼ˆåœ¨timeout2åï¼‰');
    });
}, 0);

setTimeout(() => {
    console.log('\nè¯´æ˜:');
    console.log('  æ¯ä¸ªå®ä»»åŠ¡åï¼Œå¾®ä»»åŠ¡é˜Ÿåˆ—éƒ½ä¼šæ¸…ç©º');
    console.log('  timeout1 â†’ promise1 â†’ timeout2 â†’ promise2');
}, 200);</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 3ï¼šå¾®ä»»åŠ¡é“¾</h3>
                <div class="code-block">
                    <pre><code>// å¾®ä»»åŠ¡äº§ç”Ÿæ–°çš„å¾®ä»»åŠ¡
console.log('=== å¾®ä»»åŠ¡é“¾ ===\n');

Promise.resolve()
    .then(() => {
        console.log('1: promise1');
        return Promise.resolve();
    })
    .then(() => {
        console.log('2: promise2');
    });

Promise.resolve().then(() => {
    console.log('3: promise3');
    Promise.resolve().then(() => {
        console.log('4: promise4ï¼ˆåµŒå¥—ï¼‰');
    });
});

setTimeout(() => {
    console.log('5: timeout');
}, 0);

setTimeout(() => {
    console.log('\næ‰§è¡Œé¡ºåº:');
    console.log('  å¾®ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œæ‰ä¼šæ‰§è¡Œ timeout');
}, 100);</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 4ï¼šasync/await æ—¶æœº</h3>
                <div class="code-block">
                    <pre><code>// async/await çš„æ‰§è¡Œæ—¶æœº
console.log('=== async/await ===\n');

async function test() {
    console.log('1: async å‡½æ•°å¼€å§‹ï¼ˆåŒæ­¥ï¼‰');
    
    await Promise.resolve();
    
    console.log('2: await åï¼ˆå¾®ä»»åŠ¡ï¼‰');
}

console.log('3: script start');

test();

Promise.resolve().then(() => {
    console.log('4: æ™®é€š promise');
});

console.log('5: script end');

setTimeout(() => {
    console.log('\nè¯´æ˜:');
    console.log('  await å‰: åŒæ­¥æ‰§è¡Œ');
    console.log('  await å: å¾®ä»»åŠ¡æ‰§è¡Œ');
}, 50);</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 5ï¼šå¤æ‚æ··åˆ</h3>
                <div class="code-block">
                    <pre><code>// å¤æ‚çš„å®ä»»åŠ¡å¾®ä»»åŠ¡æ··åˆ
console.log('=== å¤æ‚æ··åˆ ===\n');

console.log('1');

setTimeout(() => {
    console.log('2: timeout1');
    Promise.resolve().then(() => {
        console.log('3: promise in timeout');
    });
}, 0);

Promise.resolve()
    .then(() => {
        console.log('4: promise1');
        setTimeout(() => {
            console.log('5: timeout in promise');
        }, 0);
    })
    .then(() => {
        console.log('6: promise2');
    });

console.log('7');

setTimeout(() => {
    console.log('\nåˆ†æ:');
    console.log('  1,7: åŒæ­¥');
    console.log('  4,6: ç¬¬ä¸€æ‰¹å¾®ä»»åŠ¡');
    console.log('  2: ç¬¬ä¸€ä¸ª timeout');
    console.log('  3: timeout äº§ç”Ÿçš„å¾®ä»»åŠ¡');
    console.log('  5: ç¬¬äºŒä¸ª timeout');
}, 200);</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 6ï¼šä»»åŠ¡è¿½è¸ª</h3>
                <div class="code-block">
                    <pre><code>// è¿½è¸ªä»»åŠ¡æ‰§è¡Œ
console.log('=== ä»»åŠ¡è¿½è¸ª ===\n');

function trace(label, type) {
    return () => {
        console.log(`[${type.padEnd(5)}] ${label}`);
    };
}

console.log('[Sync ] è„šæœ¬å¼€å§‹');

setTimeout(trace('setTimeout 1', 'Macro'), 0);
setTimeout(trace('setTimeout 2', 'Macro'), 0);

Promise.resolve()
    .then(trace('Promise 1', 'Micro'))
    .then(trace('Promise 2', 'Micro'));

queueMicrotask(trace('queueMicrotask', 'Micro'));

Promise.resolve().then(trace('Promise 3', 'Micro'));

console.log('[Sync ] è„šæœ¬ç»“æŸ');

setTimeout(() => {
    console.log('\nå¯ä»¥æ¸…æ¥šçœ‹åˆ°æ‰§è¡Œé¡ºåº');
}, 150);</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
        </div>
    </div>
    
    <script src="../assets/js/common.js"></script>
</body>
</html>
