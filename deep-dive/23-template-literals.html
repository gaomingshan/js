<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨¡æ¿å­—ç¬¦ä¸²æ ‡ç­¾å‡½æ•° - JavaScript æ·±åº¦å­¦ä¹ </title>
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/page.css">
</head>
<body>
    <div class="page-layout">
        <div class="doc-panel">
            <h1>æ¨¡æ¿å­—ç¬¦ä¸²æ ‡ç­¾å‡½æ•°</h1>
            
            <h2>æ¦‚è¿°</h2>
            <p>æ ‡ç­¾å‡½æ•°ï¼ˆTagged Templateï¼‰æ˜¯æ¨¡æ¿å­—ç¬¦ä¸²çš„é«˜çº§ç”¨æ³•ï¼Œå…è®¸æˆ‘ä»¬è‡ªå®šä¹‰æ¨¡æ¿å­—ç¬¦ä¸²çš„å¤„ç†é€»è¾‘ã€‚</p>
            
            <h2>ä¸€ã€åŸºç¡€æ¨¡æ¿å­—ç¬¦ä¸²</h2>
            
            <h3>1.1 åŸºæœ¬ç”¨æ³•</h3>
            <pre><code>// æ™®é€šå­—ç¬¦ä¸²
const name = 'Alice';
const str1 = 'Hello, ' + name + '!';

// æ¨¡æ¿å­—ç¬¦ä¸²
const str2 = `Hello, ${name}!`;

// å¤šè¡Œ
const multiline = `
    Line 1
    Line 2
    Line 3
`;

// è¡¨è¾¾å¼
const a = 5;
const b = 10;
const str3 = `Sum: ${a + b}`;  // "Sum: 15"</code></pre>
            
            <h2>äºŒã€æ ‡ç­¾å‡½æ•°</h2>
            
            <h3>2.1 åŸºæœ¬æ¦‚å¿µ</h3>
            <pre><code>// æ ‡ç­¾å‡½æ•°ï¼šå¤„ç†æ¨¡æ¿å­—ç¬¦ä¸²çš„å‡½æ•°
function tag(strings, ...values) {
    console.log(strings);  // å­—ç¬¦ä¸²æ•°ç»„
    console.log(values);   // å€¼æ•°ç»„
}

const name = 'Alice';
const age = 25;

tag`Hello, ${name}! You are ${age} years old.`;

// è¾“å‡ºï¼š
// strings: ['Hello, ', '! You are ', ' years old.']
// values: ['Alice', 25]</code></pre>
            
            <h3>2.2 å‚æ•°è¯´æ˜</h3>
            <pre><code>function myTag(strings, ...values) {
    // strings: æ¨¡æ¿å­—ç¬¦ä¸²çš„å­—ç¬¦ä¸²éƒ¨åˆ†
    // - æ€»æ˜¯æ¯” values å¤šä¸€ä¸ªå…ƒç´ 
    // - strings[0] åœ¨ç¬¬ä¸€ä¸ªæ’å€¼å‰
    // - strings[strings.length - 1] åœ¨æœ€åä¸€ä¸ªæ’å€¼å
    
    // values: æ‰€æœ‰æ’å€¼è¡¨è¾¾å¼çš„å€¼
    
    // strings.raw: åŸå§‹å­—ç¬¦ä¸²ï¼ˆä¸å¤„ç†è½¬ä¹‰ï¼‰
}

myTag`a${1}b${2}c`;
// strings: ['a', 'b', 'c']
// values: [1, 2]</code></pre>
            
            <h2>ä¸‰ã€å®é™…åº”ç”¨</h2>
            
            <h3>3.1 HTML è½¬ä¹‰</h3>
            <pre><code>// è‡ªåŠ¨è½¬ä¹‰ HTML ç‰¹æ®Šå­—ç¬¦
function html(strings, ...values) {
    const escape = (str) => String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    
    return strings.reduce((result, str, i) => {
        const value = values[i - 1];
        return result + escape(value) + str;
    });
}

const userInput = '<script>alert("XSS")</script>';
const safe = html`<div>${userInput}</div>`;
// <div>&lt;script&gt;alert(&quot;XSS&quot;)&lt;/script&gt;</div></code></pre>
            
            <h3>3.2 SQL æŸ¥è¯¢</h3>
            <pre><code>// é˜²æ­¢ SQL æ³¨å…¥
function sql(strings, ...values) {
    // ç®€åŒ–ç¤ºä¾‹ï¼Œå®é™…éœ€è¦æ›´å¤æ‚çš„å¤„ç†
    const escape = (value) => {
        if (typeof value === 'string') {
            return `'${value.replace(/'/g, "''")}'`;
        }
        return value;
    };
    
    let query = strings[0];
    for (let i = 0; i < values.length; i++) {
        query += escape(values[i]) + strings[i + 1];
    }
    
    return query;
}

const username = "admin";
const query = sql`SELECT * FROM users WHERE name = ${username}`;
// SELECT * FROM users WHERE name = 'admin'</code></pre>
            
            <h3>3.3 å›½é™…åŒ–ï¼ˆi18nï¼‰</h3>
            <pre><code>// å¤šè¯­è¨€æ”¯æŒ
const translations = {
    en: {
        greeting: (name) => `Hello, ${name}!`,
        farewell: (name) => `Goodbye, ${name}!`
    },
    zh: {
        greeting: (name) => `ä½ å¥½ï¼Œ${name}ï¼`,
        farewell: (name) => `å†è§ï¼Œ${name}ï¼`
    }
};

function i18n(lang) {
    return function(strings, ...values) {
        const key = strings.join('$');
        const template = translations[lang][key];
        
        if (!template) {
            return strings.reduce((result, str, i) => {
                return result + str + (values[i] || '');
            }, '');
        }
        
        return template(...values);
    };
}

const t = i18n('zh');
const message = t`greeting${'Alice'}`;
console.log(message);  // "ä½ å¥½ï¼ŒAliceï¼"</code></pre>
            
            <h3>3.4 æ ·å¼åŒ–è¾“å‡º</h3>
            <pre><code>// æ§åˆ¶å°æ ·å¼è¾“å‡º
function styled(strings, ...values) {
    const styles = [];
    const text = strings.reduce((result, str, i) => {
        if (values[i] && values[i].style) {
            styles.push(values[i].style);
            return result + str + '%c' + values[i].text + '%c';
        }
        return result + str + (values[i] || '');
    }, '');
    
    const allStyles = styles.flatMap(s => [s, '']);
    console.log(text, ...allStyles);
}

styled`Hello, ${{
    text: 'Alice',
    style: 'color: red; font-weight: bold'
}}!`;
// åœ¨æ§åˆ¶å°è¾“å‡ºå½©è‰²æ–‡æœ¬</code></pre>
            
            <h2>å››ã€é«˜çº§ç”¨æ³•</h2>
            
            <h3>4.1 Raw å­—ç¬¦ä¸²</h3>
            <pre><code>// è®¿é—®åŸå§‹å­—ç¬¦ä¸²
function tag(strings, ...values) {
    console.log(strings[0]);      // å¤„ç†è¿‡çš„å­—ç¬¦ä¸²
    console.log(strings.raw[0]);  // åŸå§‹å­—ç¬¦ä¸²
}

tag`Line 1\nLine 2`;
// strings[0]: "Line 1
//              Line 2"
// strings.raw[0]: "Line 1\\nLine 2"

// String.rawï¼šå†…ç½®æ ‡ç­¾å‡½æ•°
const path = String.raw`C:\Users\Alice\Documents`;
console.log(path);  // "C:\Users\Alice\Documents"</code></pre>
            
            <h3>4.2 åµŒå¥—æ ‡ç­¾</h3>
            <pre><code>// æ ‡ç­¾å‡½æ•°å¯ä»¥åµŒå¥—
function upper(strings, ...values) {
    return String.raw(strings, ...values).toUpperCase();
}

function repeat(n) {
    return function(strings, ...values) {
        const text = String.raw(strings, ...values);
        return text.repeat(n);
    };
}

const text = upper`hello ${'world'}`;
console.log(text);  // "HELLO WORLD"

const repeated = repeat(3)`abc`;
console.log(repeated);  // "abcabcabc"</code></pre>
            
            <h2>äº”ã€å®ç”¨åº“ç¤ºä¾‹</h2>
            
            <h3>5.1 CSS-in-JS</h3>
            <pre><code>// ç±»ä¼¼ styled-components
function css(strings, ...values) {
    const styles = strings.reduce((result, str, i) => {
        return result + str + (values[i] || '');
    }, '');
    
    return {
        toString() { return styles; },
        styles
    };
}

const color = 'blue';
const buttonStyles = css`
    background-color: ${color};
    padding: 10px 20px;
    border-radius: 4px;
`;

console.log(buttonStyles.styles);</code></pre>
            
            <h3>5.2 GraphQL</h3>
            <pre><code>// GraphQL æŸ¥è¯¢
function gql(strings, ...values) {
    return {
        kind: 'Document',
        query: String.raw(strings, ...values).trim()
    };
}

const GET_USER = gql`
    query GetUser($id: ID!) {
        user(id: $id) {
            name
            email
        }
    }
`;

console.log(GET_USER.query);</code></pre>
            
            <h2>å…­ã€æœ€ä½³å®è·µ</h2>
            
            <div class="tip">
                <ol>
                    <li><strong>å®‰å…¨æ€§</strong>ï¼šå§‹ç»ˆè½¬ä¹‰ç”¨æˆ·è¾“å…¥</li>
                    <li><strong>æ€§èƒ½</strong>ï¼šé¿å…åœ¨å¾ªç¯ä¸­ä½¿ç”¨å¤æ‚æ ‡ç­¾å‡½æ•°</li>
                    <li><strong>ç±»å‹æ£€æŸ¥</strong>ï¼šéªŒè¯æ’å€¼ç±»å‹</li>
                    <li><strong>é”™è¯¯å¤„ç†</strong>ï¼šæä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯</li>
                    <li><strong>æ–‡æ¡£åŒ–</strong>ï¼šæ ‡ç­¾å‡½æ•°è¦æœ‰æ¸…æ™°æ–‡æ¡£</li>
                </ol>
            </div>
            
            <h2>å‚è€ƒèµ„æ–™</h2>
            <ul>
                <li><a href="https://tc39.es/ecma262/#sec-template-literals" target="_blank">ECMAScript - Template Literals</a></li>
                <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Template_literals" target="_blank">MDN - æ¨¡æ¿å­—ç¬¦ä¸²</a></li>
            </ul>
            
            <div class="nav-links">
                <a href="23-spread-rest.html" class="nav-link prev">ä¸Šä¸€èŠ‚ï¼šæ‰©å±•è¿ç®—ç¬¦</a>
                <a href="../index.html" class="nav-link home">è¿”å›é¦–é¡µ</a>
                <a href="23-optional-chaining.html" class="nav-link next">ä¸‹ä¸€èŠ‚ï¼šå¯é€‰é“¾ä¸ç©ºå€¼åˆå¹¶</a>
            </div>
        </div>
        
        <div class="code-panel">
            <h2 style="color: #60a5fa; margin-bottom: 1.5rem;">ğŸ’» äº¤äº’å¼ä»£ç ç¤ºä¾‹</h2>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 1ï¼šåŸºæœ¬æ ‡ç­¾å‡½æ•°</h3>
                <div class="code-block">
                    <pre><code>// æ ‡ç­¾å‡½æ•°åŸºç¡€
console.log('=== æ ‡ç­¾å‡½æ•° ===\n');

function tag(strings, ...values) {
    console.log('strings:', strings);
    console.log('values:', values);
    console.log('strings.raw:', strings.raw);
}

const name = 'Alice';
const age = 25;

tag`Hello, ${name}! You are ${age} years old.`;

console.log('\nå­—ç¬¦ä¸²æ•°ç»„é•¿åº¦æ¯”å€¼æ•°ç»„å¤š1');</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 2ï¼šHTML è½¬ä¹‰</h3>
                <div class="code-block">
                    <pre><code>// HTML è½¬ä¹‰æ ‡ç­¾å‡½æ•°
console.log('=== HTML è½¬ä¹‰ ===\n');

function html(strings, ...values) {
    const escape = (str) => String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;');
    
    let result = strings[0];
    for (let i = 0; i < values.length; i++) {
        result += escape(values[i]) + strings[i + 1];
    }
    return result;
}

const userInput = '<script>alert("XSS")</script>';
console.log('åŸå§‹è¾“å…¥:', userInput);

const safe = html`<div>${userInput}</div>`;
console.log('\nè½¬ä¹‰å:', safe);</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 3ï¼šé«˜äº®æ˜¾ç¤º</h3>
                <div class="code-block">
                    <pre><code>// é«˜äº®å…³é”®è¯
console.log('=== é«˜äº®æ˜¾ç¤º ===\n');

function highlight(strings, ...values) {
    let result = strings[0];
    for (let i = 0; i < values.length; i++) {
        result += `**${values[i]}**` + strings[i + 1];
    }
    return result;
}

const name = 'Alice';
const score = 95;

const text = highlight`Student ${name} scored ${score} points!`;
console.log(text);</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 4ï¼šString.raw</h3>
                <div class="code-block">
                    <pre><code>// String.raw ç¤ºä¾‹
console.log('=== String.raw ===\n');

console.log('æ™®é€šæ¨¡æ¿å­—ç¬¦ä¸²:');
console.log(`Line 1\nLine 2`);

console.log('\nString.raw:');
console.log(String.raw`Line 1\nLine 2`);

console.log('\næ–‡ä»¶è·¯å¾„:');
const path = String.raw`C:\Users\Alice\Documents`;
console.log(path);</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 5ï¼šæ ¼å¼åŒ–</h3>
                <div class="code-block">
                    <pre><code>// æ•°å­—æ ¼å¼åŒ–
console.log('=== æ ¼å¼åŒ– ===\n');

function currency(strings, ...values) {
    let result = strings[0];
    for (let i = 0; i < values.length; i++) {
        const formatted = typeof values[i] === 'number'
            ? `$${values[i].toFixed(2)}`
            : values[i];
        result += formatted + strings[i + 1];
    }
    return result;
}

const price = 19.5;
const tax = 1.95;

const receipt = currency`Price: ${price}, Tax: ${tax}, Total: ${price + tax}`;
console.log(receipt);</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 6ï¼šæ¡ä»¶æ’å€¼</h3>
                <div class="code-block">
                    <pre><code>// æ¡ä»¶æ’å€¼
console.log('=== æ¡ä»¶æ’å€¼ ===\n');

function optional(strings, ...values) {
    let result = strings[0];
    for (let i = 0; i < values.length; i++) {
        const value = values[i];
        if (value !== null && value !== undefined) {
            result += value + strings[i + 1];
        } else {
            result += strings[i + 1];
        }
    }
    return result.trim();
}

const firstName = 'Alice';
const middleName = null;
const lastName = 'Smith';

const fullName = optional`${firstName} ${middleName} ${lastName}`;
console.log('fullName:', fullName);</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
        </div>
    </div>
    
    <script src="../assets/js/common.js"></script>
</body>
</html>
