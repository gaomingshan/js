<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript å†…å­˜æ¨¡å‹ - JavaScript æ·±åº¦å­¦ä¹ </title>
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/page.css">
</head>
<body>
    <div class="page-layout">
        <div class="doc-panel">
            <h1>JavaScript å†…å­˜æ¨¡å‹</h1>
            
            <h2>æ¦‚è¿°</h2>
            <p>ç†è§£ JavaScript çš„å†…å­˜æ¨¡å‹æ˜¯ä¼˜åŒ–æ€§èƒ½å’Œé¿å…å†…å­˜æ³„æ¼çš„å…³é”®ã€‚JavaScript å¼•æ“ä½¿ç”¨å †ï¼ˆHeapï¼‰å’Œæ ˆï¼ˆStackï¼‰æ¥ç®¡ç†å†…å­˜ï¼Œä¸åŒç±»å‹çš„æ•°æ®å­˜å‚¨åœ¨ä¸åŒçš„ä½ç½®ã€‚</p>
            
            <h2>ä¸€ã€å†…å­˜ç»“æ„</h2>
            
            <h3>1.1 æ ˆå†…å­˜ï¼ˆStackï¼‰</h3>
            <div class="info">
                <p><strong>å­˜å‚¨å†…å®¹</strong>ï¼š</p>
                <ul>
                    <li>åŸºæœ¬ç±»å‹å€¼ï¼ˆnumber, string, boolean, null, undefined, symbol, bigintï¼‰</li>
                    <li>å¼•ç”¨ç±»å‹çš„å¼•ç”¨åœ°å€</li>
                    <li>å‡½æ•°è°ƒç”¨æ ˆå¸§</li>
                </ul>
                
                <p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
                <ul>
                    <li>å¤§å°å›ºå®šï¼Œç©ºé—´è¿ç»­</li>
                    <li>è‡ªåŠ¨åˆ†é…å’Œé‡Šæ”¾</li>
                    <li>è®¿é—®é€Ÿåº¦å¿«</li>
                    <li>LIFOï¼ˆåè¿›å…ˆå‡ºï¼‰</li>
                </ul>
            </div>
            
            <pre><code>// æ ˆå†…å­˜ç¤ºä¾‹
function test() {
    let x = 1;           // x å­˜å‚¨åœ¨æ ˆä¸­
    let y = 2;           // y å­˜å‚¨åœ¨æ ˆä¸­
    let str = 'hello';   // 'hello' å­˜å‚¨åœ¨æ ˆä¸­ï¼ˆå°å­—ç¬¦ä¸²å¯èƒ½ä¼˜åŒ–ï¼‰
}

// å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œæ ˆå¸§é”€æ¯ï¼Œå†…å­˜è‡ªåŠ¨é‡Šæ”¾</code></pre>
            
            <h3>1.2 å †å†…å­˜ï¼ˆHeapï¼‰</h3>
            <div class="info">
                <p><strong>å­˜å‚¨å†…å®¹</strong>ï¼š</p>
                <ul>
                    <li>å¯¹è±¡ï¼ˆObjectï¼‰</li>
                    <li>æ•°ç»„ï¼ˆArrayï¼‰</li>
                    <li>å‡½æ•°ï¼ˆFunctionï¼‰</li>
                    <li>å¤§å­—ç¬¦ä¸²</li>
                </ul>
                
                <p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
                <ul>
                    <li>å¤§å°ä¸å›ºå®šï¼ŒåŠ¨æ€åˆ†é…</li>
                    <li>éœ€è¦åƒåœ¾å›æ”¶å™¨ç®¡ç†</li>
                    <li>è®¿é—®é€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢</li>
                    <li>å¯ä»¥å­˜å‚¨å¤§é‡æ•°æ®</li>
                </ul>
            </div>
            
            <pre><code>// å †å†…å­˜ç¤ºä¾‹
function test() {
    let obj = { x: 1 };  // å¯¹è±¡å­˜å‚¨åœ¨å †ä¸­ï¼Œobj ä¿å­˜å¼•ç”¨åœ°å€
    let arr = [1, 2, 3]; // æ•°ç»„å­˜å‚¨åœ¨å †ä¸­ï¼Œarr ä¿å­˜å¼•ç”¨åœ°å€
}

// å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œæ ˆä¸­çš„å¼•ç”¨è¢«æ¸…é™¤
// ä½†å †ä¸­çš„å¯¹è±¡éœ€è¦åƒåœ¾å›æ”¶å™¨å¤„ç†</code></pre>
            
            <h2>äºŒã€å˜é‡å­˜å‚¨</h2>
            
            <h3>2.1 åŸºæœ¬ç±»å‹</h3>
            <pre><code>// åŸºæœ¬ç±»å‹ç›´æ¥å­˜å‚¨å€¼
let a = 1;
let b = a;    // å¤åˆ¶å€¼
b = 2;

console.log(a);  // 1ï¼ˆa ä¸å—å½±å“ï¼‰
console.log(b);  // 2

// å†…å­˜å¸ƒå±€ï¼š
// æ ˆå†…å­˜ï¼š
// a: 1
// b: 2</code></pre>
            
            <h3>2.2 å¼•ç”¨ç±»å‹</h3>
            <pre><code>// å¼•ç”¨ç±»å‹å­˜å‚¨å¼•ç”¨åœ°å€
let obj1 = { x: 1 };
let obj2 = obj1;  // å¤åˆ¶å¼•ç”¨åœ°å€
obj2.x = 2;

console.log(obj1.x);  // 2ï¼ˆobj1 å—å½±å“ï¼‰
console.log(obj2.x);  // 2

// å†…å­˜å¸ƒå±€ï¼š
// æ ˆå†…å­˜ï¼š
// obj1: 0x001ï¼ˆå †åœ°å€ï¼‰
// obj2: 0x001ï¼ˆç›¸åŒåœ°å€ï¼‰
// 
// å †å†…å­˜ï¼š
// 0x001: { x: 2 }</code></pre>
            
            <h3>2.3 æ·±æ‹·è´ vs æµ…æ‹·è´</h3>
            <pre><code>// æµ…æ‹·è´ï¼šåªå¤åˆ¶ç¬¬ä¸€å±‚
const obj1 = {
    x: 1,
    nested: { y: 2 }
};

const obj2 = { ...obj1 };  // æµ…æ‹·è´
obj2.x = 10;
obj2.nested.y = 20;

console.log(obj1.x);         // 1ï¼ˆä¸å—å½±å“ï¼‰
console.log(obj1.nested.y);  // 20ï¼ˆå—å½±å“ï¼ï¼‰

// æ·±æ‹·è´ï¼šé€’å½’å¤åˆ¶æ‰€æœ‰å±‚
const obj3 = JSON.parse(JSON.stringify(obj1));
obj3.nested.y = 30;

console.log(obj1.nested.y);  // 20ï¼ˆä¸å—å½±å“ï¼‰</code></pre>
            
            <h2>ä¸‰ã€å†…å­˜ç”Ÿå‘½å‘¨æœŸ</h2>
            
            <h3>3.1 åˆ†é…å†…å­˜</h3>
            <pre><code>// 1. åŸºæœ¬ç±»å‹åˆ†é…
let num = 42;           // æ ˆä¸­åˆ†é… 8 å­—èŠ‚ï¼ˆ64ä½ï¼‰
let str = 'hello';      // æ ˆä¸­åˆ†é…å¼•ç”¨ï¼Œå †ä¸­åˆ†é…å­—ç¬¦ä¸²

// 2. å¯¹è±¡åˆ†é…
let obj = {
    name: 'Alice',
    age: 25
};
// å †ä¸­åˆ†é…å¯¹è±¡ç©ºé—´
// æ ˆä¸­åˆ†é…å¼•ç”¨

// 3. æ•°ç»„åˆ†é…
let arr = new Array(1000);  // å †ä¸­åˆ†é…è¿ç»­ç©ºé—´

// 4. å‡½æ•°åˆ†é…
function fn() {}       // å †ä¸­åˆ†é…å‡½æ•°å¯¹è±¡</code></pre>
            
            <h3>3.2 ä½¿ç”¨å†…å­˜</h3>
            <pre><code>// è¯»å–å’Œå†™å…¥å†…å­˜
let obj = { x: 1 };

// è¯»å–
console.log(obj.x);    // è®¿é—®å †å†…å­˜

// å†™å…¥
obj.x = 2;             // ä¿®æ”¹å †å†…å­˜

// ä¼ é€’å¼•ç”¨
function modify(o) {
    o.x = 3;           // ä¿®æ”¹åŒä¸€ä¸ªå †å¯¹è±¡
}

modify(obj);
console.log(obj.x);    // 3</code></pre>
            
            <h3>3.3 é‡Šæ”¾å†…å­˜</h3>
            <pre><code>// æ ˆå†…å­˜è‡ªåŠ¨é‡Šæ”¾
function test() {
    let x = 1;
}  // x çš„æ ˆç©ºé—´è‡ªåŠ¨é‡Šæ”¾

// å †å†…å­˜éœ€è¦åƒåœ¾å›æ”¶
let obj = { x: 1 };
obj = null;  // è§£é™¤å¼•ç”¨ï¼Œç­‰å¾…åƒåœ¾å›æ”¶

// é—­åŒ…å¯¼è‡´å†…å­˜ä¿ç•™
function outer() {
    let data = new Array(1000000);
    
    return function inner() {
        return data.length;  // data è¢«é—­åŒ…å¼•ç”¨ï¼Œä¸ä¼šé‡Šæ”¾
    };
}</code></pre>
            
            <h2>å››ã€å†…å­˜é™åˆ¶</h2>
            
            <h3>4.1 V8 å†…å­˜é™åˆ¶</h3>
            <pre><code>// V8 é»˜è®¤å†…å­˜é™åˆ¶
// 64ä½ç³»ç»Ÿï¼š
// - è€ç”Ÿä»£ï¼ˆOld Generationï¼‰ï¼šçº¦ 1.4 GB
// - æ–°ç”Ÿä»£ï¼ˆNew Generationï¼‰ï¼šçº¦ 32 MB
// 
// 32ä½ç³»ç»Ÿï¼š
// - è€ç”Ÿä»£ï¼šçº¦ 700 MB
// - æ–°ç”Ÿä»£ï¼šçº¦ 16 MB

// æŸ¥çœ‹å†…å­˜ä½¿ç”¨ï¼ˆNode.jsï¼‰
console.log(process.memoryUsage());
// {
//   rss: æ€»å†…å­˜,
//   heapTotal: å †æ€»å¤§å°,
//   heapUsed: å·²ä½¿ç”¨å †,
//   external: C++ å¯¹è±¡å†…å­˜
// }</code></pre>
            
            <h3>4.2 æ ˆæº¢å‡º</h3>
            <pre><code>// æ ˆç©ºé—´æœ‰é™ï¼Œæ·±åº¦é€’å½’å¯èƒ½å¯¼è‡´æ ˆæº¢å‡º
function recursion(n) {
    if (n === 0) return;
    recursion(n - 1);  // æ¯æ¬¡è°ƒç”¨å ç”¨æ ˆç©ºé—´
}

try {
    recursion(100000);  // RangeError: Maximum call stack size exceeded
} catch (e) {
    console.log('æ ˆæº¢å‡º');
}

// è§£å†³æ–¹æ¡ˆï¼šå°¾è°ƒç”¨ä¼˜åŒ–æˆ–æ”¹ç”¨è¿­ä»£</code></pre>
            
            <h2>äº”ã€å­—ç¬¦ä¸²çš„ç‰¹æ®Šå¤„ç†</h2>
            
            <h3>5.1 å­—ç¬¦ä¸²ä¸å¯å˜æ€§</h3>
            <pre><code>// JavaScript å­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„
let str = 'hello';
str[0] = 'H';          // æ— æ•ˆæ“ä½œ
console.log(str);      // "hello"ï¼ˆæœªæ”¹å˜ï¼‰

// ä»»ä½•"ä¿®æ”¹"éƒ½ä¼šåˆ›å»ºæ–°å­—ç¬¦ä¸²
str = str.toUpperCase();  // åˆ›å»ºæ–°å­—ç¬¦ä¸² "HELLO"

// å†…å­˜å½±å“
let result = '';
for (let i = 0; i < 10000; i++) {
    result += 'x';  // æ¯æ¬¡éƒ½åˆ›å»ºæ–°å­—ç¬¦ä¸²ï¼Œæ•ˆç‡ä½
}

// ä¼˜åŒ–ï¼šä½¿ç”¨æ•°ç»„
let arr = [];
for (let i = 0; i < 10000; i++) {
    arr.push('x');
}
let result2 = arr.join('');  // åªåˆ›å»ºä¸€æ¬¡æœ€ç»ˆå­—ç¬¦ä¸²</code></pre>
            
            <h3>5.2 å­—ç¬¦ä¸²é©»ç•™ï¼ˆString Interningï¼‰</h3>
            <pre><code>// ç›¸åŒçš„å­—ç¬¦ä¸²å­—é¢é‡å¯èƒ½å…±äº«å†…å­˜
let str1 = 'hello';
let str2 = 'hello';
console.log(str1 === str2);  // trueï¼ˆå¯èƒ½å…±äº«å†…å­˜ï¼‰

// åŠ¨æ€åˆ›å»ºçš„å­—ç¬¦ä¸²
let str3 = 'hel' + 'lo';
console.log(str1 === str3);  // trueï¼ˆå¼•æ“ä¼˜åŒ–ï¼‰

// å¤§å­—ç¬¦ä¸²ä¸ä¼šé©»ç•™
let big1 = 'x'.repeat(1000);
let big2 = 'x'.repeat(1000);
console.log(big1 === big2);  // trueï¼ˆå€¼ç›¸ç­‰ï¼‰
// ä½†å®ƒä»¬åœ¨å†…å­˜ä¸­æ˜¯ä¸åŒçš„å¯¹è±¡</code></pre>
            
            <h2>å…­ã€æ•°ç»„çš„å†…å­˜å¸ƒå±€</h2>
            
            <h3>6.1 è¿ç»­æ•°ç»„ vs å­—å…¸æ•°ç»„</h3>
            <pre><code>// V8 å¯¹æ•°ç»„æœ‰ä¸¤ç§å†…å­˜å¸ƒå±€

// 1. å¿«é€Ÿæ•°ç»„ï¼ˆè¿ç»­å†…å­˜ï¼‰
const arr1 = [1, 2, 3, 4, 5];
// å†…å­˜ï¼š[1][2][3][4][5]ï¼ˆè¿ç»­ï¼‰

// 2. ç¨€ç–æ•°ç»„ï¼ˆå“ˆå¸Œè¡¨ï¼‰
const arr2 = [];
arr2[0] = 1;
arr2[1000] = 2;
// å†…å­˜ï¼š{ 0: 1, 1000: 2 }ï¼ˆå“ˆå¸Œè¡¨ï¼‰

// æ€§èƒ½å·®å¼‚
console.time('dense');
for (let i = 0; i < 1000000; i++) {
    arr1[i % 5];
}
console.timeEnd('dense');  // å¿«

console.time('sparse');
for (let i = 0; i < 1000000; i++) {
    arr2[i];
}
console.timeEnd('sparse');  // æ…¢</code></pre>
            
            <h3>6.2 ç±»å‹åŒ–æ•°ç»„</h3>
            <pre><code>// TypedArray ä½¿ç”¨è¿ç»­å†…å­˜ï¼Œæ€§èƒ½æ›´å¥½
const int32Array = new Int32Array(1000);
// æ¯ä¸ªå…ƒç´ å›ºå®š 4 å­—èŠ‚ï¼Œæ€»å…± 4000 å­—èŠ‚

// æ™®é€šæ•°ç»„
const normalArray = new Array(1000);
// æ¯ä¸ªå…ƒç´ å¯èƒ½æ˜¯ä»»æ„ç±»å‹ï¼Œéœ€è¦é¢å¤–ä¿¡æ¯

// æ€§èƒ½å¯¹æ¯”
console.time('TypedArray');
for (let i = 0; i < 1000000; i++) {
    int32Array[i % 1000] = i;
}
console.timeEnd('TypedArray');  // å¿«

console.time('Array');
for (let i = 0; i < 1000000; i++) {
    normalArray[i % 1000] = i;
}
console.timeEnd('Array');  // è¾ƒæ…¢</code></pre>
            
            <h2>ä¸ƒã€WeakMap å’Œ WeakSet</h2>
            
            <h3>7.1 å¼±å¼•ç”¨</h3>
            <pre><code>// WeakMap çš„é”®æ˜¯å¼±å¼•ç”¨
let obj = { data: 'value' };
const weakMap = new WeakMap();
weakMap.set(obj, 'metadata');

// obj è¢«å¼•ç”¨
console.log(weakMap.get(obj));  // "metadata"

// è§£é™¤å¼ºå¼•ç”¨
obj = null;

// obj å¯ä»¥è¢«åƒåœ¾å›æ”¶ï¼ŒWeakMap ä¸­çš„æ¡ç›®ä¹Ÿä¼šè‡ªåŠ¨æ¸…é™¤
// æ™®é€š Map ä¼šé˜»æ­¢åƒåœ¾å›æ”¶

// ä½¿ç”¨åœºæ™¯ï¼šç¼“å­˜ã€ç§æœ‰æ•°æ®
const privateData = new WeakMap();

class Person {
    constructor(name) {
        privateData.set(this, { name });
    }
    
    getName() {
        return privateData.get(this).name;
    }
}

let person = new Person('Alice');
console.log(person.getName());  // "Alice"
person = null;  // Person å®ä¾‹å’Œç§æœ‰æ•°æ®éƒ½å¯ä»¥è¢«å›æ”¶</code></pre>
            
            <h2>å…«ã€å†…å­˜ç›‘æ§</h2>
            
            <h3>8.1 æµè§ˆå™¨ DevTools</h3>
            <pre><code>// Chrome DevTools Memory Profiler

// 1. Heap Snapshotï¼ˆå †å¿«ç…§ï¼‰
// - æŸ¥çœ‹å½“å‰å†…å­˜çŠ¶æ€
// - å¯¹æ¯”å¤šä¸ªå¿«ç…§æ‰¾å‡ºå†…å­˜æ³„æ¼

// 2. Allocation Timelineï¼ˆåˆ†é…æ—¶é—´çº¿ï¼‰
// - å®æ—¶ç›‘æ§å†…å­˜åˆ†é…
// - æ‰¾å‡ºé¢‘ç¹åˆ†é…çš„å¯¹è±¡

// 3. Allocation Samplingï¼ˆåˆ†é…é‡‡æ ·ï¼‰
// - ä½å¼€é”€çš„å†…å­˜é‡‡æ ·
// - æ‰¾å‡ºå†…å­˜çƒ­ç‚¹</code></pre>
            
            <h3>8.2 Node.js ç›‘æ§</h3>
            <pre><code>// Node.js å†…å­˜ç›‘æ§
const used = process.memoryUsage();

console.log({
    rss: `${Math.round(used.rss / 1024 / 1024)} MB`,       // æ€»å†…å­˜
    heapTotal: `${Math.round(used.heapTotal / 1024 / 1024)} MB`,  // å †æ€»é‡
    heapUsed: `${Math.round(used.heapUsed / 1024 / 1024)} MB`,    // å·²ä½¿ç”¨
    external: `${Math.round(used.external / 1024 / 1024)} MB`      // C++ å¯¹è±¡
});

// æ‰‹åŠ¨è§¦å‘åƒåœ¾å›æ”¶ï¼ˆéœ€è¦ --expose-gc å‚æ•°ï¼‰
if (global.gc) {
    global.gc();
    console.log('GC å®Œæˆ');
}</code></pre>
            
            <h2>ä¹ã€æœ€ä½³å®è·µ</h2>
            
            <div class="tip">
                <ol>
                    <li><strong>åŠæ—¶è§£é™¤å¼•ç”¨</strong>ï¼šä¸å†ä½¿ç”¨çš„å¯¹è±¡è®¾ä¸º null</li>
                    <li><strong>é¿å…å…¨å±€å˜é‡</strong>ï¼šå‡å°‘é•¿æœŸå ç”¨å†…å­˜</li>
                    <li><strong>ä½¿ç”¨å±€éƒ¨å˜é‡</strong>ï¼šå‡½æ•°ç»“æŸè‡ªåŠ¨é‡Šæ”¾</li>
                    <li><strong>å°å¿ƒé—­åŒ…</strong>ï¼šæ³¨æ„é—­åŒ…å¼•ç”¨çš„å˜é‡</li>
                    <li><strong>åˆç†ä½¿ç”¨ç¼“å­˜</strong>ï¼šä½¿ç”¨ WeakMap é¿å…æ³„æ¼</li>
                    <li><strong>é¿å…å¾ªç¯å¼•ç”¨</strong>ï¼šç°ä»£å¼•æ“èƒ½å¤„ç†ï¼Œä½†è¦æ³¨æ„</li>
                    <li><strong>ç›‘æ§å†…å­˜</strong>ï¼šå®šæœŸæ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µ</li>
                </ol>
            </div>
            
            <h2>å‚è€ƒèµ„æ–™</h2>
            <ul>
                <li><a href="https://v8.dev/blog/trash-talk" target="_blank">V8 - Trash talk: the Orinoco garbage collector</a></li>
                <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Memory_Management" target="_blank">MDN - å†…å­˜ç®¡ç†</a></li>
            </ul>
            
            <div class="nav-links">
                <a href="20-metaprogramming.html" class="nav-link prev">ä¸Šä¸€èŠ‚ï¼šå…ƒç¼–ç¨‹å®è·µ</a>
                <a href="../index.html" class="nav-link home">è¿”å›é¦–é¡µ</a>
                <a href="21-gc.html" class="nav-link next">ä¸‹ä¸€èŠ‚ï¼šåƒåœ¾å›æ”¶ç®—æ³•</a>
            </div>
        </div>
        
        <div class="code-panel">
            <h2 style="color: #60a5fa; margin-bottom: 1.5rem;">ğŸ’» äº¤äº’å¼ä»£ç ç¤ºä¾‹</h2>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 1ï¼šæ ˆä¸å †</h3>
                <div class="code-block">
                    <pre><code>// æ ˆå†…å­˜ vs å †å†…å­˜
console.log('=== æ ˆä¸å † ===\n');

console.log('1. åŸºæœ¬ç±»å‹ï¼ˆæ ˆï¼‰:');
let a = 1;
let b = a;
b = 2;
console.log('  a =', a, 'ï¼ˆä¸å—å½±å“ï¼‰');
console.log('  b =', b);

console.log('\n2. å¼•ç”¨ç±»å‹ï¼ˆå †ï¼‰:');
let obj1 = { x: 1 };
let obj2 = obj1;
obj2.x = 2;
console.log('  obj1.x =', obj1.x, 'ï¼ˆå—å½±å“ï¼‰');
console.log('  obj2.x =', obj2.x);

console.log('\nè¯´æ˜:');
console.log('  åŸºæœ¬ç±»å‹: å¤åˆ¶å€¼');
console.log('  å¼•ç”¨ç±»å‹: å¤åˆ¶å¼•ç”¨åœ°å€');</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 2ï¼šæµ…æ‹·è´ vs æ·±æ‹·è´</h3>
                <div class="code-block">
                    <pre><code>// æµ…æ‹·è´å’Œæ·±æ‹·è´çš„åŒºåˆ«
console.log('=== æµ…æ‹·è´ vs æ·±æ‹·è´ ===\n');

const original = {
    x: 1,
    nested: { y: 2 }
};

console.log('1. æµ…æ‹·è´:');
const shallow = { ...original };
shallow.x = 10;
shallow.nested.y = 20;

console.log('  original.x =', original.x);
console.log('  original.nested.y =', original.nested.y, 'ï¼ˆå—å½±å“ï¼‰');

console.log('\n2. æ·±æ‹·è´:');
const original2 = {
    x: 1,
    nested: { y: 2 }
};
const deep = JSON.parse(JSON.stringify(original2));
deep.x = 10;
deep.nested.y = 20;

console.log('  original2.x =', original2.x);
console.log('  original2.nested.y =', original2.nested.y, 'ï¼ˆä¸å—å½±å“ï¼‰');</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 3ï¼šå­—ç¬¦ä¸²ä¸å¯å˜æ€§</h3>
                <div class="code-block">
                    <pre><code>// å­—ç¬¦ä¸²çš„ä¸å¯å˜æ€§
console.log('=== å­—ç¬¦ä¸²ä¸å¯å˜ ===\n');

let str = 'hello';
console.log('åŸå­—ç¬¦ä¸²:', str);

console.log('\nå°è¯•ä¿®æ”¹:');
str[0] = 'H';
console.log('  str[0] = "H" å:', str, 'ï¼ˆæœªæ”¹å˜ï¼‰');

console.log('\nåˆ›å»ºæ–°å­—ç¬¦ä¸²:');
str = str.toUpperCase();
console.log('  toUpperCase():', str, 'ï¼ˆæ–°å­—ç¬¦ä¸²ï¼‰');

console.log('\nä½æ•ˆçš„å­—ç¬¦ä¸²æ‹¼æ¥:');
console.time('concat');
let result = '';
for (let i = 0; i < 1000; i++) {
    result += 'x';  // æ¯æ¬¡åˆ›å»ºæ–°å­—ç¬¦ä¸²
}
console.timeEnd('concat');

console.log('\né«˜æ•ˆçš„æ–¹å¼:');
console.time('array');
let arr = [];
for (let i = 0; i < 1000; i++) {
    arr.push('x');
}
result = arr.join('');
console.timeEnd('array');</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 4ï¼šæ•°ç»„å†…å­˜å¸ƒå±€</h3>
                <div class="code-block">
                    <pre><code>// è¿ç»­æ•°ç»„ vs ç¨€ç–æ•°ç»„
console.log('=== æ•°ç»„å†…å­˜å¸ƒå±€ ===\n');

console.log('1. è¿ç»­æ•°ç»„ï¼ˆå¿«ï¼‰:');
const dense = [1, 2, 3, 4, 5];
console.log('  é•¿åº¦:', dense.length);
console.log('  å†…å­˜: è¿ç»­');

console.log('\n2. ç¨€ç–æ•°ç»„ï¼ˆæ…¢ï¼‰:');
const sparse = [];
sparse[0] = 1;
sparse[1000] = 2;
console.log('  é•¿åº¦:', sparse.length);
console.log('  å†…å­˜: å“ˆå¸Œè¡¨');

console.log('\n3. æ€§èƒ½å¯¹æ¯”:');
console.time('dense');
for (let i = 0; i < 100000; i++) {
    dense[i % 5];
}
console.timeEnd('dense');

console.time('sparse');
for (let i = 0; i < 100000; i++) {
    sparse[i];
}
console.timeEnd('sparse');</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 5ï¼šWeakMap å¼±å¼•ç”¨</h3>
                <div class="code-block">
                    <pre><code>// WeakMap çš„å¼±å¼•ç”¨ç‰¹æ€§
console.log('=== WeakMap ===\n');

console.log('1. æ™®é€š Map:');
let obj1 = { data: 'value1' };
const map = new Map();
map.set(obj1, 'metadata');
console.log('  è®¾ç½®:', map.get(obj1));

obj1 = null;
console.log('  obj1 = null å');
console.log('  Map.size:', map.size, 'ï¼ˆä»ç„¶å ç”¨å†…å­˜ï¼‰');

console.log('\n2. WeakMap:');
let obj2 = { data: 'value2' };
const weakMap = new WeakMap();
weakMap.set(obj2, 'metadata');
console.log('  è®¾ç½®:', weakMap.get(obj2));

obj2 = null;
console.log('  obj2 = null å');
console.log('  ï¼ˆå¯¹è±¡å¯è¢«åƒåœ¾å›æ”¶ï¼‰');

console.log('\nè¯´æ˜:');
console.log('  Map: å¼ºå¼•ç”¨ï¼Œé˜»æ­¢ GC');
console.log('  WeakMap: å¼±å¼•ç”¨ï¼Œä¸é˜»æ­¢ GC');</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 6ï¼šé—­åŒ…å†…å­˜</h3>
                <div class="code-block">
                    <pre><code>// é—­åŒ…å¯¹å†…å­˜çš„å½±å“
console.log('=== é—­åŒ…å†…å­˜ ===\n');

function createClosure() {
    const largeData = new Array(100).fill('x');
    let count = 0;
    
    console.log('  åˆ›å»ºé—­åŒ…ï¼ŒåŒ…å«å¤§æ•°ç»„');
    
    return function() {
        count++;
        return {
            count,
            dataLength: largeData.length
        };
    };
}

console.log('1. åˆ›å»ºé—­åŒ…:');
const closure = createClosure();

console.log('\n2. è°ƒç”¨é—­åŒ…:');
console.log('  ç»“æœ:', closure());
console.log('  ç»“æœ:', closure());

console.log('\nè¯´æ˜:');
console.log('  largeData è¢«é—­åŒ…å¼•ç”¨');
console.log('  å³ä½¿ createClosure æ‰§è¡Œå®Œ');
console.log('  largeData ä»åœ¨å†…å­˜ä¸­');

console.log('\nè§£å†³:');
console.log('  closure = null åå¯è¢« GC');</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
        </div>
    </div>
    
    <script src="../assets/js/common.js"></script>
</body>
</html>
