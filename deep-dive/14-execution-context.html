<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰§è¡Œä¸Šä¸‹æ–‡è¯¦è§£ - JavaScript æ·±åº¦å­¦ä¹ </title>
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/page.css">
</head>
<body>
    <div class="page-layout">
        <div class="doc-panel">
            <h1>æ‰§è¡Œä¸Šä¸‹æ–‡è¯¦è§£</h1>
            
            <h2>æ¦‚è¿°</h2>
            <p>æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆExecution Contextï¼‰æ˜¯ JavaScript ä»£ç æ‰§è¡Œçš„ç¯å¢ƒæŠ½è±¡æ¦‚å¿µï¼ŒåŒ…å«äº†ä»£ç æ‰§è¡Œæ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚ç†è§£æ‰§è¡Œä¸Šä¸‹æ–‡æ˜¯æ·±å…¥ç†è§£ JavaScript è¿è¡Œæœºåˆ¶çš„å…³é”®ã€‚</p>
            
            <h2>ä¸€ã€æ‰§è¡Œä¸Šä¸‹æ–‡ç±»å‹</h2>
            
            <h3>1.1 ä¸‰ç§ç±»å‹</h3>
            <div class="info">
                <ul>
                    <li><strong>å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡</strong>ï¼šé»˜è®¤çš„æ‰§è¡Œç¯å¢ƒï¼Œä»£ç é¦–æ¬¡æ‰§è¡Œæ—¶åˆ›å»º</li>
                    <li><strong>å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡</strong>ï¼šæ¯ä¸ªå‡½æ•°è°ƒç”¨æ—¶åˆ›å»º</li>
                    <li><strong>Eval æ‰§è¡Œä¸Šä¸‹æ–‡</strong>ï¼ševal() å‡½æ•°æ‰§è¡Œæ—¶åˆ›å»ºï¼ˆä¸æ¨èä½¿ç”¨ï¼‰</li>
                </ul>
            </div>
            
            <h3>1.2 æ‰§è¡Œæ ˆ</h3>
            <pre><code>// æ‰§è¡Œæ ˆï¼ˆè°ƒç”¨æ ˆï¼‰ç¤ºä¾‹
function first() {
    console.log('First');
    second();
}

function second() {
    console.log('Second');
    third();
}

function third() {
    console.log('Third');
}

first();

// æ‰§è¡Œæ ˆå˜åŒ–ï¼š
// 1. [å…¨å±€ä¸Šä¸‹æ–‡]
// 2. [å…¨å±€ä¸Šä¸‹æ–‡, firstä¸Šä¸‹æ–‡]
// 3. [å…¨å±€ä¸Šä¸‹æ–‡, firstä¸Šä¸‹æ–‡, secondä¸Šä¸‹æ–‡]
// 4. [å…¨å±€ä¸Šä¸‹æ–‡, firstä¸Šä¸‹æ–‡, secondä¸Šä¸‹æ–‡, thirdä¸Šä¸‹æ–‡]
// 5. [å…¨å±€ä¸Šä¸‹æ–‡, firstä¸Šä¸‹æ–‡, secondä¸Šä¸‹æ–‡] // third æ‰§è¡Œå®Œå‡ºæ ˆ
// 6. [å…¨å±€ä¸Šä¸‹æ–‡, firstä¸Šä¸‹æ–‡]             // second æ‰§è¡Œå®Œå‡ºæ ˆ
// 7. [å…¨å±€ä¸Šä¸‹æ–‡]                         // first æ‰§è¡Œå®Œå‡ºæ ˆ</code></pre>
            
            <h2>äºŒã€æ‰§è¡Œä¸Šä¸‹æ–‡ç»„æˆ</h2>
            
            <h3>2.1 ES5 è§„èŒƒï¼ˆä¸‰ä¸ªç»„ä»¶ï¼‰</h3>
            <pre><code>ExecutionContext = {
    // 1. å˜é‡å¯¹è±¡ï¼ˆVariable Object, VOï¼‰
    VariableObject: {
        arguments,      // å‡½æ•°å‚æ•°
        variables,      // å‡½æ•°å†…å˜é‡å£°æ˜
        functionDeclarations  // å‡½æ•°å£°æ˜
    },
    
    // 2. ä½œç”¨åŸŸé“¾ï¼ˆScope Chainï¼‰
    ScopeChain: [VO, ...outerScopes],
    
    // 3. this æŒ‡å‘
    this: value
}</code></pre>
            
            <h3>2.2 ES6+ è§„èŒƒï¼ˆè¯æ³•ç¯å¢ƒï¼‰</h3>
            <pre><code>ExecutionContext = {
    // 1. è¯æ³•ç¯å¢ƒï¼ˆLexical Environmentï¼‰
    LexicalEnvironment: {
        EnvironmentRecord: {    // ç¯å¢ƒè®°å½•
            // let, const, function, class å£°æ˜
        },
        outer: <reference>      // å¤–éƒ¨ç¯å¢ƒå¼•ç”¨
    },
    
    // 2. å˜é‡ç¯å¢ƒï¼ˆVariable Environmentï¼‰
    VariableEnvironment: {
        EnvironmentRecord: {
            // var, function å£°æ˜
        },
        outer: <reference>
    },
    
    // 3. this ç»‘å®š
    ThisBinding: value
}</code></pre>
            
            <h2>ä¸‰ã€åˆ›å»ºé˜¶æ®µä¸æ‰§è¡Œé˜¶æ®µ</h2>
            
            <h3>3.1 åˆ›å»ºé˜¶æ®µ</h3>
            <pre><code>// åˆ›å»ºé˜¶æ®µå‘ç”Ÿçš„äº‹æƒ…ï¼š
1. åˆ›å»ºå˜é‡å¯¹è±¡/è¯æ³•ç¯å¢ƒ
   - åˆ›å»º arguments å¯¹è±¡ï¼ˆå‡½æ•°ä¸Šä¸‹æ–‡ï¼‰
   - æ‰«æå‡½æ•°å£°æ˜ï¼ˆæå‡ï¼‰
   - æ‰«æå˜é‡å£°æ˜ï¼ˆæå‡ï¼Œåˆå§‹åŒ–ä¸º undefinedï¼‰

2. å»ºç«‹ä½œç”¨åŸŸé“¾

3. ç¡®å®š this æŒ‡å‘

// ç¤ºä¾‹
function example(a, b) {
    console.log(x);  // undefinedï¼ˆå˜é‡æå‡ï¼‰
    var x = 10;
    
    console.log(fn);  // function fn() {...}ï¼ˆå‡½æ•°æå‡ï¼‰
    function fn() {}
}

example(1, 2);

// åˆ›å»ºé˜¶æ®µï¼š
ExecutionContext = {
    VariableObject: {
        arguments: { 0: 1, 1: 2, length: 2 },
        x: undefined,   // var å£°æ˜æå‡
        fn: <function>  // å‡½æ•°å£°æ˜æå‡
    },
    ScopeChain: [...],
    this: <value>
}</code></pre>
            
            <h3>3.2 æ‰§è¡Œé˜¶æ®µ</h3>
            <pre><code>// æ‰§è¡Œé˜¶æ®µï¼š
// 1. å˜é‡èµ‹å€¼
// 2. æ‰§è¡Œä»£ç 
// 3. å‡½æ•°è°ƒç”¨

// æ‰§è¡Œé˜¶æ®µåï¼š
ExecutionContext = {
    VariableObject: {
        arguments: { 0: 1, 1: 2, length: 2 },
        x: 10,          // èµ‹å€¼å®Œæˆ
        fn: <function>
    },
    ScopeChain: [...],
    this: <value>
}</code></pre>
            
            <h2>å››ã€å˜é‡å¯¹è±¡è¯¦è§£</h2>
            
            <h3>4.1 å…¨å±€ä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡</h3>
            <pre><code>// æµè§ˆå™¨ä¸­ï¼Œå…¨å±€å˜é‡å¯¹è±¡æ˜¯ window
var globalVar = 'global';
function globalFunc() {}

// ç›¸å½“äº
window.globalVar = 'global';
window.globalFunc = function() {};</code></pre>
            
            <h3>4.2 å‡½æ•°ä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡</h3>
            <pre><code>function example(param1, param2) {
    var localVar = 'local';
    function innerFunc() {}
}

// è¿›å…¥å‡½æ•°æ—¶ï¼Œå˜é‡å¯¹è±¡ï¼ˆæ´»åŠ¨å¯¹è±¡ AOï¼‰ï¼š
AO = {
    arguments: {
        0: param1çš„å€¼,
        1: param2çš„å€¼,
        length: 2
    },
    param1: å®å‚å€¼,
    param2: å®å‚å€¼,
    localVar: undefined,      // åˆ›å»ºé˜¶æ®µ
    innerFunc: <function>
}

// æ‰§è¡Œåï¼š
AO = {
    arguments: {...},
    param1: å®å‚å€¼,
    param2: å®å‚å€¼,
    localVar: 'local',        // æ‰§è¡Œé˜¶æ®µèµ‹å€¼
    innerFunc: <function>
}</code></pre>
            
            <h2>äº”ã€å˜é‡æå‡ä¸å‡½æ•°æå‡</h2>
            
            <h3>5.1 å˜é‡æå‡ï¼ˆHoistingï¼‰</h3>
            <pre><code>// var å£°æ˜ä¼šæå‡
console.log(a);  // undefined
var a = 10;
console.log(a);  // 10

// ç›¸å½“äºï¼š
var a;           // å£°æ˜æå‡
console.log(a);  // undefined
a = 10;          // èµ‹å€¼ä¸æå‡
console.log(a);  // 10

// let/const ä¸ä¼šæå‡ï¼ˆæš‚æ—¶æ€§æ­»åŒºï¼‰
console.log(b);  // ReferenceError
let b = 20;</code></pre>
            
            <h3>5.2 å‡½æ•°æå‡</h3>
            <pre><code>// å‡½æ•°å£°æ˜ä¼šæ•´ä½“æå‡
console.log(fn);  // function fn() {...}
fn();             // å¯ä»¥è°ƒç”¨

function fn() {
    console.log('Function');
}

// å‡½æ•°è¡¨è¾¾å¼ä¸ä¼šæå‡
console.log(fn2);  // undefined
fn2();             // TypeError: fn2 is not a function

var fn2 = function() {
    console.log('Expression');
};</code></pre>
            
            <h3>5.3 æå‡ä¼˜å…ˆçº§</h3>
            <pre><code>// å‡½æ•°å£°æ˜ > å˜é‡å£°æ˜
console.log(foo);  // function foo() {}

function foo() {}
var foo = 10;

// ç›¸å½“äºï¼š
function foo() {}  // å‡½æ•°å£°æ˜æå‡
var foo;           // å˜é‡å£°æ˜æå‡ï¼Œä½†å·²å­˜åœ¨ï¼Œå¿½ç•¥
console.log(foo);  // function
foo = 10;          // èµ‹å€¼</code></pre>
            
            <h2>å…­ã€è¯æ³•ç¯å¢ƒä¸å˜é‡ç¯å¢ƒ</h2>
            
            <h3>6.1 è¯æ³•ç¯å¢ƒï¼ˆLexical Environmentï¼‰</h3>
            <pre><code>// å­˜å‚¨ let, const, function, class å£°æ˜
{
    let x = 10;
    const y = 20;
    function fn() {}
    class MyClass {}
}

LexicalEnvironment = {
    EnvironmentRecord: {
        x: 10,
        y: 20,
        fn: <function>,
        MyClass: <class>
    },
    outer: <å¤–éƒ¨ç¯å¢ƒ>
}</code></pre>
            
            <h3>6.2 å˜é‡ç¯å¢ƒï¼ˆVariable Environmentï¼‰</h3>
            <pre><code>// å­˜å‚¨ var å’Œ function å£°æ˜
{
    var a = 1;
    function oldFunc() {}
}

VariableEnvironment = {
    EnvironmentRecord: {
        a: 1,
        oldFunc: <function>
    },
    outer: <å¤–éƒ¨ç¯å¢ƒ>
}</code></pre>
            
            <h3>6.3 ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ªç¯å¢ƒï¼Ÿ</h3>
            <pre><code>// æ”¯æŒ let/const çš„å—çº§ä½œç”¨åŸŸ
{
    let x = 10;    // è¯æ³•ç¯å¢ƒ
    var y = 20;    // å˜é‡ç¯å¢ƒï¼ˆå‡½æ•°ä½œç”¨åŸŸï¼‰
}
console.log(x);  // ReferenceError
console.log(y);  // 20ï¼ˆvar æ— å—çº§ä½œç”¨åŸŸï¼‰</code></pre>
            
            <h2>ä¸ƒã€this ç»‘å®š</h2>
            
            <h3>7.1 å…¨å±€ä¸Šä¸‹æ–‡çš„ this</h3>
            <pre><code>// æµè§ˆå™¨ä¸­
console.log(this);  // Window

// Node.js ä¸­
console.log(this);  // globalï¼ˆéä¸¥æ ¼æ¨¡å¼ï¼‰æˆ– undefinedï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰</code></pre>
            
            <h3>7.2 å‡½æ•°ä¸Šä¸‹æ–‡çš„ this</h3>
            <pre><code>// 1. æ™®é€šå‡½æ•°è°ƒç”¨
function fn() {
    console.log(this);
}
fn();  // éä¸¥æ ¼æ¨¡å¼: Windowï¼Œä¸¥æ ¼æ¨¡å¼: undefined

// 2. å¯¹è±¡æ–¹æ³•è°ƒç”¨
const obj = {
    method() {
        console.log(this);
    }
};
obj.method();  // obj

// 3. æ„é€ å‡½æ•°è°ƒç”¨
function Constructor() {
    this.value = 10;
}
const instance = new Constructor();  // this æŒ‡å‘æ–°å¯¹è±¡

// 4. ç®­å¤´å‡½æ•°
const arrow = () => {
    console.log(this);  // ç»§æ‰¿å¤–å±‚ this
};</code></pre>
            
            <h2>å…«ã€æ‰§è¡Œä¸Šä¸‹æ–‡å®ä¾‹åˆ†æ</h2>
            
            <h3>8.1 å®Œæ•´ç¤ºä¾‹</h3>
            <pre><code>var global = 'Global';

function outer(x) {
    var outerVar = 'Outer';
    
    function inner(y) {
        var innerVar = 'Inner';
        console.log(x, y, outerVar, innerVar, global);
    }
    
    inner(20);
}

outer(10);

// æ‰§è¡Œè¿‡ç¨‹ï¼š
// 1. åˆ›å»ºå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡
GlobalContext = {
    VariableObject: {
        global: undefined,
        outer: <function>
    },
    ScopeChain: [GlobalVO],
    this: Window
}

// 2. æ‰§è¡Œ outer(10)ï¼Œåˆ›å»º outer æ‰§è¡Œä¸Šä¸‹æ–‡
OuterContext = {
    VariableObject: {
        arguments: { 0: 10, length: 1 },
        x: 10,
        outerVar: undefined,
        inner: <function>
    },
    ScopeChain: [OuterVO, GlobalVO],
    this: Window
}

// 3. æ‰§è¡Œ inner(20)ï¼Œåˆ›å»º inner æ‰§è¡Œä¸Šä¸‹æ–‡
InnerContext = {
    VariableObject: {
        arguments: { 0: 20, length: 1 },
        y: 20,
        innerVar: undefined
    },
    ScopeChain: [InnerVO, OuterVO, GlobalVO],
    this: Window
}</code></pre>
            
            <h2>ä¹ã€æœ€ä½³å®è·µ</h2>
            
            <div class="tip">
                <ol>
                    <li><strong>ç†è§£æå‡</strong>ï¼švar/function æå‡ï¼Œlet/const æš‚æ—¶æ€§æ­»åŒº</li>
                    <li><strong>é¿å…æ±¡æŸ“å…¨å±€</strong>ï¼šä½¿ç”¨ IIFE æˆ–æ¨¡å—åŒ–</li>
                    <li><strong>ä¼˜å…ˆ let/const</strong>ï¼šé¿å…å˜é‡æå‡å¸¦æ¥çš„é—®é¢˜</li>
                    <li><strong>æ³¨æ„ this</strong>ï¼šç®­å¤´å‡½æ•° vs æ™®é€šå‡½æ•°</li>
                    <li><strong>é¿å…è¿‡æ·±åµŒå¥—</strong>ï¼šå½±å“ä½œç”¨åŸŸé“¾æŸ¥æ‰¾æ•ˆç‡</li>
                </ol>
            </div>
            
            <h2>å‚è€ƒèµ„æ–™</h2>
            <ul>
                <li><a href="https://tc39.es/ecma262/#sec-execution-contexts" target="_blank">ECMAScript - Execution Contexts</a></li>
                <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/this" target="_blank">MDN - this</a></li>
            </ul>
            
            <div class="nav-links">
                <a href="../advanced/13-webpack.html" class="nav-link prev">ä¸Šä¸€èŠ‚ï¼šWebpack</a>
                <a href="../index.html" class="nav-link home">è¿”å›é¦–é¡µ</a>
                <a href="14-scope-chain.html" class="nav-link next">ä¸‹ä¸€èŠ‚ï¼šä½œç”¨åŸŸé“¾</a>
            </div>
        </div>
        
        <div class="code-panel">
            <h2 style="color: #60a5fa; margin-bottom: 1.5rem;">ğŸ’» äº¤äº’å¼ä»£ç ç¤ºä¾‹</h2>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 1ï¼šæ‰§è¡Œæ ˆæ¼”ç¤º</h3>
                <div class="code-block">
                    <pre><code>// æ‰§è¡Œæ ˆï¼ˆè°ƒç”¨æ ˆï¼‰æ¼”ç¤º
console.log('=== æ‰§è¡Œæ ˆæ¼”ç¤º ===\n');

const stack = [];

function trackExecution(name, action) {
    if (action === 'enter') {
        stack.push(name);
        console.log(`â†’ è¿›å…¥ ${name}`);
        console.log(`  å½“å‰æ ˆ: [${stack.join(', ')}]`);
    } else {
        stack.pop();
        console.log(`â† é€€å‡º ${name}`);
        console.log(`  å½“å‰æ ˆ: [${stack.join(', ')}]`);
    }
}

function third() {
    trackExecution('third', 'enter');
    console.log('  æ‰§è¡Œ third å‡½æ•°ä½“');
    trackExecution('third', 'exit');
}

function second() {
    trackExecution('second', 'enter');
    console.log('  æ‰§è¡Œ second å‡½æ•°ä½“');
    third();
    trackExecution('second', 'exit');
}

function first() {
    trackExecution('first', 'enter');
    console.log('  æ‰§è¡Œ first å‡½æ•°ä½“');
    second();
    trackExecution('first', 'exit');
}

// åˆå§‹åŒ–å…¨å±€ä¸Šä¸‹æ–‡
stack.push('Global');
console.log('åˆå§‹: [Global]');
console.log('');

first();</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 2ï¼šå˜é‡æå‡</h3>
                <div class="code-block">
                    <pre><code>// å˜é‡æå‡æ¼”ç¤º
console.log('=== å˜é‡æå‡ ===\n');

console.log('1. var å˜é‡æå‡:');
console.log('  è®¿é—® a:', typeof a);  // undefined
var a = 10;
console.log('  èµ‹å€¼å a:', a);       // 10

console.log('\n2. å‡½æ•°å£°æ˜æå‡:');
console.log('  ç±»å‹:', typeof fn);   // function
console.log('  è°ƒç”¨:', fn());        // "Hello"

function fn() {
    return 'Hello';
}

console.log('\n3. å‡½æ•°è¡¨è¾¾å¼ä¸æå‡:');
console.log('  ç±»å‹:', typeof fn2);  // undefined
var fn2 = function() {
    return 'World';
};
console.log('  èµ‹å€¼å:', fn2());     // "World"

console.log('\n4. let/const æš‚æ—¶æ€§æ­»åŒº:');
try {
    console.log(b);  // ReferenceError
    let b = 20;
} catch(e) {
    console.log('  é”™è¯¯:', e.message);
}</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 3ï¼šæ‰§è¡Œä¸Šä¸‹æ–‡åˆ›å»º</h3>
                <div class="code-block">
                    <pre><code>// æ‰§è¡Œä¸Šä¸‹æ–‡åˆ›å»ºè¿‡ç¨‹
console.log('=== æ‰§è¡Œä¸Šä¸‹æ–‡åˆ›å»º ===\n');

function createContext(name, params) {
    console.log(`åˆ›å»º ${name} æ‰§è¡Œä¸Šä¸‹æ–‡:`);
    
    const context = {
        variableObject: {
            arguments: params || {},
            variables: {},
            functions: {}
        },
        scopeChain: [],
        thisBinding: 'Window'
    };
    
    console.log('  1. å˜é‡å¯¹è±¡:');
    console.log('     arguments:', context.variableObject.arguments);
    console.log('  2. ä½œç”¨åŸŸé“¾:', context.scopeChain);
    console.log('  3. this ç»‘å®š:', context.thisBinding);
    
    return context;
}

console.log('--- å…¨å±€ä¸Šä¸‹æ–‡ ---');
const globalCtx = createContext('Global', null);

console.log('\n--- å‡½æ•°ä¸Šä¸‹æ–‡ ---');
const functionCtx = createContext('Function', {
    0: 10,
    1: 20,
    length: 2
});</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 4ï¼šæå‡ä¼˜å…ˆçº§</h3>
                <div class="code-block">
                    <pre><code>// å‡½æ•°å£°æ˜ä¸å˜é‡å£°æ˜çš„ä¼˜å…ˆçº§
console.log('=== æå‡ä¼˜å…ˆçº§ ===\n');

console.log('æƒ…å†µ1: å‡½æ•°å£°æ˜ vs å˜é‡å£°æ˜');
console.log('typeof foo:', typeof foo);  // function

function foo() {
    return 'function';
}
var foo = 'variable';

console.log('èµ‹å€¼å foo:', foo);  // "variable"

console.log('\næƒ…å†µ2: å¤šä¸ªå‡½æ•°å£°æ˜');
console.log('bar():', bar());  // "Second"

function bar() {
    return 'First';
}
function bar() {
    return 'Second';  // åé¢çš„è¦†ç›–å‰é¢çš„
}

console.log('\næƒ…å†µ3: å‚æ•° vs å˜é‡å£°æ˜');
function test(x) {
    console.log('å‚æ•° x:', x);     // 10
    var x;
    console.log('å£°æ˜å x:', x);   // 10ï¼ˆå£°æ˜è¢«å¿½ç•¥ï¼‰
    x = 20;
    console.log('èµ‹å€¼å x:', x);   // 20
}
test(10);</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 5ï¼šè¯æ³•ç¯å¢ƒ vs å˜é‡ç¯å¢ƒ</h3>
                <div class="code-block">
                    <pre><code>// è¯æ³•ç¯å¢ƒä¸å˜é‡ç¯å¢ƒ
console.log('=== è¯æ³•ç¯å¢ƒ vs å˜é‡ç¯å¢ƒ ===\n');

console.log('1. å—çº§ä½œç”¨åŸŸï¼ˆlet/constï¼‰:');
{
    let blockLet = 'let';
    const blockConst = 'const';
    console.log('  å—å†…è®¿é—® let:', blockLet);
    console.log('  å—å†…è®¿é—® const:', blockConst);
}
try {
    console.log(blockLet);
} catch(e) {
    console.log('  å—å¤–è®¿é—® let: ReferenceError');
}

console.log('\n2. å‡½æ•°ä½œç”¨åŸŸï¼ˆvarï¼‰:');
{
    var blockVar = 'var';
    console.log('  å—å†…è®¿é—® var:', blockVar);
}
console.log('  å—å¤–è®¿é—® var:', blockVar);  // å¯ä»¥è®¿é—®

console.log('\n3. æ··åˆä½¿ç”¨:');
function mixed() {
    var x = 1;      // å˜é‡ç¯å¢ƒ
    let y = 2;      // è¯æ³•ç¯å¢ƒ
    const z = 3;    // è¯æ³•ç¯å¢ƒ
    
    if (true) {
        var x = 10;  // è¦†ç›–å¤–å±‚ x
        let y = 20;  // æ–°çš„å—çº§ y
        console.log('  å—å†… x:', x, 'y:', y);
    }
    
    console.log('  å—å¤– x:', x, 'y:', y);
}
mixed();</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 6ï¼šthis ç»‘å®š</h3>
                <div class="code-block">
                    <pre><code>// this ç»‘å®šç¤ºä¾‹
console.log('=== this ç»‘å®š ===\n');

console.log('1. æ™®é€šå‡½æ•°è°ƒç”¨:');
function normalFunc() {
    // éä¸¥æ ¼æ¨¡å¼ä¸‹æ˜¯ windowï¼Œè¿™é‡Œæ˜¯ undefinedï¼ˆæ¨¡å—ï¼‰
    return this === undefined ? 'undefined' : 'Window';
}
console.log('  this:', normalFunc());

console.log('\n2. å¯¹è±¡æ–¹æ³•è°ƒç”¨:');
const obj = {
    name: 'Object',
    method() {
        return this.name;
    }
};
console.log('  this.name:', obj.method());

console.log('\n3. æ„é€ å‡½æ•°è°ƒç”¨:');
function Person(name) {
    this.name = name;
    this.getName = function() {
        return this.name;
    };
}
const person = new Person('Alice');
console.log('  this.name:', person.getName());

console.log('\n4. ç®­å¤´å‡½æ•°:');
const outer = {
    name: 'Outer',
    arrow: () => {
        // ç®­å¤´å‡½æ•°ç»§æ‰¿å¤–å±‚ this
        return 'Arrow function inherits outer this';
    },
    normal: function() {
        const arrow = () => this.name;
        return arrow();
    }
};
console.log('  ç®­å¤´å‡½æ•°:', outer.arrow());
console.log('  å†…éƒ¨ç®­å¤´:', outer.normal());</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
        </div>
    </div>
    
    <script src="../assets/js/common.js"></script>
</body>
</html>
