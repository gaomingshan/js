<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOM æ ‘ä¸èŠ‚ç‚¹æ“ä½œ - JavaScript æ·±åº¦å­¦ä¹ </title>
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/page.css">
</head>
<body>
    <div class="page-layout">
        <div class="doc-panel">
            <h1>DOM æ ‘ä¸èŠ‚ç‚¹æ“ä½œ</h1>
            
            <h2>æ¦‚è¿°</h2>
            <p>DOMï¼ˆDocument Object Modelï¼Œæ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼‰æ˜¯ HTML å’Œ XML æ–‡æ¡£çš„ç¼–ç¨‹æ¥å£ã€‚å®ƒå°†æ–‡æ¡£è¡¨ç¤ºä¸ºèŠ‚ç‚¹æ ‘ï¼Œä½¿ JavaScript å¯ä»¥è®¿é—®å’Œæ“ä½œé¡µé¢å†…å®¹ã€‚</p>
            
            <h2>ä¸€ã€DOM æ ‘ç»“æ„</h2>
            
            <h3>1.1 èŠ‚ç‚¹ç±»å‹</h3>
            <table>
                <thead>
                    <tr>
                        <th>èŠ‚ç‚¹ç±»å‹</th>
                        <th>nodeType</th>
                        <th>è¯´æ˜</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Element</td>
                        <td>1</td>
                        <td>å…ƒç´ èŠ‚ç‚¹</td>
                    </tr>
                    <tr>
                        <td>Attr</td>
                        <td>2</td>
                        <td>å±æ€§èŠ‚ç‚¹</td>
                    </tr>
                    <tr>
                        <td>Text</td>
                        <td>3</td>
                        <td>æ–‡æœ¬èŠ‚ç‚¹</td>
                    </tr>
                    <tr>
                        <td>Comment</td>
                        <td>8</td>
                        <td>æ³¨é‡ŠèŠ‚ç‚¹</td>
                    </tr>
                    <tr>
                        <td>Document</td>
                        <td>9</td>
                        <td>æ–‡æ¡£èŠ‚ç‚¹</td>
                    </tr>
                    <tr>
                        <td>DocumentFragment</td>
                        <td>11</td>
                        <td>æ–‡æ¡£ç‰‡æ®µ</td>
                    </tr>
                </tbody>
            </table>
            
            <h2>äºŒã€é€‰æ‹©å…ƒç´ </h2>
            
            <h3>2.1 å•ä¸ªå…ƒç´ é€‰æ‹©</h3>
            <pre><code>// getElementById
const elem = document.getElementById('myId');

// querySelectorï¼ˆè¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…ï¼‰
const elem = document.querySelector('.myClass');
const elem = document.querySelector('#myId');
const elem = document.querySelector('div > p');</code></pre>
            
            <h3>2.2 å¤šä¸ªå…ƒç´ é€‰æ‹©</h3>
            <pre><code>// getElementsByClassNameï¼ˆHTMLCollectionï¼Œå®æ—¶ï¼‰
const elems = document.getElementsByClassName('myClass');

// getElementsByTagNameï¼ˆHTMLCollectionï¼Œå®æ—¶ï¼‰
const divs = document.getElementsByTagName('div');

// querySelectorAllï¼ˆNodeListï¼Œé™æ€ï¼‰
const elems = document.querySelectorAll('.myClass');
const elems = document.querySelectorAll('div, p');</code></pre>
            
            <h3>2.3 HTMLCollection vs NodeList</h3>
            <table>
                <thead>
                    <tr>
                        <th>ç‰¹æ€§</th>
                        <th>HTMLCollection</th>
                        <th>NodeList</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>å®æ—¶æ€§</td>
                        <td>å®æ—¶æ›´æ–°</td>
                        <td>é™æ€ï¼ˆquerySelectorAllï¼‰</td>
                    </tr>
                    <tr>
                        <td>å¯éå†</td>
                        <td>for...of</td>
                        <td>for...of / forEach</td>
                    </tr>
                    <tr>
                        <td>åŒ…å«èŠ‚ç‚¹</td>
                        <td>åªæœ‰å…ƒç´ </td>
                        <td>æ‰€æœ‰èŠ‚ç‚¹</td>
                    </tr>
                </tbody>
            </table>
            
            <h2>ä¸‰ã€èŠ‚ç‚¹å±æ€§</h2>
            
            <h3>3.1 åŸºæœ¬å±æ€§</h3>
            <pre><code>const elem = document.getElementById('myDiv');

elem.nodeType;      // 1ï¼ˆå…ƒç´ èŠ‚ç‚¹ï¼‰
elem.nodeName;      // "DIV"
elem.nodeValue;     // nullï¼ˆå…ƒç´ èŠ‚ç‚¹æ— å€¼ï¼‰
elem.tagName;       // "DIV"</code></pre>
            
            <h3>3.2 å†…å®¹å±æ€§</h3>
            <pre><code>// textContent - æ–‡æœ¬å†…å®¹ï¼ˆä¸è§£æ HTMLï¼‰
elem.textContent = 'Hello';

// innerHTML - HTML å†…å®¹ï¼ˆè§£æ HTMLï¼‰
elem.innerHTML = '<span>Hello</span>';

// innerText - å¯è§æ–‡æœ¬ï¼ˆè€ƒè™‘ CSSï¼‰
elem.innerText = 'Hello';</code></pre>
            
            <h3>3.3 å±æ€§æ“ä½œ</h3>
            <pre><code>// getAttribute / setAttribute
elem.getAttribute('data-id');
elem.setAttribute('data-id', '123');
elem.removeAttribute('data-id');
elem.hasAttribute('data-id');

// datasetï¼ˆdata-* å±æ€§ï¼‰
elem.dataset.id;           // è¯»å– data-id
elem.dataset.id = '123';   // è®¾ç½® data-id

// ç›´æ¥å±æ€§è®¿é—®
elem.id = 'myId';
elem.className = 'myClass';
elem.classList.add('active');</code></pre>
            
            <h2>å››ã€èŠ‚ç‚¹å…³ç³»</h2>
            
            <h3>4.1 çˆ¶å­å…³ç³»</h3>
            <pre><code>const elem = document.getElementById('myDiv');

// çˆ¶èŠ‚ç‚¹
elem.parentNode;
elem.parentElement;

// å­èŠ‚ç‚¹
elem.childNodes;        // NodeListï¼ˆåŒ…å«æ–‡æœ¬èŠ‚ç‚¹ï¼‰
elem.children;          // HTMLCollectionï¼ˆåªæœ‰å…ƒç´ ï¼‰
elem.firstChild;        // ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹
elem.lastChild;         // æœ€åä¸€ä¸ªå­èŠ‚ç‚¹
elem.firstElementChild; // ç¬¬ä¸€ä¸ªå…ƒç´ å­èŠ‚ç‚¹
elem.lastElementChild;  // æœ€åä¸€ä¸ªå…ƒç´ å­èŠ‚ç‚¹</code></pre>
            
            <h3>4.2 å…„å¼Ÿå…³ç³»</h3>
            <pre><code>// å…„å¼ŸèŠ‚ç‚¹
elem.nextSibling;           // ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
elem.previousSibling;       // ä¸Šä¸€ä¸ªèŠ‚ç‚¹
elem.nextElementSibling;    // ä¸‹ä¸€ä¸ªå…ƒç´ 
elem.previousElementSibling; // ä¸Šä¸€ä¸ªå…ƒç´ </code></pre>
            
            <h2>äº”ã€åˆ›å»ºå’Œæ’å…¥èŠ‚ç‚¹</h2>
            
            <h3>5.1 åˆ›å»ºèŠ‚ç‚¹</h3>
            <pre><code>// åˆ›å»ºå…ƒç´ 
const div = document.createElement('div');

// åˆ›å»ºæ–‡æœ¬èŠ‚ç‚¹
const text = document.createTextNode('Hello');

// åˆ›å»ºæ–‡æ¡£ç‰‡æ®µ
const fragment = document.createDocumentFragment();</code></pre>
            
            <h3>5.2 æ’å…¥èŠ‚ç‚¹</h3>
            <pre><code>// appendChild - æœ«å°¾æ·»åŠ 
parent.appendChild(child);

// insertBefore - æŒ‡å®šä½ç½®æ’å…¥
parent.insertBefore(newNode, referenceNode);

// appendï¼ˆç°ä»£æ–¹æ³•ï¼Œå¯æ’å…¥å¤šä¸ªï¼‰
parent.append(child1, child2, 'text');

// prepend - å¼€å¤´æ’å…¥
parent.prepend(child);

// before / after - åŒçº§æ’å…¥
elem.before(newElem);
elem.after(newElem);</code></pre>
            
            <h3>5.3 innerHTML vs createElement</h3>
            <div class="info">
                <strong>innerHTMLï¼š</strong>
                <ul>
                    <li>ç®€å•å¿«é€Ÿ</li>
                    <li>ä¼šé”€æ¯åŸæœ‰äº‹ä»¶ç›‘å¬å™¨</li>
                    <li>å­˜åœ¨ XSS é£é™©</li>
                </ul>
                
                <strong>createElementï¼š</strong>
                <ul>
                    <li>æ›´å®‰å…¨</li>
                    <li>ä¿ç•™äº‹ä»¶ç›‘å¬å™¨</li>
                    <li>æ€§èƒ½æ›´å¥½ï¼ˆå¤§é‡æ“ä½œæ—¶ï¼‰</li>
                </ul>
            </div>
            
            <h2>å…­ã€åˆ é™¤å’Œæ›¿æ¢èŠ‚ç‚¹</h2>
            
            <h3>6.1 åˆ é™¤èŠ‚ç‚¹</h3>
            <pre><code>// removeChild
parent.removeChild(child);

// removeï¼ˆç°ä»£æ–¹æ³•ï¼‰
elem.remove();

// æ¸…ç©ºå†…å®¹
elem.innerHTML = '';
elem.textContent = '';</code></pre>
            
            <h3>6.2 æ›¿æ¢èŠ‚ç‚¹</h3>
            <pre><code>// replaceChild
parent.replaceChild(newChild, oldChild);

// replaceWithï¼ˆç°ä»£æ–¹æ³•ï¼‰
oldElem.replaceWith(newElem);</code></pre>
            
            <h3>6.3 å…‹éš†èŠ‚ç‚¹</h3>
            <pre><code>// cloneNode
const clone = elem.cloneNode();      // æµ…å…‹éš†
const clone = elem.cloneNode(true);  // æ·±å…‹éš†ï¼ˆåŒ…æ‹¬å­èŠ‚ç‚¹ï¼‰</code></pre>
            
            <h2>ä¸ƒã€æ ·å¼æ“ä½œ</h2>
            
            <h3>7.1 className</h3>
            <pre><code>elem.className = 'class1 class2';
elem.className += ' class3';</code></pre>
            
            <h3>7.2 classList</h3>
            <pre><code>elem.classList.add('active');
elem.classList.remove('active');
elem.classList.toggle('active');
elem.classList.contains('active');
elem.classList.replace('old', 'new');</code></pre>
            
            <h3>7.3 style</h3>
            <pre><code>// å†…è”æ ·å¼
elem.style.color = 'red';
elem.style.backgroundColor = 'blue';
elem.style.fontSize = '16px';

// æ‰¹é‡è®¾ç½®
elem.style.cssText = 'color: red; font-size: 16px;';

// è·å–è®¡ç®—æ ·å¼
const style = getComputedStyle(elem);
style.color;</code></pre>
            
            <h2>å…«ã€DocumentFragment</h2>
            
            <h3>8.1 æ€§èƒ½ä¼˜åŒ–</h3>
            <p>ä½¿ç”¨ DocumentFragment å¯ä»¥å‡å°‘é¡µé¢é‡æ’ï¼š</p>
            
            <pre><code>const fragment = document.createDocumentFragment();

for (let i = 0; i < 1000; i++) {
    const li = document.createElement('li');
    li.textContent = `Item ${i}`;
    fragment.appendChild(li);
}

// ä¸€æ¬¡æ€§æ’å…¥
ul.appendChild(fragment);</code></pre>
            
            <h2>ä¹ã€æœ€ä½³å®è·µ</h2>
            
            <div class="tip">
                <ol>
                    <li><strong>ç¼“å­˜ DOM æŸ¥è¯¢</strong>ï¼šé¿å…é‡å¤æŸ¥è¯¢</li>
                    <li><strong>æ‰¹é‡æ“ä½œ</strong>ï¼šä½¿ç”¨ DocumentFragment</li>
                    <li><strong>ä½¿ç”¨ classList</strong>ï¼šä»£æ›¿ className</li>
                    <li><strong>äº‹ä»¶å§”æ‰˜</strong>ï¼šå‡å°‘äº‹ä»¶ç›‘å¬å™¨æ•°é‡</li>
                    <li><strong>é¿å…å¸ƒå±€æŠ–åŠ¨</strong>ï¼šè¯»å†™åˆ†ç¦»</li>
                    <li><strong>ä½¿ç”¨ç°ä»£ API</strong>ï¼šappend/remove ç­‰</li>
                </ol>
            </div>
            
            <h2>å‚è€ƒèµ„æ–™</h2>
            <ul>
                <li><a href="https://dom.spec.whatwg.org/" target="_blank">DOM Standard</a></li>
                <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document_Object_Model" target="_blank">MDN - DOM</a></li>
            </ul>
            
            <div class="nav-links">
                <a href="09-event-loop.html" class="nav-link prev">ä¸Šä¸€èŠ‚ï¼šäº‹ä»¶å¾ªç¯</a>
                <a href="../index.html" class="nav-link home">è¿”å›é¦–é¡µ</a>
                <a href="10-events.html" class="nav-link next">ä¸‹ä¸€èŠ‚ï¼šäº‹ä»¶ç³»ç»Ÿ</a>
            </div>
        </div>
        
        <div class="code-panel">
            <h2 style="color: #60a5fa; margin-bottom: 1.5rem;">ğŸ’» äº¤äº’å¼ä»£ç ç¤ºä¾‹</h2>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 1ï¼šé€‰æ‹©å…ƒç´ </h3>
                <div class="code-block">
                    <pre><code>// æ³¨æ„ï¼šè¿™äº›ç¤ºä¾‹æ¼”ç¤º API ç”¨æ³•
// åœ¨æ§åˆ¶å°ä¸­è¿è¡Œå¯ä»¥æŸ¥çœ‹å®é™…æ•ˆæœ

// getElementById
console.log('getElementById:');
console.log('  è¿”å›å•ä¸ªå…ƒç´ ');

// querySelector
console.log('\nquerySelector:');
console.log('  æ”¯æŒ CSS é€‰æ‹©å™¨');
console.log('  è¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…å…ƒç´ ');

// querySelectorAll
console.log('\nquerySelectorAll:');
console.log('  è¿”å› NodeListï¼ˆé™æ€ï¼‰');
console.log('  å¯ä»¥ä½¿ç”¨ forEach');

// getElementsByClassName
console.log('\ngetElementsByClassName:');
console.log('  è¿”å› HTMLCollectionï¼ˆå®æ—¶ï¼‰');
console.log('  DOM å˜åŒ–æ—¶è‡ªåŠ¨æ›´æ–°');

// ç¤ºä¾‹ä»£ç 
const code = `
// å•ä¸ªå…ƒç´ 
const elem = document.querySelector('#myId');

// å¤šä¸ªå…ƒç´ 
const elems = document.querySelectorAll('.myClass');
elems.forEach(elem => {
    console.log(elem);
});
`;

console.log('\nç¤ºä¾‹ä»£ç :');
console.log(code);</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 2ï¼šåˆ›å»ºå’Œæ’å…¥å…ƒç´ </h3>
                <div class="code-block">
                    <pre><code>// åˆ›å»ºå…ƒç´ 
const div = document.createElement('div');
div.textContent = 'æ–°åˆ›å»ºçš„ div';
div.className = 'demo-box';

console.log('åˆ›å»ºå…ƒç´ :');
console.log('  æ ‡ç­¾:', div.tagName);
console.log('  å†…å®¹:', div.textContent);
console.log('  ç±»å:', div.className);

// åˆ›å»ºå¤šä¸ªå…ƒç´ 
const ul = document.createElement('ul');
for (let i = 1; i <= 3; i++) {
    const li = document.createElement('li');
    li.textContent = `åˆ—è¡¨é¡¹ ${i}`;
    ul.appendChild(li);
}

console.log('\nåˆ›å»ºåˆ—è¡¨:');
console.log('  å­å…ƒç´ æ•°é‡:', ul.children.length);
console.log('  innerHTML:', ul.innerHTML);

// ä½¿ç”¨ DocumentFragment
const fragment = document.createDocumentFragment();
for (let i = 1; i <= 5; i++) {
    const p = document.createElement('p');
    p.textContent = `æ®µè½ ${i}`;
    fragment.appendChild(p);
}

console.log('\nDocumentFragment:');
console.log('  å­èŠ‚ç‚¹æ•°é‡:', fragment.childNodes.length);</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 3ï¼šèŠ‚ç‚¹å±æ€§æ“ä½œ</h3>
                <div class="code-block">
                    <pre><code>// åˆ›å»ºå…ƒç´ å¹¶è®¾ç½®å±æ€§
const link = document.createElement('a');

// è®¾ç½®å±æ€§
link.setAttribute('href', 'https://example.com');
link.setAttribute('target', '_blank');
link.setAttribute('data-id', '123');
link.textContent = 'é“¾æ¥æ–‡æœ¬';

console.log('å±æ€§æ“ä½œ:');
console.log('  href:', link.getAttribute('href'));
console.log('  target:', link.getAttribute('target'));
console.log('  data-id:', link.dataset.id);

// ä¿®æ”¹å±æ€§
link.href = 'https://google.com';
link.dataset.id = '456';

console.log('\nä¿®æ”¹å:');
console.log('  href:', link.href);
console.log('  data-id:', link.dataset.id);

// classList æ“ä½œ
const div = document.createElement('div');
div.classList.add('box', 'active');

console.log('\nclassList:');
console.log('  ç±»å:', div.className);
console.log('  contains("active"):', div.classList.contains('active'));

div.classList.toggle('active');
console.log('  toggleå:', div.className);</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 4ï¼šèŠ‚ç‚¹å…³ç³»</h3>
                <div class="code-block">
                    <pre><code>// åˆ›å»ºæ ‘å½¢ç»“æ„
const parent = document.createElement('div');
parent.id = 'parent';

const child1 = document.createElement('div');
child1.className = 'child';
child1.textContent = 'ç¬¬ä¸€ä¸ªå­å…ƒç´ ';

const child2 = document.createElement('div');
child2.className = 'child';
child2.textContent = 'ç¬¬äºŒä¸ªå­å…ƒç´ ';

const child3 = document.createElement('div');
child3.className = 'child';
child3.textContent = 'ç¬¬ä¸‰ä¸ªå­å…ƒç´ ';

parent.appendChild(child1);
parent.appendChild(child2);
parent.appendChild(child3);

console.log('èŠ‚ç‚¹å…³ç³»:');
console.log('  çˆ¶å…ƒç´  ID:', parent.id);
console.log('  å­å…ƒç´ æ•°é‡:', parent.children.length);
console.log('  ç¬¬ä¸€ä¸ªå­å…ƒç´ :', parent.firstElementChild.textContent);
console.log('  æœ€åä¸€ä¸ªå­å…ƒç´ :', parent.lastElementChild.textContent);

console.log('\nå…„å¼Ÿå…³ç³»:');
console.log('  child2 çš„ä¸Šä¸€ä¸ª:', child2.previousElementSibling.textContent);
console.log('  child2 çš„ä¸‹ä¸€ä¸ª:', child2.nextElementSibling.textContent);</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 5ï¼šæ ·å¼æ“ä½œ</h3>
                <div class="code-block">
                    <pre><code>// åˆ›å»ºå…ƒç´ 
const box = document.createElement('div');
box.textContent = 'Styled Box';

// å†…è”æ ·å¼
box.style.color = 'white';
box.style.backgroundColor = 'blue';
box.style.padding = '20px';
box.style.borderRadius = '8px';

console.log('å†…è”æ ·å¼:');
console.log('  color:', box.style.color);
console.log('  backgroundColor:', box.style.backgroundColor);
console.log('  cssText:', box.style.cssText);

// classList æ“ä½œ
box.classList.add('box', 'shadow');
console.log('\nç±»åæ“ä½œ:');
console.log('  className:', box.className);
console.log('  classList:', Array.from(box.classList));

// æ‰¹é‡è®¾ç½®æ ·å¼
const styles = {
    fontSize: '16px',
    fontWeight: 'bold',
    textAlign: 'center'
};

Object.assign(box.style, styles);
console.log('\næ‰¹é‡è®¾ç½®å:');
console.log('  fontSize:', box.style.fontSize);
console.log('  fontWeight:', box.style.fontWeight);</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 6ï¼šæ€§èƒ½ä¼˜åŒ– - DocumentFragment</h3>
                <div class="code-block">
                    <pre><code>// ä¸å¥½çš„æ–¹å¼ï¼šå¤šæ¬¡ DOM æ“ä½œ
console.log('=== æ–¹å¼1ï¼šç›´æ¥æ·»åŠ ï¼ˆæ…¢ï¼‰ ===');
console.time('ç›´æ¥æ·»åŠ ');
const ul1 = document.createElement('ul');
for (let i = 0; i < 100; i++) {
    const li = document.createElement('li');
    li.textContent = `Item ${i}`;
    ul1.appendChild(li);  // æ¯æ¬¡éƒ½è§¦å‘é‡æ’
}
console.timeEnd('ç›´æ¥æ·»åŠ ');
console.log('å­å…ƒç´ æ•°é‡:', ul1.children.length);

// å¥½çš„æ–¹å¼ï¼šä½¿ç”¨ DocumentFragment
console.log('\n=== æ–¹å¼2ï¼šDocumentFragmentï¼ˆå¿«ï¼‰ ===');
console.time('DocumentFragment');
const ul2 = document.createElement('ul');
const fragment = document.createDocumentFragment();
for (let i = 0; i < 100; i++) {
    const li = document.createElement('li');
    li.textContent = `Item ${i}`;
    fragment.appendChild(li);  // åœ¨å†…å­˜ä¸­æ“ä½œ
}
ul2.appendChild(fragment);  // ä¸€æ¬¡æ€§æ·»åŠ 
console.timeEnd('DocumentFragment');
console.log('å­å…ƒç´ æ•°é‡:', ul2.children.length);

console.log('\nä½¿ç”¨ DocumentFragment å¯ä»¥æ˜¾è‘—æå‡æ€§èƒ½ï¼');</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
        </div>
    </div>
    
    <script src="../assets/js/common.js"></script>
</body>
</html>
