<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">åŠ è½½ä¸­...</title>
    <meta name="description" content="å­¦ä¹ ç³»ç»Ÿé€šç”¨æ¸²æŸ“é¡µé¢">
    
    <!-- å¼•å…¥é€šç”¨æ ·å¼ -->
    <link rel="stylesheet" href="../styles/base.css">
    <link rel="stylesheet" href="../styles/content-types.css">
</head>
<body>
    <!-- åŠ è½½æç¤º -->
    <div id="loading" style="text-align: center; padding: 100px; color: #666;">
        <div style="font-size: 48px; margin-bottom: 20px;">â³</div>
        <div style="font-size: 18px;">æ­£åœ¨åŠ è½½å†…å®¹...</div>
    </div>
    
    <!-- é”™è¯¯æç¤º -->
    <div id="error" style="display: none; text-align: center; padding: 100px; color: #e74c3c;">
        <div style="font-size: 48px; margin-bottom: 20px;">âŒ</div>
        <div style="font-size: 18px; margin-bottom: 10px;">åŠ è½½å¤±è´¥</div>
        <div id="error-message" style="font-size: 14px; color: #666;"></div>
    </div>
    
    <!-- å†…å®¹å®¹å™¨ï¼ˆæ¸²æŸ“å™¨ä¼šå¡«å……è¿™é‡Œï¼‰ -->
    <div class="container">
        <header class="content-header">
            <a href="./index.html" class="back-link" id="back-link">â† è¿”å›ç›®å½•</a>
            <h1 id="section-title">Loading...</h1>
        </header>

        <main id="content-container" class="content-main">
            <!-- å†…å®¹å°†ç”± UniversalRendererV2 åŠ¨æ€ç”Ÿæˆ -->
        </main>

        <footer id="nav-links" class="content-footer">
            <!-- å¯¼èˆªé“¾æ¥å°†ç”± UniversalRendererV2 åŠ¨æ€ç”Ÿæˆ -->
        </footer>
    </div>

    <!-- åŠ è½½é€»è¾‘ï¼šåŠ¨æ€åŠ è½½æ•°æ®å’Œæ¸²æŸ“å™¨ -->
    <script>
        (function() {
            // è§£æURLå‚æ•°
            const params = new URLSearchParams(window.location.search);
            const subject = params.get('subject') || 'html';
            const type = params.get('type') || 'content';
            const chapter = params.get('chapter') || '01';
            
            // æ›´æ–°è¿”å›é“¾æ¥
            document.getElementById('back-link').href = `./index.html?subject=${subject}`;
            
            // æ„å»ºæ•°æ®æ–‡ä»¶è·¯å¾„
            const dataPath = `../../${subject}/data/${type}-${chapter}.js`;
            
            console.log('ğŸ“– åŠ è½½å‚æ•°:', { subject, type, chapter });
            console.log('ğŸ“‚ æ•°æ®è·¯å¾„:', dataPath);
            
            // é”™è¯¯å¤„ç†å‡½æ•°
            function showError(message) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error-message').textContent = message;
            }
            
            // æ­¥éª¤1ï¼šåŠ è½½æ•°æ®æ–‡ä»¶
            const dataScript = document.createElement('script');
            dataScript.src = dataPath;
            
            dataScript.onerror = function() {
                showError(`æœªæ‰¾åˆ°æ•°æ®æ–‡ä»¶ï¼š${dataPath}`);
            };
            
            dataScript.onload = function() {
                console.log('âœ… æ•°æ®è„šæœ¬åŠ è½½æˆåŠŸ');
                
                // æ•°æ®æ–‡ä»¶åº”è¯¥å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡ï¼ˆå¦‚ï¼šwindow.pkgManagerContent_01ï¼‰
                // å˜é‡å‘½åè§„èŒƒï¼šwindow.${subject}Content_${chapter}
                const dataVarName = subject.replace(/-/g, '') + 'Content_' + chapter;
                const contentData = window[dataVarName];
                
                if (!contentData) {
                    showError(`æ•°æ®æ–‡ä»¶ä¸­æœªæ‰¾åˆ°å˜é‡ï¼šwindow.${dataVarName}`);
                    return;
                }
                
                // æ­¥éª¤2ï¼šåŠ è½½æ¸²æŸ“å™¨
                const rendererScript = document.createElement('script');
                rendererScript.src = '../core/universal-renderer-v2.js';
                
                rendererScript.onerror = function() {
                    showError('æ— æ³•åŠ è½½æ¸²æŸ“å™¨');
                };
                
                rendererScript.onload = function() {
                    console.log('âœ… æ¸²æŸ“å™¨åŠ è½½æˆåŠŸ');
                    
                    // æ­¥éª¤3ï¼šåˆå§‹åŒ–æ¸²æŸ“å™¨
                    if (typeof UniversalRendererV2 !== 'undefined') {
                        try {
                            // éšè—åŠ è½½æç¤º
                            document.getElementById('loading').style.display = 'none';
                            
                            // æ›´æ–°é¡µé¢æ ‡é¢˜
                            document.getElementById('page-title').textContent = contentData.section?.title || 'å­¦ä¹ ç³»ç»Ÿ';
                            
                            // åˆ›å»ºæ¸²æŸ“å™¨å®ä¾‹
                            const renderer = new UniversalRendererV2({
                                subject: subject,
                                theme: contentData.theme || {}
                            });
                            
                            // åˆå§‹åŒ–å¹¶æ¸²æŸ“
                            renderer.init(contentData);
                            
                            console.log('âœ… æ¸²æŸ“å®Œæˆ:', contentData.section?.title);
                            
                        } catch (error) {
                            showError('æ¸²æŸ“å¤±è´¥: ' + error.message);
                            console.error('âŒ æ¸²æŸ“é”™è¯¯:', error);
                        }
                    } else {
                        showError('æ¸²æŸ“å™¨æœªå®šä¹‰');
                    }
                };
                
                document.head.appendChild(rendererScript);
            };
            
            document.head.appendChild(dataScript);
        })();
    </script>
</body>
</html>
