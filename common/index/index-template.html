<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">å­¦ä¹ ç³»ç»Ÿ</title>
    <meta name="description" content="ç³»ç»ŸåŒ–å­¦ä¹ æ ¸å¿ƒçŸ¥è¯†" id="page-desc">
    
    <!-- é€šç”¨ç›®å½•æ ·å¼ -->
    <link rel="stylesheet" href="./index.css">
</head>
<body>
    <!-- åŠ è½½æç¤º -->
    <div id="loading" style="text-align: center; padding: 100px 20px; color: white;">
        <h1 style="margin-bottom: 20px;">â³ æ­£åœ¨åŠ è½½...</h1>
        <p style="opacity: 0.8;">è¯·ç¨å€™</p>
    </div>
    
    <!-- é”™è¯¯æç¤ºï¼ˆé»˜è®¤éšè—ï¼‰ -->
    <div id="error" style="display: none; text-align: center; padding: 100px 20px; color: white;">
        <h1 style="margin-bottom: 20px; color: #f56565;">âŒ åŠ è½½å¤±è´¥</h1>
        <p id="error-message" style="opacity: 0.8; margin-bottom: 30px;"></p>
        <a href="./" style="display: inline-block; padding: 12px 30px; background: white; color: #667eea; text-decoration: none; border-radius: 8px; font-weight: 600;">
            è¿”å›é¦–é¡µ
        </a>
    </div>
    
    <!-- æ ¸å¿ƒæ¸²æŸ“å™¨ -->
    <script src="./index-renderer.js"></script>
    
    <!-- åŠ¨æ€åŠ è½½æ•°æ®å¹¶æ¸²æŸ“ -->
    <script>
        (function() {
            // è·å–URLå‚æ•°
            const urlParams = new URLSearchParams(window.location.search);
            const subject = urlParams.get('subject') || 'html';
            
            // æ³¨å†Œæ•°æ®çš„å…¨å±€å‡½æ•°ï¼ˆä¾›æ•°æ®æ–‡ä»¶è°ƒç”¨ï¼‰
            window.registerIndexData = function(data) {
                try {
                    // éšè—åŠ è½½æç¤º
                    document.getElementById('loading').style.display = 'none';
                    
                    // æ›´æ–°é¡µé¢å…ƒä¿¡æ¯
                    document.getElementById('page-title').textContent = data.title;
                    document.getElementById('page-desc').content = data.subtitle;
                    
                    // åˆ›å»ºæ¸²æŸ“å™¨å¹¶æ¸²æŸ“
                    const renderer = new IndexRenderer(data);
                    renderer.render();
                    
                    // è¾“å‡ºç»Ÿè®¡ä¿¡æ¯
                    const stats = renderer.getStatistics();
                    console.log(`ğŸ“Š ${data.title}ç»Ÿè®¡:`);
                    console.log(`- å­¦ç§‘: ${stats.subject}`);
                    console.log(`- æ ‡ç­¾é¡µ: ${stats.tabs}ä¸ª`);
                    console.log(`- ç« èŠ‚ç»„: ${stats.sections}ä¸ª`);
                    console.log(`- æ€»ç« èŠ‚: ${stats.chapters}ç« `);
                    
                    // æ¸…ç†å…¨å±€å‡½æ•°
                    delete window.registerIndexData;
                    
                } catch (error) {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('error').style.display = 'block';
                    document.getElementById('error-message').textContent = error.message;
                    console.error('æ¸²æŸ“å¤±è´¥:', error);
                }
            };
            
            // åŠ¨æ€åŠ è½½æ•°æ®æ–‡ä»¶
            const script = document.createElement('script');
            script.src = `./data/${subject}.js`;
            
            script.onerror = function() {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error-message').textContent = 
                    `æœªæ‰¾åˆ° ${subject} å­¦ç§‘çš„æ•°æ®æ–‡ä»¶ï¼šdata/${subject}.js`;
                delete window.registerIndexData;
            };
            
            document.head.appendChild(script);
        })();
    </script>
</body>
</html>
