<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¼‚å¸¸å¤„ç†æœºåˆ¶ - JavaScript æ·±åº¦å­¦ä¹ </title>
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/page.css">
</head>
<body>
    <div class="page-layout">
        <div class="doc-panel">
            <h1>å¼‚å¸¸å¤„ç†æœºåˆ¶</h1>
            
            <h2>æ¦‚è¿°</h2>
            <p>å¼‚å¸¸å¤„ç†æ˜¯ç¼–å†™å¥å£®ä»£ç çš„å…³é”®ã€‚JavaScript æä¾›äº† try...catch...finally æœºåˆ¶æ¥æ•è·å’Œå¤„ç†è¿è¡Œæ—¶é”™è¯¯ã€‚</p>
            
            <h2>ä¸€ã€try...catch è¯­å¥</h2>
            
            <h3>1.1 åŸºæœ¬è¯­æ³•</h3>
            <pre><code>try {
    // å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ä»£ç 
} catch (error) {
    // å¤„ç†å¼‚å¸¸
}</code></pre>
            
            <h3>1.2 å·¥ä½œåŸç†</h3>
            <ol>
                <li>æ‰§è¡Œ <code>try</code> å—ä¸­çš„ä»£ç </li>
                <li>å¦‚æœæ²¡æœ‰å¼‚å¸¸ï¼Œè·³è¿‡ <code>catch</code> å—</li>
                <li>å¦‚æœæœ‰å¼‚å¸¸ï¼Œåœæ­¢ <code>try</code> å—æ‰§è¡Œï¼Œè·³åˆ° <code>catch</code> å—</li>
                <li><code>catch</code> å—æ¥æ”¶é”™è¯¯å¯¹è±¡ä½œä¸ºå‚æ•°</li>
            </ol>
            
            <h3>1.3 æ•è·çš„é”™è¯¯ç±»å‹</h3>
            <ul>
                <li>è¯­æ³•é”™è¯¯ï¼ˆSyntaxErrorï¼‰- é€šå¸¸æ— æ³•æ•è·</li>
                <li>è¿è¡Œæ—¶é”™è¯¯ï¼ˆReferenceError, TypeError ç­‰ï¼‰</li>
                <li>è‡ªå®šä¹‰é”™è¯¯ï¼ˆthrow è¯­å¥ï¼‰</li>
            </ul>
            
            <h2>äºŒã€finally å­å¥</h2>
            
            <h3>2.1 åŸºæœ¬è¯­æ³•</h3>
            <pre><code>try {
    // å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ä»£ç 
} catch (error) {
    // å¤„ç†å¼‚å¸¸
} finally {
    // æ— è®ºæ˜¯å¦å¼‚å¸¸éƒ½ä¼šæ‰§è¡Œ
}</code></pre>
            
            <h3>2.2 æ‰§è¡Œç‰¹æ€§</h3>
            <div class="info">
                <strong>finally å—æ€»ä¼šæ‰§è¡Œï¼š</strong>
                <ul>
                    <li>æ— è®º try å—æ˜¯å¦æŠ›å‡ºå¼‚å¸¸</li>
                    <li>å³ä½¿ try/catch ä¸­æœ‰ return è¯­å¥</li>
                    <li>å¸¸ç”¨äºæ¸…ç†èµ„æºï¼ˆå…³é—­æ–‡ä»¶ã€é‡Šæ”¾é”ç­‰ï¼‰</li>
                </ul>
            </div>
            
            <h2>ä¸‰ã€throw è¯­å¥</h2>
            
            <h3>3.1 æŠ›å‡ºå¼‚å¸¸</h3>
            <pre><code>throw new Error('é”™è¯¯ä¿¡æ¯');
throw 'Simple error';  // å¯ä»¥æŠ›å‡ºä»»ä½•å€¼
throw 42;
throw { message: 'Custom error' };</code></pre>
            
            <h3>3.2 æ ‡å‡†é”™è¯¯ç±»å‹</h3>
            <table>
                <thead>
                    <tr>
                        <th>é”™è¯¯ç±»å‹</th>
                        <th>è¯´æ˜</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>Error</code></td>
                        <td>é€šç”¨é”™è¯¯</td>
                    </tr>
                    <tr>
                        <td><code>SyntaxError</code></td>
                        <td>è¯­æ³•é”™è¯¯</td>
                    </tr>
                    <tr>
                        <td><code>ReferenceError</code></td>
                        <td>å¼•ç”¨é”™è¯¯ï¼ˆå˜é‡ä¸å­˜åœ¨ï¼‰</td>
                    </tr>
                    <tr>
                        <td><code>TypeError</code></td>
                        <td>ç±»å‹é”™è¯¯</td>
                    </tr>
                    <tr>
                        <td><code>RangeError</code></td>
                        <td>èŒƒå›´é”™è¯¯</td>
                    </tr>
                    <tr>
                        <td><code>URIError</code></td>
                        <td>URI å¤„ç†é”™è¯¯</td>
                    </tr>
                    <tr>
                        <td><code>EvalError</code></td>
                        <td>eval() é”™è¯¯ï¼ˆå·²åºŸå¼ƒï¼‰</td>
                    </tr>
                </tbody>
            </table>
            
            <h2>å››ã€Error å¯¹è±¡</h2>
            
            <h3>4.1 Error å±æ€§</h3>
            <ul>
                <li><code>name</code> - é”™è¯¯åç§°</li>
                <li><code>message</code> - é”™è¯¯æ¶ˆæ¯</li>
                <li><code>stack</code> - è°ƒç”¨æ ˆï¼ˆéæ ‡å‡†ï¼Œä½†å¹¿æ³›æ”¯æŒï¼‰</li>
            </ul>
            
            <h3>4.2 åˆ›å»ºè‡ªå®šä¹‰é”™è¯¯</h3>
            <pre><code>class ValidationError extends Error {
    constructor(message) {
        super(message);
        this.name = 'ValidationError';
    }
}

throw new ValidationError('Invalid input');</code></pre>
            
            <h2>äº”ã€é”™è¯¯å¤„ç†æ¨¡å¼</h2>
            
            <h3>5.1 æ•è·ç‰¹å®šé”™è¯¯</h3>
            <pre><code>try {
    // ä»£ç 
} catch (error) {
    if (error instanceof TypeError) {
        // å¤„ç† TypeError
    } else if (error instanceof RangeError) {
        // å¤„ç† RangeError
    } else {
        // å¤„ç†å…¶ä»–é”™è¯¯
        throw error;  // é‡æ–°æŠ›å‡º
    }
}</code></pre>
            
            <h3>5.2 é‡æ–°æŠ›å‡ºé”™è¯¯</h3>
            <p>æ•è·é”™è¯¯åï¼Œå¦‚æœæ— æ³•å¤„ç†ï¼Œåº”è¯¥é‡æ–°æŠ›å‡ºï¼š</p>
            <pre><code>try {
    // ä»£ç 
} catch (error) {
    if (canHandle(error)) {
        // å¤„ç†
    } else {
        throw error;  // é‡æ–°æŠ›å‡º
    }
}</code></pre>
            
            <h3>5.3 é”™è¯¯åŒ…è£…</h3>
            <pre><code>// ä½¿ç”¨ cause ä¿ç•™åŸå§‹é”™è¯¯ï¼ˆES2022ï¼‰
try {
    // åº•å±‚æ“ä½œ
} catch (error) {
    throw new Error(`æ“ä½œå¤±è´¥: ${error.message}`, { cause: error });
}

// è®¿é—®åŸå§‹é”™è¯¯
try {
    // ...
} catch (wrappedError) {
    console.log(wrappedError.message);        // æ–°é”™è¯¯æ¶ˆæ¯
    console.log(wrappedError.cause);          // åŸå§‹é”™è¯¯
    console.log(wrappedError.cause.stack);    // åŸå§‹å †æ ˆ
}</code></pre>
            
            <h2>å…­ã€å¼‚æ­¥é”™è¯¯å¤„ç†</h2>
            
            <h3>6.1 Promise é”™è¯¯å¤„ç†</h3>
            <pre><code>// .catch()
promise
    .then(result => { ... })
    .catch(error => {
        console.error(error);
    });

// try...catch ä¸èƒ½æ•è· Promise é”™è¯¯
try {
    promise.then(...);  // æ— æ³•æ•è·å¼‚æ­¥é”™è¯¯
} catch (e) {
    // ä¸ä¼šæ‰§è¡Œ
}</code></pre>
            
            <h3>6.2 async/await é”™è¯¯å¤„ç†</h3>
            <pre><code>async function fetchData() {
    try {
        const response = await fetch(url);
        const data = await response.json();
        return data;
    } catch (error) {
        console.error('è·å–æ•°æ®å¤±è´¥:', error);
        throw error;
    }
}</code></pre>
            
            <h2>ä¸ƒã€æœ€ä½³å®è·µ</h2>
            
            <h3>7.1 å…·ä½“çš„é”™è¯¯æ¶ˆæ¯</h3>
            <div class="tip">
                <pre><code>// ä¸å¥½
throw new Error('Error');

// å¥½
throw new Error('ç”¨æˆ·åå¿…é¡»è‡³å°‘ 3 ä¸ªå­—ç¬¦');</code></pre>
            </div>
            
            <h3>7.2 ä¸è¦å¿½ç•¥é”™è¯¯</h3>
            <div class="warning">
                <pre><code>// ä¸å¥½ - ç©º catch å—
try {
    riskyOperation();
} catch (e) {
    // ä»€ä¹ˆéƒ½ä¸åš
}

// å¥½ - è‡³å°‘è®°å½•é”™è¯¯
try {
    riskyOperation();
} catch (error) {
    console.error('æ“ä½œå¤±è´¥:', error);
    // æˆ–è€…é‡æ–°æŠ›å‡º
}</code></pre>
            </div>
            
            <h3>7.3 ä½¿ç”¨è‡ªå®šä¹‰é”™è¯¯ç±»</h3>
            <p>ä¸ºä¸åŒç±»å‹çš„é”™è¯¯åˆ›å»ºä¸“é—¨çš„ç±»ï¼š</p>
            <pre><code>class NetworkError extends Error { ... }
class ValidationError extends Error { ... }
class AuthError extends Error { ... }</code></pre>
            
            <h3>7.4 ä¸è¦è¿‡åº¦ä½¿ç”¨ try...catch</h3>
            <div class="info">
                <ul>
                    <li>åªåœ¨å¯èƒ½å‡ºé”™çš„åœ°æ–¹ä½¿ç”¨</li>
                    <li>ä¸è¦ç”¨äºæ§åˆ¶æµç¨‹</li>
                    <li>é¢„å…ˆéªŒè¯æ¯”äº‹åæ•è·æ›´å¥½</li>
                </ul>
            </div>
            
            <h3>7.5 æ¸…ç†èµ„æº</h3>
            <p>ä½¿ç”¨ finally ç¡®ä¿èµ„æºè¢«é‡Šæ”¾ï¼š</p>
            <pre><code>let file;
try {
    file = openFile();
    processFile(file);
} catch (error) {
    console.error(error);
} finally {
    if (file) {
        file.close();  // ç¡®ä¿å…³é—­æ–‡ä»¶
    }
}</code></pre>
            
            <h2>å…«ã€è°ƒè¯•æŠ€å·§</h2>
            
            <h3>8.1 æŸ¥çœ‹è°ƒç”¨æ ˆ</h3>
            <pre><code>try {
    throw new Error('Something went wrong');
} catch (error) {
    console.error(error.stack);
}</code></pre>
            
            <h3>8.2 ä½¿ç”¨ console.trace()</h3>
            <pre><code>function a() { b(); }
function b() { c(); }
function c() { console.trace('Call stack'); }
a();</code></pre>
            
            <h3>8.3 debugger è¯­å¥</h3>
            <pre><code>function problematicFunction() {
    debugger;  // åœ¨å¼€å‘è€…å·¥å…·ä¸­ä¼šæš‚åœ
    // ä»£ç 
}</code></pre>
            
            <h2>ä¹ã€å…¨å±€é”™è¯¯å¤„ç†</h2>
            
            <h3>9.1 æµè§ˆå™¨ç¯å¢ƒ</h3>
            <pre><code>// æ•è·æœªå¤„ç†çš„é”™è¯¯
window.onerror = function(message, source, lineno, colno, error) {
    console.error('å…¨å±€é”™è¯¯:', message);
    return true;  // é˜»æ­¢é»˜è®¤å¤„ç†
};

// æ•è·æœªå¤„ç†çš„ Promise æ‹’ç»
window.addEventListener('unhandledrejection', event => {
    console.error('æœªå¤„ç†çš„ Promise æ‹’ç»:', event.reason);
});</code></pre>
            
            <h3>9.2 Node.js ç¯å¢ƒ</h3>
            <pre><code>process.on('uncaughtException', (error) => {
    console.error('æœªæ•è·çš„å¼‚å¸¸:', error);
    process.exit(1);
});

process.on('unhandledRejection', (reason, promise) => {
    console.error('æœªå¤„ç†çš„ Promise æ‹’ç»:', reason);
});</code></pre>
            
            <h2>å‚è€ƒèµ„æ–™</h2>
            <ul>
                <li><a href="https://tc39.es/ecma262/#sec-try-statement" target="_blank">ECMAScript - try Statement</a></li>
                <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/try...catch" target="_blank">MDN - try...catch</a></li>
                <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Error" target="_blank">MDN - Error</a></li>
            </ul>
            
            <div class="nav-links">
                <a href="03-loops.html" class="nav-link prev">ä¸Šä¸€èŠ‚ï¼šå¾ªç¯è¯­å¥</a>
                <a href="../index.html" class="nav-link home">è¿”å›é¦–é¡µ</a>
                <a href="04-closure.html" class="nav-link next">ä¸‹ä¸€èŠ‚ï¼šé—­åŒ…åŸç†</a>
            </div>
        </div>
        
        <div class="code-panel">
            <h2 style="color: #60a5fa; margin-bottom: 1.5rem;">ğŸ’» äº¤äº’å¼ä»£ç ç¤ºä¾‹</h2>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 1ï¼šåŸºæœ¬ try...catch</h3>
                <div class="code-block">
                    <pre><code>// æ­£å¸¸æ‰§è¡Œ
try {
    console.log('å¼€å§‹æ‰§è¡Œ');
    const result = 10 / 2;
    console.log('ç»“æœ:', result);
    console.log('æ­£å¸¸ç»“æŸ');
} catch (error) {
    console.log('ä¸ä¼šæ‰§è¡Œ');
}

// æ•è·é”™è¯¯
console.log('\n=== æ•è·é”™è¯¯ ===');
try {
    console.log('å¼€å§‹æ‰§è¡Œ');
    const obj = undefined;
    console.log(obj.name);  // TypeError
    console.log('è¿™è¡Œä¸ä¼šæ‰§è¡Œ');
} catch (error) {
    console.log('æ•è·åˆ°é”™è¯¯:', error.message);
}
console.log('ç¨‹åºç»§ç»­æ‰§è¡Œ');</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 2ï¼šfinally å­å¥</h3>
                <div class="code-block">
                    <pre><code>// finally æ€»æ˜¯æ‰§è¡Œ
function test(shouldThrow) {
    try {
        console.log('try å—æ‰§è¡Œ');
        if (shouldThrow) {
            throw new Error('æŠ›å‡ºé”™è¯¯');
        }
        return 'try è¿”å›';
    } catch (error) {
        console.log('catch å—æ‰§è¡Œ:', error.message);
        return 'catch è¿”å›';
    } finally {
        console.log('finally å—æ€»æ˜¯æ‰§è¡Œ');
    }
}

console.log('=== æ­£å¸¸æƒ…å†µ ===');
const result1 = test(false);
console.log('è¿”å›å€¼:', result1);

console.log('\n=== å¼‚å¸¸æƒ…å†µ ===');
const result2 = test(true);
console.log('è¿”å›å€¼:', result2);</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 3ï¼šthrow è¯­å¥</h3>
                <div class="code-block">
                    <pre><code>// æŠ›å‡ºä¸åŒç±»å‹çš„å€¼
function validateAge(age) {
    if (typeof age !== 'number') {
        throw new TypeError('å¹´é¾„å¿…é¡»æ˜¯æ•°å­—');
    }
    if (age < 0) {
        throw new RangeError('å¹´é¾„ä¸èƒ½ä¸ºè´Ÿæ•°');
    }
    if (age > 150) {
        throw new RangeError('å¹´é¾„è¶…å‡ºåˆç†èŒƒå›´');
    }
    return `å¹´é¾„: ${age}`;
}

// æµ‹è¯•
const testCases = [25, '25', -5, 200];
testCases.forEach(age => {
    try {
        console.log(validateAge(age));
    } catch (error) {
        console.log(`é”™è¯¯ [${error.name}]:`, error.message);
    }
});</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 4ï¼šè‡ªå®šä¹‰é”™è¯¯ç±»</h3>
                <div class="code-block">
                    <pre><code>// è‡ªå®šä¹‰é”™è¯¯ç±»
class ValidationError extends Error {
    constructor(message) {
        super(message);
        this.name = 'ValidationError';
    }
}

class NetworkError extends Error {
    constructor(message, statusCode) {
        super(message);
        this.name = 'NetworkError';
        this.statusCode = statusCode;
    }
}

// ä½¿ç”¨è‡ªå®šä¹‰é”™è¯¯
function processUser(user) {
    if (!user) {
        throw new ValidationError('ç”¨æˆ·å¯¹è±¡ä¸èƒ½ä¸ºç©º');
    }
    if (!user.name) {
        throw new ValidationError('ç”¨æˆ·åæ˜¯å¿…å¡«é¡¹');
    }
    if (user.age < 18) {
        throw new ValidationError('ç”¨æˆ·å¿…é¡»å¹´æ»¡18å²');
    }
    return `å¤„ç†ç”¨æˆ·: ${user.name}`;
}

// æµ‹è¯•
const users = [
    null,
    { age: 20 },
    { name: 'Bob', age: 16 },
    { name: 'Alice', age: 25 }
];

users.forEach((user, i) => {
    try {
        console.log(`ç”¨æˆ·${i}:`, processUser(user));
    } catch (error) {
        console.log(`ç”¨æˆ·${i} [${error.name}]:`, error.message);
    }
});</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 5ï¼šé”™è¯¯å¤„ç†æ¨¡å¼</h3>
                <div class="code-block">
                    <pre><code>// æ•è·ç‰¹å®šé”™è¯¯
function parseJSON(jsonString) {
    try {
        return JSON.parse(jsonString);
    } catch (error) {
        if (error instanceof SyntaxError) {
            console.log('JSON æ ¼å¼é”™è¯¯:', error.message);
            return null;
        }
        // å…¶ä»–é”™è¯¯é‡æ–°æŠ›å‡º
        throw error;
    }
}

console.log('=== è§£æ JSON ===');
console.log(parseJSON('{"name": "Alice"}'));
console.log(parseJSON('{invalid json}'));

// é”™è¯¯åŒ…è£…ï¼ˆä¿ç•™åŸå§‹é”™è¯¯ï¼‰
console.log('\n=== é”™è¯¯åŒ…è£… ===');
function fetchUserData(userId) {
    try {
        if (!userId) {
            throw new Error('ç”¨æˆ·IDä¸èƒ½ä¸ºç©º');
        }
        // æ¨¡æ‹Ÿæ•°æ®åº“é”™è¯¯
        if (userId < 0) {
            throw new Error('æ•°æ®åº“æŸ¥è¯¢å¤±è´¥');
        }
        return { id: userId, name: 'User' + userId };
    } catch (error) {
        // ä½¿ç”¨ cause ä¿ç•™åŸå§‹é”™è¯¯
        throw new Error(`è·å–ç”¨æˆ·æ•°æ®å¤±è´¥ (ID: ${userId})`, { cause: error });
    }
}

try {
    fetchUserData(-1);
} catch (error) {
    console.log('åŒ…è£…åçš„é”™è¯¯:', error.message);
    console.log('åŸå§‹é”™è¯¯:', error.cause.message);
    console.log('åŸå§‹é”™è¯¯å¯¹è±¡:', error.cause);
}</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
            
            <div class="code-example">
                <h3>ç¤ºä¾‹ 6ï¼šå®ç”¨æŠ€å·§</h3>
                <div class="code-block">
                    <pre><code>// æŠ€å·§1ï¼šä½¿ç”¨ Error å¯¹è±¡è·å–è°ƒç”¨æ ˆ
console.log('=== è°ƒç”¨æ ˆ ===');
function a() { b(); }
function b() { c(); }
function c() {
    try {
        throw new Error('è¿½è¸ªè°ƒç”¨æ ˆ');
    } catch (e) {
        console.log('é”™è¯¯æ¶ˆæ¯:', e.message);
        console.log('è°ƒç”¨æ ˆ:');
        console.log(e.stack);
    }
}
a();

// æŠ€å·§2ï¼šèµ„æºæ¸…ç†
console.log('\n=== èµ„æºæ¸…ç† ===');
function processFile(fileName) {
    let resource = null;
    try {
        console.log(`æ‰“å¼€æ–‡ä»¶: ${fileName}`);
        resource = { name: fileName, isOpen: true };
        
        if (fileName === 'invalid.txt') {
            throw new Error('æ–‡ä»¶æ— æ•ˆ');
        }
        
        console.log('å¤„ç†æ–‡ä»¶...');
        return 'success';
    } catch (error) {
        console.log('é”™è¯¯:', error.message);
        return 'failed';
    } finally {
        if (resource && resource.isOpen) {
            console.log('å…³é—­æ–‡ä»¶');
            resource.isOpen = false;
        }
    }
}

processFile('valid.txt');
console.log('---');
processFile('invalid.txt');</code></pre>
                </div>
                <button class="run-btn">â–¶ è¿è¡Œä»£ç </button>
                <div class="output"></div>
            </div>
        </div>
    </div>
    
    <script src="../assets/js/common.js"></script>
</body>
</html>
