# ç¬¬ 1 ç« ï¼šä¸ºä»€ä¹ˆéœ€è¦ Babel

## æ¦‚è¿°

Babel æ˜¯ JavaScript ç¼–è¯‘å™¨ï¼Œå°†æ–°ç‰ˆæœ¬çš„ JavaScript ä»£ç è½¬æ¢ä¸ºå‘åå…¼å®¹çš„ç‰ˆæœ¬ã€‚ç†è§£ Babel çš„å®šä½ï¼Œæ˜¯æŒæ¡å‰ç«¯å…¼å®¹æ€§å¤„ç†çš„ç¬¬ä¸€æ­¥ã€‚

## ä¸€ã€é—®é¢˜çš„æ ¹æº

### 1.1 JavaScript çš„æ¼”è¿›é€Ÿåº¦

```
ES5 (2009) â†’ ES6/ES2015 â†’ ES2016 â†’ ES2017 â†’ ... â†’ ES2024
   â†“              â†“           â†“          â†“
 æ‰€æœ‰æµè§ˆå™¨    éƒ¨åˆ†æ”¯æŒ     éƒ¨åˆ†æ”¯æŒ    æœ€æ–°æµè§ˆå™¨
```

**æ ¸å¿ƒçŸ›ç›¾**ï¼š
- JavaScript è¯­è¨€æ ‡å‡†æ¯å¹´æ›´æ–°
- ç”¨æˆ·æµè§ˆå™¨æ›´æ–°æ»åï¼ˆå°¤å…¶ä¼ä¸šç”¨æˆ·ï¼‰
- å¼€å‘è€…æƒ³ç”¨æ–°ç‰¹æ€§ï¼Œä½†è¦å…¼å®¹æ—§æµè§ˆå™¨

### 1.2 è¯­æ³• vs API çš„åŒºåˆ«

è¿™æ˜¯ç†è§£ Babel çš„å…³é”®ï¼š

| ç±»å‹ | ç¤ºä¾‹ | èƒ½å¦é€šè¿‡è½¬æ¢è§£å†³ |
|------|------|------------------|
| **è¯­æ³•** | ç®­å¤´å‡½æ•°ã€classã€è§£æ„ | âœ… å¯ä»¥è½¬æ¢ä¸ºç­‰ä»·çš„æ—§è¯­æ³• |
| **API** | Promiseã€Array.includes | âŒ éœ€è¦ Polyfill è¡¥ä¸ |

```javascript
// è¯­æ³•é—®é¢˜ - Babel å¯ä»¥è½¬æ¢
const add = (a, b) => a + b;
// è½¬æ¢ä¸º
var add = function(a, b) { return a + b; };

// API é—®é¢˜ - Babel ä¸èƒ½è§£å†³ï¼Œéœ€è¦ Polyfill
[1, 2, 3].includes(2);  // includes æ˜¯è¿è¡Œæ—¶ API
```

> **ğŸ’¡ æ ¸å¿ƒç†è§£**  
> Babel è§£å†³çš„æ˜¯"è¯­æ³•"é—®é¢˜ï¼Œä¸æ˜¯"API"é—®é¢˜ã€‚  
> è¯­æ³•æ˜¯ä»£ç çš„å†™æ³•ï¼ŒAPI æ˜¯è¿è¡Œæ—¶çš„åŠŸèƒ½ã€‚

## äºŒã€Babel è§£å†³ä»€ä¹ˆé—®é¢˜

### 2.1 è¯­æ³•è½¬æ¢ï¼ˆTranspilationï¼‰

```javascript
// è¾“å…¥ï¼šES6+ è¯­æ³•
class Person {
  constructor(name) {
    this.name = name;
  }
  greet = () => {
    console.log(`Hello, ${this.name}`);
  }
}

// è¾“å‡ºï¼šES5 è¯­æ³•ï¼ˆç®€åŒ–ç‰ˆï¼‰
function Person(name) {
  this.name = name;
  this.greet = function() {
    console.log("Hello, " + this.name);
  };
}
```

### 2.2 Babel å¯ä»¥è½¬æ¢çš„è¯­æ³•

| ES ç‰ˆæœ¬ | è¯­æ³•ç‰¹æ€§ |
|---------|----------|
| ES6 | ç®­å¤´å‡½æ•°ã€classã€æ¨¡æ¿å­—ç¬¦ä¸²ã€è§£æ„ã€let/const |
| ES7 | æŒ‡æ•°è¿ç®—ç¬¦ `**`ã€Array.prototype.includes |
| ES8 | async/awaitã€Object.entries |
| ES9 | å±•å¼€è¿ç®—ç¬¦ã€å¼‚æ­¥è¿­ä»£ |
| ES10+ | å¯é€‰é“¾ `?.`ã€ç©ºå€¼åˆå¹¶ `??`ã€ç§æœ‰å­—æ®µ `#` |

### 2.3 Babel ä¸èƒ½è§£å†³çš„é—®é¢˜

```javascript
// âŒ è¿™äº›æ˜¯ APIï¼Œéœ€è¦ Polyfill
Promise.resolve(1);
Array.from([1, 2, 3]);
Object.assign({}, { a: 1 });
fetch('/api/data');
```

## ä¸‰ã€Babel çš„æ ¸å¿ƒä»·å€¼

### 3.1 å¼€å‘ä½“éªŒæå‡

```javascript
// å¼€å‘æ—¶ï¼šä½¿ç”¨æœ€æ–°è¯­æ³•ï¼Œæé«˜æ•ˆç‡
const users = data?.users ?? [];
const doubled = numbers.map(n => n * 2);

// æ„å»ºåï¼šè‡ªåŠ¨è½¬æ¢ä¸ºå…¼å®¹ä»£ç 
// å¼€å‘è€…æ— éœ€å…³å¿ƒå…¼å®¹æ€§ç»†èŠ‚
```

### 3.2 æ¸è¿›å¼é‡‡ç”¨æ–°ç‰¹æ€§

```
æ–°ç‰¹æ€§å‘å¸ƒ â†’ Babel æ”¯æŒ â†’ å¼€å‘è€…ä½¿ç”¨ â†’ æµè§ˆå™¨æ”¯æŒ â†’ ç§»é™¤è½¬æ¢
```

**å®é™…æ¡ˆä¾‹**ï¼š
- 2015 å¹´ï¼šç®­å¤´å‡½æ•°éœ€è¦ Babel è½¬æ¢
- 2024 å¹´ï¼šæ‰€æœ‰ä¸»æµæµè§ˆå™¨éƒ½æ”¯æŒï¼Œå¯ä»¥ä¸è½¬æ¢

### 3.3 ä¸€è‡´çš„ä»£ç é£æ ¼

å›¢é˜Ÿå¯ä»¥ç»Ÿä¸€ä½¿ç”¨æœ€æ–°è¯­æ³•ï¼Œç”± Babel ç»Ÿä¸€å¤„ç†å…¼å®¹æ€§ï¼š

```javascript
// å›¢é˜Ÿä»£ç é£æ ¼ç»Ÿä¸€
const Component = ({ name }) => <div>{name}</div>;

// ä¸ç”¨æ‹…å¿ƒæœ‰äººä¸ºäº†å…¼å®¹æ€§å†™æˆ
var Component = function(props) {
  return React.createElement('div', null, props.name);
};
```

## å››ã€Babel çš„å®šä½

### 4.1 ç¼–è¯‘å™¨ï¼Œä¸æ˜¯è¿è¡Œæ—¶

```
æºä»£ç  (.js) â†’ Babel ç¼–è¯‘ â†’ äº§ç‰©ä»£ç  (.js) â†’ æµè§ˆå™¨æ‰§è¡Œ
     â†‘                              â†‘
  å¼€å‘æ—¶å†™çš„ä»£ç               æœ€ç»ˆè¿è¡Œçš„ä»£ç 
```

> **âš ï¸ æ³¨æ„**  
> Babel åœ¨**æ„å»ºæ—¶**å·¥ä½œï¼Œäº§ç‰©æ˜¯å¦ä¸€ä»½ JS ä»£ç ã€‚  
> Polyfill åœ¨**è¿è¡Œæ—¶**å·¥ä½œï¼Œè¡¥å……æµè§ˆå™¨ç¼ºå¤±çš„ APIã€‚

### 4.2 ä¸å…¶ä»–å·¥å…·çš„å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ„å»ºå·¥å…·é“¾                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Vite / webpack / Rollup                â”‚
â”‚         â†“                               â”‚
â”‚  Babelï¼ˆJS è¯­æ³•è½¬æ¢ï¼‰                    â”‚
â”‚  PostCSSï¼ˆCSS è½¬æ¢ï¼‰                     â”‚
â”‚  TypeScriptï¼ˆç±»å‹æ£€æŸ¥ + è½¬æ¢ï¼‰           â”‚
â”‚         â†“                               â”‚
â”‚  äº§ç‰©ä»£ç                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## äº”ã€ä»€ä¹ˆæ—¶å€™éœ€è¦ Babel

### 5.1 éœ€è¦çš„åœºæ™¯

| åœºæ™¯ | è¯´æ˜ |
|------|------|
| æ”¯æŒæ—§æµè§ˆå™¨ | IE11ã€æ—§ç‰ˆ Safari |
| ä½¿ç”¨å®éªŒæ€§è¯­æ³• | è£…é¥°å™¨ã€ç®¡é“è¿ç®—ç¬¦ |
| JSX è½¬æ¢ | React/Vue JSX è¯­æ³• |
| TypeScriptï¼ˆå¯é€‰ï¼‰ | ç§»é™¤ç±»å‹æ³¨è§£ |

### 5.2 å¯èƒ½ä¸éœ€è¦çš„åœºæ™¯

| åœºæ™¯ | åŸå›  |
|------|------|
| åªæ”¯æŒç°ä»£æµè§ˆå™¨ | åŸç”Ÿæ”¯æŒ ES6+ |
| Node.js åç«¯ | Node 12+ æ”¯æŒç»å¤§å¤šæ•°è¯­æ³• |
| ä½¿ç”¨ esbuild/SWC | å®ƒä»¬å†…ç½®äº†è¯­æ³•è½¬æ¢ |

## å…­ã€å¸¸è§è¯¯åŒº

### 6.1 è¯¯åŒºä¸€ï¼šBabel èƒ½è§£å†³æ‰€æœ‰å…¼å®¹æ€§é—®é¢˜

```javascript
// âŒ é”™è¯¯ç†è§£
// "ç”¨äº† Babelï¼ŒPromise å°±èƒ½åœ¨ IE ä¸­å·¥ä½œäº†"

// âœ… æ­£ç¡®ç†è§£
// Babel åªè½¬æ¢è¯­æ³•ï¼ŒPromise éœ€è¦é¢å¤–çš„ Polyfill
```

### 6.2 è¯¯åŒºäºŒï¼šBabel ä¼šè®©ä»£ç å˜æ…¢

```javascript
// è½¬æ¢åçš„ä»£ç ç¡®å®æ›´é•¿ï¼Œä½†ï¼š
// 1. ç°ä»£æµè§ˆå™¨ä¸éœ€è¦è½¬æ¢ï¼ˆé€šè¿‡ targets é…ç½®ï¼‰
// 2. è¿è¡Œæ—¶æ€§èƒ½å·®å¼‚å¯å¿½ç•¥
// 3. gzip åä½“ç§¯å·®å¼‚å¾ˆå°
```

### 6.3 è¯¯åŒºä¸‰ï¼šBabel æ˜¯å¿…é¡»çš„

```javascript
// å¦‚æœä½ çš„ç”¨æˆ·éƒ½ä½¿ç”¨ç°ä»£æµè§ˆå™¨
// å¯ä»¥è€ƒè™‘ä¸ç”¨ Babelï¼Œç›´æ¥è¾“å‡º ES6+ ä»£ç 
// ä¾‹å¦‚ï¼šå†…éƒ¨å·¥å…·ã€Electron åº”ç”¨
```

## ä¸ƒã€å¿«é€Ÿå¼€å§‹

### 7.1 æœ€å°é…ç½®

```bash
npm install -D @babel/core @babel/preset-env
```

```javascript
// babel.config.js
module.exports = {
  presets: [
    ['@babel/preset-env', {
      targets: '> 0.25%, not dead'
    }]
  ]
};
```

### 7.2 éªŒè¯è½¬æ¢æ•ˆæœ

```bash
# æŸ¥çœ‹è½¬æ¢ç»“æœ
npx babel src/index.js --out-file dist/index.js
```

## å‚è€ƒèµ„æ–™

- [Babel å®˜æ–¹æ–‡æ¡£](https://babeljs.io/docs/)
- [Can I Use](https://caniuse.com/) - æŸ¥è¯¢ç‰¹æ€§æ”¯æŒæƒ…å†µ
- [ECMAScript å…¼å®¹æ€§è¡¨](https://kangax.github.io/compat-table/es6/)

---

**ä¸‹ä¸€ç« ** â†’ [ç¬¬ 2 ç« ï¼šBabel æ ¸å¿ƒåŸç†](./02-babel-core.md)
