# åŒ…ç®¡ç†å™¨ç®€ä»‹ä¸å‘å±•å²

## æ¦‚è¿°

åŒ…ç®¡ç†å™¨æ˜¯ç°ä»£å‰ç«¯å¼€å‘çš„åŸºç¡€è®¾æ–½ã€‚ç†è§£åŒ…ç®¡ç†å™¨çš„æœ¬è´¨å’Œå‘å±•å†ç¨‹ï¼Œèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°é€‰æ‹©å’Œä½¿ç”¨åˆé€‚çš„å·¥å…·ã€‚

## ä¸€ã€ä»€ä¹ˆæ˜¯åŒ…ç®¡ç†å™¨

### 1.1 åŒ…ç®¡ç†å™¨çš„æœ¬è´¨

åŒ…ç®¡ç†å™¨ï¼ˆPackage Managerï¼‰æ˜¯è‡ªåŠ¨åŒ–ç®¡ç†è½¯ä»¶åŒ…ï¼ˆä¾èµ–ï¼‰çš„å·¥å…·ï¼Œè´Ÿè´£ï¼š

- **ä¸‹è½½ä¾èµ–**ï¼šä»è¿œç¨‹ä»“åº“è·å–ä»£ç åŒ…
- **ç‰ˆæœ¬ç®¡ç†**ï¼šæ§åˆ¶ä¾èµ–çš„ç‰ˆæœ¬
- **ä¾èµ–è§£æ**ï¼šå¤„ç†ä¾èµ–ä¹‹é—´çš„å…³ç³»
- **å®‰è£…éƒ¨ç½²**ï¼šå°†ä¾èµ–æ”¾ç½®åˆ°æ­£ç¡®ä½ç½®

```bash
# å®‰è£…ä¾èµ–
npm install lodash

# è‡ªåŠ¨å®Œæˆï¼š
# 1. è§£æ lodash çš„ç‰ˆæœ¬
# 2. ä¸‹è½½ lodash åŠå…¶ä¾èµ–
# 3. æ”¾å…¥ node_modules
# 4. æ›´æ–° package.json å’Œ lock æ–‡ä»¶
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦åŒ…ç®¡ç†å™¨

**æ²¡æœ‰åŒ…ç®¡ç†å™¨çš„æ—¶ä»£ï¼š**

```html
<!-- æ‰‹åŠ¨ä¸‹è½½ã€ç®¡ç†ä¾èµ– -->
<script src="./vendor/jquery-3.6.0.min.js"></script>
<script src="./vendor/lodash-4.17.21.min.js"></script>
```

**é—®é¢˜ï¼š**
- âŒ æ‰‹åŠ¨ä¸‹è½½ã€æ›´æ–°ä¾èµ–
- âŒ ç‰ˆæœ¬ç®¡ç†æ··ä¹±
- âŒ æ— æ³•è¿½è¸ªä¾èµ–å…³ç³»
- âŒ å›¢é˜Ÿåä½œå›°éš¾

**æœ‰äº†åŒ…ç®¡ç†å™¨ï¼š**

```json
{
  "dependencies": {
    "jquery": "^3.6.0",
    "lodash": "^4.17.21"
  }
}
```

```bash
npm install  # ä¸€é”®å®‰è£…æ‰€æœ‰ä¾èµ–
```

## äºŒã€JavaScript åŒ…ç®¡ç†å™¨å‘å±•å²

### 2.1 npmï¼ˆ2010å¹´ï¼‰

**è¯ç”ŸèƒŒæ™¯ï¼š**
- Node.js å‘å¸ƒåæ€¥éœ€ä¾èµ–ç®¡ç†å·¥å…·
- Isaac Z. Schlueter åˆ›å»ºäº† npm

**æ ¸å¿ƒç‰¹æ€§ï¼š**
- ä¸­å¤®åŒ–çš„ npm registry
- `package.json` é…ç½®æ–‡ä»¶
- åµŒå¥—çš„ `node_modules` ç»“æ„

```bash
# npm æ—©æœŸç‰ˆæœ¬ï¼ˆåµŒå¥—ä¾èµ–ï¼‰
node_modules/
â”œâ”€â”€ A/
â”‚   â””â”€â”€ node_modules/
â”‚       â””â”€â”€ C@1.0/
â””â”€â”€ B/
    â””â”€â”€ node_modules/
        â””â”€â”€ C@2.0/
```

**é—®é¢˜ï¼š**
- ğŸŒ å®‰è£…é€Ÿåº¦æ…¢
- ğŸ’¾ ç£ç›˜ç©ºé—´æµªè´¹ï¼ˆé‡å¤ä¾èµ–ï¼‰
- ğŸ“ ç›®å½•å±‚çº§è¿‡æ·±ï¼ˆWindows è·¯å¾„é™åˆ¶ï¼‰

### 2.2 npm v3ï¼ˆ2015å¹´ï¼‰- æ‰å¹³åŒ–

**æ”¹è¿›ï¼š** ä¾èµ–æ‰å¹³åŒ–ï¼ˆFlatï¼‰

```bash
node_modules/
â”œâ”€â”€ A/
â”œâ”€â”€ B/
â”œâ”€â”€ C@1.0/  # æå‡åˆ°é¡¶å±‚
â””â”€â”€ B/
    â””â”€â”€ node_modules/
        â””â”€â”€ C@2.0/  # ç‰ˆæœ¬å†²çªï¼Œä¿æŒåµŒå¥—
```

**ä¼˜ç‚¹ï¼š**
- âœ… å‡å°‘é‡å¤ä¾èµ–
- âœ… ç›®å½•å±‚çº§å˜æµ…

**æ–°é—®é¢˜ï¼š**
- âš ï¸ å¹½çµä¾èµ–ï¼ˆPhantom Dependenciesï¼‰
- âš ï¸ ä¾èµ–æå‡ä¸ç¡®å®šæ€§

### 2.3 Yarnï¼ˆ2016å¹´ï¼‰

**è¯ç”ŸèƒŒæ™¯ï¼š**
- Facebookã€Googleã€Exponent å’Œ Tilde è”åˆæ¨å‡º
- è§£å†³ npm v3 çš„æ€§èƒ½å’Œå®‰å…¨é—®é¢˜

**æ ¸å¿ƒåˆ›æ–°ï¼š**

**1. ç¡®å®šæ€§å®‰è£…ï¼ˆDeterministicï¼‰**
```bash
# yarn.lock é”å®šç²¾ç¡®ç‰ˆæœ¬
lodash@^4.17.0:
  version "4.17.21"
  resolved "https://registry.yarnpkg.com/lodash/-/lodash-4.17.21.tgz"
  integrity sha512-v2kDEe57lecTulaDIuNTPy3Ry4gLGJ6Z1O3vE1krgXZNrsQ+LFTGHVxVjcXPs17LhbZVGedAJv8XZ1tvj5FvSg==
```

**2. å¹¶è¡Œå®‰è£…**
```bash
# åŒæ—¶ä¸‹è½½å¤šä¸ªåŒ…
[1/4] Resolving packages...
[2/4] Fetching packages...  âš¡ å¹¶è¡Œä¸‹è½½
[3/4] Linking dependencies...
[4/4] Building fresh packages...
```

**3. ç¦»çº¿ç¼“å­˜**
```bash
~/.yarn/cache/
â”œâ”€â”€ lodash-4.17.21.tgz
â””â”€â”€ react-18.2.0.tgz

# ç¬¬äºŒæ¬¡å®‰è£…ç›´æ¥ä»ç¼“å­˜è¯»å–
```

**4. Workspacesï¼ˆMonorepo æ”¯æŒï¼‰**
```json
{
  "workspaces": ["packages/*"]
}
```

### 2.4 pnpmï¼ˆ2017å¹´ï¼‰â­

**è¯ç”ŸèƒŒæ™¯ï¼š**
- ç”± Zoltan Kochan åˆ›å»º
- è§£å†³ npm/yarn çš„ç£ç›˜ç©ºé—´å’Œå¹½çµä¾èµ–é—®é¢˜

**æ ¸å¿ƒåˆ›æ–°ï¼šå†…å®¹å¯»å€å­˜å‚¨ï¼ˆContent-Addressable Storageï¼‰**

```bash
# pnpm å…¨å±€ store
~/.pnpm-store/
â””â”€â”€ v3/
    â””â”€â”€ files/
        â””â”€â”€ 00/
            â””â”€â”€ 1a2b3c...  # ä»¥æ–‡ä»¶å“ˆå¸Œå‘½å

# é¡¹ç›®ä¸­ä½¿ç”¨ç¡¬é“¾æ¥
node_modules/
â”œâ”€â”€ .pnpm/  # çœŸå®æ–‡ä»¶
â”‚   â””â”€â”€ lodash@4.17.21/
â”‚       â””â”€â”€ node_modules/
â”‚           â””â”€â”€ lodash/  # ç¡¬é“¾æ¥åˆ° store
â””â”€â”€ lodash -> .pnpm/lodash@4.17.21/node_modules/lodash  # è½¯é“¾æ¥
```

**ä¼˜åŠ¿ï¼š**
- âš¡ **é€Ÿåº¦å¿«**ï¼šç¡¬é“¾æ¥ï¼Œç¬é—´å®Œæˆ
- ğŸ’¾ **èŠ‚çœç©ºé—´**ï¼šåŒä¸€ä¸ªåŒ…åªå­˜ä¸€ä»½
- ğŸ”’ **ä¸¥æ ¼ä¾èµ–**ï¼šæ²¡æœ‰å¹½çµä¾èµ–
- ğŸ¯ **Monorepo å‹å¥½**

### 2.5 Yarn Berryï¼ˆ2020å¹´ï¼‰- Yarn v2+

**æ ¸å¿ƒç‰¹æ€§ï¼šPlug'n'Play (PnP)**

```javascript
// .pnp.cjs - ä¸å†éœ€è¦ node_modules
module.exports = {
  packageRegistryData: [
    ["lodash", [
      ["4.17.21", {
        packageLocation: "./.yarn/cache/lodash-npm-4.17.21-6382451519-b0b0c7b24a.zip/node_modules/lodash/",
      }]
    ]]
  ]
};
```

**åˆ›æ–°ï¼š**
- ğŸš« **é›¶å®‰è£…ï¼ˆZero-Installï¼‰**ï¼šä¸ç”Ÿæˆ `node_modules`
- ğŸ“¦ **å‹ç¼©åŒ…ä¾èµ–**ï¼šç›´æ¥ä» `.zip` è¯»å–
- âš¡ **å¯åŠ¨é€Ÿåº¦å¿«**ï¼šæ— éœ€éå†ç›®å½•

## ä¸‰ã€ä¸‰å¤§åŒ…ç®¡ç†å™¨å¯¹æ¯”

### 3.1 åŠŸèƒ½å¯¹æ¯”è¡¨

| ç‰¹æ€§ | npm | Yarn Classic | pnpm | Yarn Berry |
|------|-----|-------------|------|------------|
| **å®‰è£…é€Ÿåº¦** | ğŸŒ æ…¢ | âš¡ å¿« | âš¡âš¡ æœ€å¿« | âš¡âš¡ æœ€å¿« |
| **ç£ç›˜ç©ºé—´** | ğŸ’¾ğŸ’¾ å¤§ | ğŸ’¾ğŸ’¾ å¤§ | ğŸ’¾ å° | ğŸ’¾ å° |
| **Monorepo** | âš ï¸ Workspaces | âœ… Workspaces | âœ…âœ… æœ€ä½³ | âœ… PnP |
| **å¹½çµä¾èµ–** | âŒ å­˜åœ¨ | âŒ å­˜åœ¨ | âœ… æ²¡æœ‰ | âœ… æ²¡æœ‰ |
| **é”æ–‡ä»¶** | package-lock.json | yarn.lock | pnpm-lock.yaml | yarn.lock |
| **å­¦ä¹ æˆæœ¬** | â­ ä½ | â­â­ ä¸­ | â­â­ ä¸­ | â­â­â­ é«˜ |
| **ç”Ÿæ€å…¼å®¹** | âœ…âœ… æœ€ä½³ | âœ… å¥½ | âœ… å¥½ | âš ï¸ ä¸€èˆ¬ |

### 3.2 æ€§èƒ½å¯¹æ¯”ï¼ˆå®‰è£…æ—¶é—´ï¼‰

```bash
# æµ‹è¯•é¡¹ç›®ï¼šVue 3 + 200+ ä¾èµ–

npm install     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 45s
yarn install    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 28s
pnpm install    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 14s
yarn berry      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 16s (PnP)
```

### 3.3 ç£ç›˜å ç”¨å¯¹æ¯”

```bash
# 10ä¸ªé¡¹ç›®ï¼Œç›¸åŒä¾èµ–

npm:  5.2 GB  (æ¯ä¸ªé¡¹ç›®ç‹¬ç«‹ node_modules)
yarn: 5.0 GB  (æ¯ä¸ªé¡¹ç›®ç‹¬ç«‹ node_modules)
pnpm: 1.8 GB  (å…¨å±€ store + ç¡¬é“¾æ¥)
```

## å››ã€å¦‚ä½•é€‰æ‹©åŒ…ç®¡ç†å™¨

### 4.1 å†³ç­–æ ‘

```
æ˜¯å¦ä½¿ç”¨ Monorepoï¼Ÿ
â”œâ”€ æ˜¯ â†’ pnpmï¼ˆæœ€ä½³ï¼‰ / Yarn Workspaces
â””â”€ å¦ 
   â”œâ”€ å›¢é˜Ÿå·²ç”¨ npm â†’ ç»§ç»­ä½¿ç”¨ npm
   â”œâ”€ è¿½æ±‚æ€§èƒ½å’Œç©ºé—´ â†’ pnpm
   â”œâ”€ éœ€è¦ PnP ç‰¹æ€§ â†’ Yarn Berry
   â””â”€ ç¨³å®šç¬¬ä¸€ â†’ npm / Yarn Classic
```

### 4.2 æ¨èåœºæ™¯

**npmï¼š**
- âœ… å°å‹é¡¹ç›®
- âœ… å›¢é˜Ÿå·²ä¹ æƒ¯
- âœ… å…¼å®¹æ€§ç¬¬ä¸€

**Yarn Classicï¼š**
- âœ… ä¸­å‹é¡¹ç›®
- âœ… éœ€è¦ Workspaces
- âœ… è¿½æ±‚ç¨³å®š

**pnpmï¼šâ­ æ¨è**
- âœ… æ‰€æœ‰ç±»å‹é¡¹ç›®
- âœ… Monorepo
- âœ… è¿½æ±‚æ€§èƒ½å’Œç©ºé—´
- âœ… é¿å…å¹½çµä¾èµ–

**Yarn Berryï¼š**
- âœ… å®éªŒæ€§é¡¹ç›®
- âœ… é›¶å®‰è£…éœ€æ±‚
- âš ï¸ éœ€è¦å›¢é˜Ÿå­¦ä¹ æˆæœ¬

### 4.3 è¿ç§»å»ºè®®

```bash
# npm â†’ pnpm
npm i -g pnpm
pnpm import  # è‡ªåŠ¨è½¬æ¢ package-lock.json
pnpm install

# yarn â†’ pnpm
pnpm import  # è‡ªåŠ¨è½¬æ¢ yarn.lock
pnpm install

# æ¸…ç†æ—§ node_modules
rm -rf node_modules package-lock.json yarn.lock
```

## äº”ã€åŒ…ç®¡ç†å™¨çš„æœªæ¥è¶‹åŠ¿

### 5.1 æ€§èƒ½ä¼˜åŒ–

- âš¡ **æ›´å¿«çš„å®‰è£…é€Ÿåº¦**ï¼šå¹¶è¡Œã€å¢é‡å®‰è£…
- ğŸ’¾ **æ›´å°çš„ç£ç›˜å ç”¨**ï¼šå†…å®¹å¯»å€ã€å»é‡
- ğŸŒ **æ›´å¥½çš„ç½‘ç»œä¼˜åŒ–**ï¼šCDNã€é•œåƒ

### 5.2 å®‰å…¨å¢å¼º

- ğŸ”’ **ä¾èµ–ç­¾åéªŒè¯**
- ğŸ›¡ï¸ **ä¾›åº”é“¾å®‰å…¨**
- ğŸ” **è‡ªåŠ¨æ¼æ´æ‰«æ**

### 5.3 Monorepo æ”¯æŒ

- ğŸ“¦ **åŸç”Ÿ Workspaces æ”¯æŒ**
- ğŸ”— **æ›´å¥½çš„ä¾èµ–å…±äº«**
- ğŸš€ **å¢é‡æ„å»ºä¼˜åŒ–**

### 5.4 é›¶é…ç½®ä½“éªŒ

- ğŸ¯ **æ™ºèƒ½æ¨æ–­é…ç½®**
- ğŸ¤– **è‡ªåŠ¨ä¼˜åŒ–å»ºè®®**
- ğŸ“Š **å¯è§†åŒ–ä¾èµ–åˆ†æ**

## å‚è€ƒèµ„æ–™

- [npm å®˜æ–¹æ–‡æ¡£](https://docs.npmjs.com/)
- [Yarn å®˜æ–¹æ–‡æ¡£](https://yarnpkg.com/)
- [pnpm å®˜æ–¹æ–‡æ¡£](https://pnpm.io/)
- [JavaScript Package Managers: npm vs Yarn vs pnpm](https://www.sitepoint.com/javascript-package-managers-npm-yarn-pnpm/)

---

**å¯¼èˆª**  
[è¿”å›ç›®å½•](../README.md) | [ä¸‹ä¸€ç« ï¼šæ¨¡å—åŒ–ä¸ä¾èµ–ç®¡ç†](./02-modularity.md)
