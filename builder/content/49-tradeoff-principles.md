# 工具选择的权衡之道

## 概述

构建工具选型最常见的误区是：

- 把选型当成“技术先进性投票”
- 把工具差异理解成“谁更强”而不是“谁更适合”

更可靠的选型方式是：把它当作一次**工程权衡**：

- 你要优化什么（开发反馈？产物控制？生态兼容？团队成本？）
- 你愿意为此付出什么（迁移成本？约束与规范？配置复杂度？）

这篇给出一套可复用的权衡框架，帮助你在真实项目里做出“可解释、可落地、可长期维护”的决策。

---

## 一、先确定你的“主目标函数”

你至少要在下面三类目标里选一个作为主优先级：

1. **开发效率优先**：冷启动、HMR、调试体验
2. **产物控制优先**：复杂拆包、运行时注入、输出结构、兼容策略
3. **生态兼容优先**：历史 loader/plugin、业务沉淀、团队熟悉度

> **关键点**
>
> 选型不是“全面最优”，而是明确主目标后，再接受次目标的合理损失。

---

## 二、用 6 个维度做工程化评估

### 2.1 开发体验（Dev UX）

- 冷启动时间
- HMR 边界与稳定性
- 错误定位（sourcemap、overlay）

### 2.2 产物能力（Output Control）

- chunk 拆分策略可控程度
- 资源输出结构与缓存策略
- 多入口/多页面/微前端

### 2.3 生态兼容（Ecosystem）

- 能否复用已有插件/loader
- 框架集成成熟度
- 社区问题的可搜索性

### 2.4 性能与可扩展（Performance & Scale）

- 大项目构建吞吐
- 缓存（持久化缓存、远端缓存）
- CI 稳定性与可观测性

### 2.5 团队成本（Team Cost）

- 学习曲线
- Debug 成本（出现异常时能否定位）
- 招聘与交接（市场普及度）

### 2.6 迁移与风险（Migration & Risk）

- 是否可渐进迁移
- 是否有回滚路径
- 是否有关键路径不可替代（例如某个 loader）

---

## 三、典型决策建议（把话说清楚）

### 3.1 新项目：优先平台工具

- Web 应用：Vite / Rsbuild
- 追求“约定与治理”：Rsbuild 更偏开箱即用
- 追求 ESM dev 体验与生态：Vite 更典型

### 3.2 老项目：优先降低风险

- 深度依赖 webpack 生态：
  - 优先优化 webpack（缓存、缩小转译范围）
  - 或迁移到 Rspack/Rsbuild（对齐 webpack 配置）

### 3.3 企业级：治理优先

- 统一默认值、统一插件策略、统一质量门禁
- 强化可观测性（stats/profile/产物体积监控）

---

## 四、一个可落地的选型流程（精简）

1. **列清楚场景与约束**
   - 浏览器兼容要求、是否微前端、是否多入口、是否强依赖历史 loader。

2. **建立基线指标**
   - 当前构建耗时、产物体积、HMR 体验、CI 时间。

3. **做最小 POC**
   - 用同一套入口与业务代码验证：跑通、体积、性能、调试体验。

4. **评估迁移成本与回滚**
   - 不要把“迁移完再说”当计划。

5. **固化到工程规范**
   - 写成模板、脚手架、共享配置；否则选型收益会被后续项目差异抵消。

---

## 五、深入一点：不要追求“工具统一”

很多团队会想：

- 只允许一种工具

现实往往是：

- **应用**与**库/SDK**的构建目标不同
- **开发期**与**生产期**的最优解不同

因此更成熟的策略是：

- 平台统一（Vite 或 Rsbuild）
- 库构建统一（Rollup 或 esbuild + tsc）
- 质量门禁统一（lint/test/typecheck）

---

## 参考资料

- [Vite](https://vite.dev/)
- [webpack](https://webpack.js.org/)
- [Rspack](https://rspack.rs/)
- [Rsbuild](https://v0.rsbuild.dev/)
- [Rollup](https://rollupjs.org/)
